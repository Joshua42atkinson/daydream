{% extends "base.html" %}

{% block title %}Sign Up - Daydream{% endblock %}

{% block content %}
<div class="auth-container">
    <h2 id="signup-heading">Sign Up for Daydream</h2>

    {# This form posts data to the /signup route defined in app.py #}
    {# Added aria-labelledby and novalidate (as we'll use JS validation) #}
    <form id="signup-form" method="POST" action="{{ url_for('signup') }}" aria-labelledby="signup-heading" novalidate>
        <div class="form-group">
            <label for="email">Email:</label>
            {# Added autocomplete #}
            <input type="email" id="email" name="email" required autocomplete="email">
        </div>
        <div class="form-group">
            <label for="password">Password (min 6 characters):</label>
            {# Added autocomplete and pattern for basic client-side length check #}
            <input type="password" id="password" name="password" required autocomplete="new-password" minlength="6" pattern=".{6,}" title="Password must be at least 6 characters long.">
        </div>
        {# --- ADDED: Password Confirmation --- #}
        <div class="form-group">
            <label for="confirm_password">Confirm Password:</label>
            {# Added autocomplete #}
            <input type="password" id="confirm_password" name="confirm_password" required autocomplete="new-password">
             {# Added empty div for potential JS error message #}
            <div id="password-error" class="form-error" style="color: red; font-size: 0.9em; margin-top: 5px;"></div>
        </div>
        {# --- END ADDED --- #}

        <div class="form-actions"> {# Wrap button #}
            <button type="submit" class="button">Sign Up</button>
        </div>
    </form>
    <p class="auth-switch"> {# Added class #}
        Already have an account? <a href="{{ url_for('login') }}">Login here</a>
    </p>
</div>
{% endblock %}

{# Removed empty {% block styles %} #}

{% block scripts %}
    {# Add JavaScript for client-side password confirmation check #}
    <script>
        const form = document.getElementById('signup-form');
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm_password');
        const errorDiv = document.getElementById('password-error');

        if (form && password && confirmPassword && errorDiv) {
            form.addEventListener('submit', function(event) {
                // Clear previous error message
                errorDiv.textContent = '';
                errorDiv.style.display = 'none';

                // Check if passwords match
                if (password.value !== confirmPassword.value) {
                    // Prevent form submission
                    event.preventDefault();
                    // Display error message
                    errorDiv.textContent = 'Passwords do not match.';
                    errorDiv.style.display = 'block';
                    // Optionally focus the confirm password field
                    confirmPassword.focus();
                }
                 // Basic length check (redundant with minlength but good practice)
                else if (password.value.length < 6) {
                     event.preventDefault();
                     errorDiv.textContent = 'Password must be at least 6 characters long.';
                     errorDiv.style.display = 'block';
                     password.focus();
                }
                // Add other client-side checks if needed (e.g., complexity)
            });
        }
    </script>
{% endblock %}