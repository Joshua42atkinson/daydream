<!DOCTYPE html>
<html>
   <head>
      <title>flake8 violations: app.py</title>
      <meta http-equiv="Content-Type" value="text/html; charset=UTF-8">
      <link rel="stylesheet" href="styles.css">
<script>
function bindHandler(link) {
   var code = link.getAttribute('data-code');
   var key = location.pathname + '#' + code;

   var ul = link.parentNode.querySelector('.details');
   if (sessionStorage[key] != 'open') {
      ul.style.display = 'none';
   }
   link.addEventListener('click', function (event) {
      if (!ul.style.display || ul.style.display == 'none') {
         ul.style.display = 'block';
         sessionStorage[key] = 'open';
      } else {
         ul.style.display = 'none';
         sessionStorage[key] = 'closed';
      }
   });
}

window.addEventListener('DOMContentLoaded', function () {
   var links = document.querySelectorAll('#index > li > a');
   for (var i = 0; i < links.length; i++) {
      bindHandler(links[i]);
   }
});
</script>
   </head>
   <body>
      <div id="masthead" class="sev-1"></div>
      <div id="page">
         <p id="srclink">
            <a title="View full annotated source"
               href="app.source.html">
               <img src="file.svg" alt="&#x2261;">
            </a></p>
         <h1>
            <a href="index.html">
               <img src="back.svg" alt="&#x2B05;">
               app.py
            </a>
         </h1>

         <ul id="index">

         <li>
            <a data-code="F541">
               <span class="count sev-1">
                  13
               </span>
               <strong>F541:</strong> f-string is missing placeholders

            </a>
            <ul class="details">
            <li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l309">
                  <tt><i>309</i>     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Google AI Model &#39;gemini-1.5-flash-latest&#39; initialized.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders (in 2 places):</p>

               <a href="app.source.html#l709">
                  <tt><i>709</i>          <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Evaluate the player&#39;s answers based on their understanding of the chapter events, relevance to the questions, and evidence of reasoning (scale 1-10 for each answer).</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="se">\n</span><span class="s2">A</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="p">(</span><span class="n">answers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">answers</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;(No Answer)&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">questions</span><span class="p">)])</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Provide an overall average comprehension score (float, 1-10).</span><span class="se">\n</span><span class="s2">Respond ONLY with JSON: </span><span class="se">{{\&quot;</span><span class="s2">overall_comprehension_score</span><span class="se">\&quot;</span><span class="s2">: float</span><span class="se">}}</span><span class="s2">.&quot;</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l1477">
                  <tt><i>1477</i>                 <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Account created successfully! Please log in.&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l1860">
                  <tt><i>1860</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finalization error: Session data missing.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l1889">
                  <tt><i>1889</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required character detail (Race/Class/Philosophy). Please start over.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l1985">
                  <tt><i>1985</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Displaying initial character creation form.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l2075">
                  <tt><i>2075</i>         <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vocabulary list status updated.&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span> <span class="c1"># User feedback</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l2739">
                  <tt><i>2739</i>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NameError accessing &#39;thetopia_lore&#39; globally. Sending empty lore data.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l2978">
                  <tt><i>2978</i>             <span class="n">summary_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;**Chapter Complete!**</span><span class="se">\n\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l2981">
                  <tt><i>2981</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;* **Writing Analysis:**</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l3187">
                  <tt><i>3187</i>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Daydream Server V5.3 ---&quot;</span><span class="p">)</span> <span class="c1"># &lt;&lt;&lt; Updated version number &gt;&gt;&gt;</span></tt>
               </a>
            </li><li>

               <p>F-string is missing placeholders:</p>

               <a href="app.source.html#l3193">
                  <tt><i>3193</i>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-----------------------------------&quot;</span><span class="p">)</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="F401">
               <span class="count sev-1">
                  2
               </span>
               <strong>F401:</strong> 'random' imported but unused

                  (and 1 similar)

            </a>
            <ul class="details">
            <li>

               <p>'random' imported but unused:</p>

               <a href="app.source.html#l13">
                  <tt><i>13</i> <span class="kn">import</span><span class="w"> </span><span class="nn">random</span></tt>
               </a>
            </li><li>

               <p>'math' imported but unused:</p>

               <a href="app.source.html#l15">
                  <tt><i>15</i> <span class="kn">import</span><span class="w"> </span><span class="nn">math</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="F841">
               <span class="count sev-1">
                  1
               </span>
               <strong>F841:</strong> local variable 'cmd' is assigned to but never used

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l637">
                  <tt><i>637</i>         <span class="n">cmd</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E501">
               <span class="count sev-2">
                  697
               </span>
               <strong>E501:</strong> line too long (86 > 79 characters)

                  (and 108 similar)

            </a>
            <ul class="details">
            <li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l43">
                  <tt><i>43</i> <span class="k">def</span><span class="w"> </span><span class="nf">_fallback_calculate_xp</span><span class="p">(</span><span class="n">text_input</span><span class="p">,</span> <span class="n">learned_set</span><span class="p">):</span> <span class="c1"># Removed unused custom_vocab arg</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l50">
                  <tt><i>50</i>     <span class="kn">from</span><span class="w"> </span><span class="nn">vocabulary</span><span class="w"> </span><span class="kn">import</span> <span class="n">AWL_WORDS</span> <span class="k">as</span> <span class="n">imported_awl_words</span><span class="p">,</span> <span class="n">calculate_xp</span> <span class="k">as</span> <span class="n">imported_calculate_xp</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l52">
                  <tt><i>52</i>     <span class="n">calculate_xp</span> <span class="o">=</span> <span class="n">imported_calculate_xp</span> <span class="c1"># Overwrite fallback if import succeeds</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l59">
                  <tt><i>59</i>             <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">AWL_DEFINITIONS_PATH</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="c1"># Added encoding</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l62">
                  <tt><i>62</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded AWL definitions from </span><span class="si">{</span><span class="n">AWL_DEFINITIONS_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (124 > 79 characters):</p>

               <a href="app.source.html#l64">
                  <tt><i>64</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">AWL_DEFINITIONS_PATH</span><span class="si">}</span><span class="s2"> did not contain a valid JSON dictionary. Using empty definitions.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (103 > 79 characters):</p>

               <a href="app.source.html#l67">
                  <tt><i>67</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">AWL_DEFINITIONS_PATH</span><span class="si">}</span><span class="s2"> not found. Word definitions will be unavailable.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (116 > 79 characters):</p>

               <a href="app.source.html#l70">
                  <tt><i>70</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error decoding JSON from </span><span class="si">{</span><span class="n">AWL_DEFINITIONS_PATH</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">json_err</span><span class="si">}</span><span class="s2">. Word definitions unavailable.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (120 > 79 characters):</p>

               <a href="app.source.html#l73">
                  <tt><i>73</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading </span><span class="si">{</span><span class="n">AWL_DEFINITIONS_PATH</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file_err</span><span class="si">}</span><span class="s2">. Word definitions unavailable.&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (155 > 79 characters):</p>

               <a href="app.source.html#l77">
                  <tt><i>77</i>     <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not import from vocabulary.py: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Using fallbacks for AWL_WORDS and calculate_xp. Word definitions may also be unavailable.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l87">
                  <tt><i>87</i>     <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using fallback get_quest_step for quest_id: </span><span class="si">{</span><span class="n">quest_id</span><span class="si">}</span><span class="s2">, step_id: </span><span class="si">{</span><span class="n">step_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (132 > 79 characters):</p>

               <a href="app.source.html#l94">
                  <tt><i>94</i>     <span class="kn">from</span><span class="w"> </span><span class="nn">quests</span><span class="w"> </span><span class="kn">import</span> <span class="n">QUEST_DATA</span> <span class="k">as</span> <span class="n">imported_quest_data</span><span class="p">,</span> <span class="n">get_quest</span> <span class="k">as</span> <span class="n">imported_get_quest</span><span class="p">,</span> <span class="n">get_quest_step</span> <span class="k">as</span> <span class="n">imported_get_quest_step</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l100">
                  <tt><i>100</i>     <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;quests.py not found or error during import: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Using fallbacks.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l111">
                  <tt><i>111</i>     <span class="n">world_map</span> <span class="o">=</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># Use locations as the world map source</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l114">
                  <tt><i>114</i>         <span class="s2">&quot;natural armor&quot;</span><span class="p">:</span> <span class="s2">&quot;Natural Armor&quot;</span><span class="p">,</span> <span class="s2">&quot;cannot wear armor&quot;</span><span class="p">:</span> <span class="s2">&quot;Cannot Wear Armor&quot;</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l116">
                  <tt><i>116</i>         <span class="s2">&quot;integrated systems&quot;</span><span class="p">:</span> <span class="s2">&quot;Integrated Systems&quot;</span><span class="p">,</span> <span class="s2">&quot;memory limit&quot;</span><span class="p">:</span> <span class="s2">&quot;Memory Limit&quot;</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (121 > 79 characters):</p>

               <a href="app.source.html#l156">
                  <tt><i>156</i>             <span class="n">premade_character_templates</span> <span class="o">=</span> <span class="p">[{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;base_attributes&#39;</span><span class="p">}</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">raw_templates</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (126 > 79 characters):</p>

               <a href="app.source.html#l158">
                  <tt><i>158</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;premade_chars.json contained data, but it was not in the expected list format after cleaning.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l161">
                  <tt><i>161</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pre-made characters loaded and cleaned from </span><span class="si">{</span><span class="n">PREMADE_CHARS_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (102 > 79 characters):</p>

               <a href="app.source.html#l163">
                  <tt><i>163</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error decoding JSON from </span><span class="si">{</span><span class="n">PREMADE_CHARS_PATH</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">json_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l166">
                  <tt><i>166</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading or processing </span><span class="si">{</span><span class="n">PREMADE_CHARS_PATH</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">read_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (129 > 79 characters):</p>

               <a href="app.source.html#l173">
                  <tt><i>173</i>     <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error during pre-made character loading setup for </span><span class="si">{</span><span class="n">PREMADE_CHARS_PATH</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">outer_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l179">
                  <tt><i>179</i>     <span class="s2">&quot;Sasquatch&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;abilities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Natural Armor&quot;</span><span class="p">,</span> <span class="s2">&quot;Cannot Wear Armor&quot;</span><span class="p">],</span> <span class="s2">&quot;fate_point_mod&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l181">
                  <tt><i>181</i>     <span class="s2">&quot;Android&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;abilities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Integrated Systems&quot;</span><span class="p">,</span> <span class="s2">&quot;Memory Limit&quot;</span><span class="p">],</span> <span class="s2">&quot;fate_point_mod&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l182">
                  <tt><i>182</i>     <span class="s2">&quot;Opossuman&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;abilities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Pack Tactics&quot;</span><span class="p">,</span> <span class="s2">&quot;Fierce Loyalty&quot;</span><span class="p">],</span> <span class="s2">&quot;fate_point_mod&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l183">
                  <tt><i>183</i>     <span class="s2">&quot;Tortisian&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;abilities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Artistic Shell&quot;</span><span class="p">,</span> <span class="s2">&quot;Second Brain&quot;</span><span class="p">],</span> <span class="s2">&quot;fate_point_mod&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l184">
                  <tt><i>184</i>     <span class="s2">&quot;Slime&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;abilities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Absorb Magic&quot;</span><span class="p">,</span> <span class="s2">&quot;Shapechange&quot;</span><span class="p">],</span> <span class="s2">&quot;fate_point_mod&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l188">
                  <tt><i>188</i>     <span class="s2">&quot;Archanist&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;focus&quot;</span><span class="p">:</span> <span class="s2">&quot;Favorite Incantation&quot;</span><span class="p">,</span> <span class="s2">&quot;ability&quot;</span><span class="p">:</span> <span class="s2">&quot;Arcane Affinity&quot;</span><span class="p">},</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l207">
                  <tt><i>207</i> <span class="n">DEFAULT_SERVICE_ACCOUNT_KEY_FILE</span> <span class="o">=</span> <span class="s2">&quot;daydream-455317-e701a4533dc0.json&quot;</span> <span class="c1"># !! REPLACE !!</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l232">
                  <tt><i>232</i> <span class="n">FS_QUEST_FLAGS</span> <span class="o">=</span> <span class="s1">&#39;quest_flags&#39;</span> <span class="c1"># Dictionary to store flags like {&#39;fountain_analyzed&#39;: True}</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l233">
                  <tt><i>233</i> <span class="n">FS_INVENTORY</span> <span class="o">=</span> <span class="s1">&#39;inventory&#39;</span> <span class="c1"># List to store item names like [&#39;Cogwheel&#39;, &#39;Hydro-Spanner&#39;]</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l234">
                  <tt><i>234</i> <span class="n">FS_PLAYER_HAS_SEEN_INTRO</span> <span class="o">=</span> <span class="s1">&#39;has_seen_intro&#39;</span> <span class="c1"># &lt;&lt;&lt; NEW &gt;&gt;&gt; Firestore field name constant</span></tt>
               </a>
            </li><li>

               <p>Line too long (127 > 79 characters):</p>

               <a href="app.source.html#l253">
                  <tt><i>253</i>     <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># Changed default level to INFO</span></tt>
               </a>
            </li><li>

               <p>Line too long (111 > 79 characters):</p>

               <a href="app.source.html#l262">
                  <tt><i>262</i>     <span class="n">SERVICE_ACCOUNT_KEY_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FIREBASE_SERVICE_ACCOUNT_KEY&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVICE_ACCOUNT_KEY_FILE</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l264">
                  <tt><i>264</i>         <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Firebase key not found: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">SERVICE_ACCOUNT_KEY_PATH</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l272">
                  <tt><i>272</i>         <span class="n">firebase_app</span> <span class="o">=</span> <span class="n">firebase_admin</span><span class="o">.</span><span class="n">initialize_app</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">FIREBASE_APP_NAME</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (107 > 79 characters):</p>

               <a href="app.source.html#l296">
                  <tt><i>296</i>         <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;FATAL: GEMINI_API_KEY environment variable not set or is still the placeholder.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (112 > 79 characters):</p>

               <a href="app.source.html#l297">
                  <tt><i>297</i>         <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Please set the GEMINI_API_KEY environment variable to your actual Google AI API key.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l302">
                  <tt><i>302</i>     <span class="kn">from</span><span class="w"> </span><span class="nn">google.generativeai.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">HarmCategory</span><span class="p">,</span> <span class="n">HarmBlockThreshold</span> <span class="c1"># &lt;&lt;&lt; ADDED IMPORT</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l313">
                  <tt><i>313</i>         <span class="n">HarmCategory</span><span class="o">.</span><span class="n">HARM_CATEGORY_HARASSMENT</span><span class="p">:</span> <span class="n">HarmBlockThreshold</span><span class="o">.</span><span class="n">BLOCK_MEDIUM_AND_ABOVE</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l314">
                  <tt><i>314</i>         <span class="n">HarmCategory</span><span class="o">.</span><span class="n">HARM_CATEGORY_HATE_SPEECH</span><span class="p">:</span> <span class="n">HarmBlockThreshold</span><span class="o">.</span><span class="n">BLOCK_MEDIUM_AND_ABOVE</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l315">
                  <tt><i>315</i>         <span class="n">HarmCategory</span><span class="o">.</span><span class="n">HARM_CATEGORY_SEXUALLY_EXPLICIT</span><span class="p">:</span> <span class="n">HarmBlockThreshold</span><span class="o">.</span><span class="n">BLOCK_MEDIUM_AND_ABOVE</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l316">
                  <tt><i>316</i>         <span class="n">HarmCategory</span><span class="o">.</span><span class="n">HARM_CATEGORY_DANGEROUS_CONTENT</span><span class="p">:</span> <span class="n">HarmBlockThreshold</span><span class="o">.</span><span class="n">BLOCK_MEDIUM_AND_ABOVE</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (123 > 79 characters):</p>

               <a href="app.source.html#l329">
                  <tt><i>329</i> <span class="k">def</span><span class="w"> </span><span class="nf">find_terms_in_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">terms_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">key_transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]:</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l340">
                  <tt><i>340</i>             <span class="n">transformed_map</span><span class="p">[</span><span class="n">transformed_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="n">keyword</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l353">
                  <tt><i>353</i>             <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b&#39;</span> <span class="o">+</span> <span class="n">escaped_key</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\b&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l357">
                  <tt><i>357</i>                 <span class="n">is_overlap</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">processed_indices</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">end_index</span><span class="p">))</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l360">
                  <tt><i>360</i>                     <span class="c1"># Store the start, end, original keyword (for display), and associated data</span></tt>
               </a>
            </li><li>

               <p>Line too long (100 > 79 characters):</p>

               <a href="app.source.html#l361">
                  <tt><i>361</i>                     <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_index</span><span class="p">,</span> <span class="n">end_index</span><span class="p">,</span> <span class="n">term_info</span><span class="p">[</span><span class="s2">&quot;original&quot;</span><span class="p">],</span> <span class="n">term_info</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]))</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l362">
                  <tt><i>362</i>                     <span class="c1"># Mark indices as processed to prevent nested/overlapping highlights</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l366">
                  <tt><i>366</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Regex error processing term &#39;</span><span class="si">{</span><span class="n">term_key</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">regex_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (338 > 79 characters):</p>

               <a href="app.source.html#l373">
                  <tt><i>373</i> <span class="k">def</span><span class="w"> </span><span class="nf">process_text_for_highlighting</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]],</span> <span class="n">span_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_attribute_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_formatter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;#39;&quot;</span><span class="p">),</span> <span class="n">title_formatter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;definition&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">display_formatter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">original_keyword</span><span class="p">,</span> <span class="n">matched_text</span><span class="p">,</span> <span class="n">term_data</span><span class="p">:</span> <span class="n">matched_text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l398">
                  <tt><i>398</i>             <span class="c1"># Use single quotes for data attribute to avoid issues if data contains quotes</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l401">
                  <tt><i>401</i>         <span class="c1"># Get the matched text and format display text (usually just the matched text)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l403">
                  <tt><i>403</i>         <span class="n">display_text</span> <span class="o">=</span> <span class="n">display_formatter</span><span class="p">(</span><span class="n">original_keyword</span><span class="p">,</span> <span class="n">matched_text</span><span class="p">,</span> <span class="n">term_data</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l418">
                  <tt><i>418</i> <span class="k">def</span><span class="w"> </span><span class="nf">apply_vocab_highlighting_python</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vocab_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">color_prefs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l420">
                  <tt><i>420</i> <span class="sd">    Applies highlighting spans for vocabulary terms using user color preferences.</span></tt>
               </a>
            </li><li>

               <p>Line too long (104 > 79 characters):</p>

               <a href="app.source.html#l431">
                  <tt><i>431</i>         <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;apply_vocab_highlighting_python received invalid color_prefs, using defaults.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l453">
                  <tt><i>453</i>     <span class="n">found_terms</span> <span class="o">=</span> <span class="n">find_terms_in_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">vocab_data</span><span class="p">,</span> <span class="n">key_transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l457">
                  <tt><i>457</i>         <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;definition&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> (Source: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l473">
                  <tt><i>473</i>         <span class="n">css_class</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;highlighted-vocab </span><span class="si">{</span><span class="n">source_class</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Keep class for potential generic styles</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l482">
                  <tt><i>482</i>             <span class="n">safe_title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;quot;&quot;</span><span class="p">)</span> <span class="c1"># Escape quotes for HTML attribute</span></tt>
               </a>
            </li><li>

               <p>Line too long (103 > 79 characters):</p>

               <a href="app.source.html#l508">
                  <tt><i>508</i>              <span class="s2">&quot;display_term&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;display_term&quot;</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()),</span> <span class="c1"># How the term should look</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l512">
                  <tt><i>512</i>      <span class="c1"># Find terms using the original key case for lore terms (can be proper nouns)</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l513">
                  <tt><i>513</i>      <span class="n">found_terms</span> <span class="o">=</span> <span class="n">find_terms_in_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">processed_lore_terms</span><span class="p">,</span> <span class="n">key_transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l519">
                  <tt><i>519</i>          <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;#39;&quot;</span><span class="p">)</span> <span class="c1"># Use HTML entity for single quote</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l534">
                  <tt><i>534</i>          <span class="n">data_attribute_name</span><span class="o">=</span><span class="s2">&quot;data-lore-path&quot;</span><span class="p">,</span> <span class="c1"># Attribute JS will use for lookups</span></tt>
               </a>
            </li><li>

               <p>Line too long (150 > 79 characters):</p>

               <a href="app.source.html#l555">
                  <tt><i>555</i>         <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI Error&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span><span class="s2">&quot;AI model not initialized&quot;</span><span class="p">}</span> <span class="k">if</span> <span class="n">is_json_output</span> <span class="k">else</span> <span class="s2">&quot;Error: The Storyteller AI is currently unavailable.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l571">
                  <tt><i>571</i>         <span class="c1"># Attempt to fetch title/desc if not provided in context (should usually be there)</span></tt>
               </a>
            </li><li>

               <p>Line too long (205 > 79 characters):</p>

               <a href="app.source.html#l584">
                  <tt><i>584</i>         <span class="sa">f</span><span class="s2">&quot;Act as the AI Storyteller for &#39;Daydream&#39;. Setting: Dumpster Planet (a chaotic realm of discarded ideas). Current Location: </span><span class="si">{</span><span class="n">loc_name</span><span class="si">}</span><span class="s2">. Player Character: </span><span class="si">{</span><span class="n">char_profile</span><span class="si">}</span><span class="s2">. Fate Points: </span><span class="si">{</span><span class="n">fate_pts</span><span class="si">}</span><span class="s2">. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (159 > 79 characters):</p>

               <a href="app.source.html#l585">
                  <tt><i>585</i>         <span class="sa">f</span><span class="s2">&quot;Your goal is to create an engaging, descriptive narrative experience. Use sensory details (sight, sound, smell, feel) based on the location&#39;s lore. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (145 > 79 characters):</p>

               <a href="app.source.html#l586">
                  <tt><i>586</i>         <span class="sa">f</span><span class="s2">&quot;Interpret player actions creatively, considering their character profile. Narrate outcomes by *showing* the results and consequences. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (110 > 79 characters):</p>

               <a href="app.source.html#l587">
                  <tt><i>587</i>         <span class="sa">f</span><span class="s2">&quot;Encourage thoughtful player input. Keep responses concise but evocative, suitable for Grades 8-12. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l594">
                  <tt><i>594</i>     <span class="c1"># --- Prompt Construction based on Type (Keep existing prompts from v5.2) ---</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l602">
                  <tt><i>602</i>              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_instruct</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Task: Welcome </span><span class="si">{</span><span class="n">p_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">p_race</span><span class="si">}</span><span class="s2">) to </span><span class="si">{</span><span class="n">loc_name</span><span class="si">}</span><span class="s2">. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (162 > 79 characters):</p>

               <a href="app.source.html#l603">
                  <tt><i>603</i>              <span class="sa">f</span><span class="s2">&quot;Describe the scene vividly using sensory details (sight, sound, smell). Convey the location&#39;s mood (&#39;</span><span class="si">{</span><span class="n">mood</span><span class="si">}</span><span class="s2">&#39;). Mention present NPCs: </span><span class="si">{</span><span class="n">npcs_here</span><span class="si">}</span><span class="s2">. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (141 > 79 characters):</p>

               <a href="app.source.html#l604">
                  <tt><i>604</i>              <span class="sa">f</span><span class="s2">&quot;Consider </span><span class="si">{</span><span class="n">p_name</span><span class="si">}</span><span class="s2">&#39;s perspective as a </span><span class="si">{</span><span class="n">p_race</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">p_class</span><span class="si">}</span><span class="s2">. End with an open-ended question inviting description or reflection. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (152 > 79 characters):</p>

               <a href="app.source.html#l605">
                  <tt><i>605</i>              <span class="sa">f</span><span class="s2">&quot;Example ending: &#39;What aspect of this scene captures your attention first?&#39; or &#39;How does your </span><span class="si">{</span><span class="n">p_race</span><span class="si">}</span><span class="s2"> nature react to this environment?&#39;&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (174 > 79 characters):</p>

               <a href="app.source.html#l615">
                  <tt><i>615</i>             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_instruct</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Task: Describe </span><span class="si">{</span><span class="n">loc_name</span><span class="si">}</span><span class="s2"> in response to &#39;look around&#39;. Use rich sensory details (sight, sound, smell, feel) and evoke the mood (&#39;</span><span class="si">{</span><span class="n">mood</span><span class="si">}</span><span class="s2">&#39;). &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (128 > 79 characters):</p>

               <a href="app.source.html#l616">
                  <tt><i>616</i>             <span class="sa">f</span><span class="s2">&quot;Describe key features and NPCs (</span><span class="si">{</span><span class="n">npcs_here</span><span class="si">}</span><span class="s2">) based on the lore (</span><span class="si">{</span><span class="n">lore_desc</span><span class="si">}</span><span class="s2">). Mention available exits (</span><span class="si">{</span><span class="n">exits</span><span class="si">}</span><span class="s2">). &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (170 > 79 characters):</p>

               <a href="app.source.html#l617">
                  <tt><i>617</i>             <span class="sa">f</span><span class="s2">&quot;Frame the description from </span><span class="si">{</span><span class="n">p_name</span><span class="si">}</span><span class="s2">&#39;s perspective (</span><span class="si">{</span><span class="n">p_race</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">p_class</span><span class="si">}</span><span class="s2">). Ask what specific detail draws their focus or what they intend to investigate next.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l621">
                  <tt><i>621</i>         <span class="n">current_npcs</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;present_npcs&#39;</span><span class="p">,[])</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l623">
                  <tt><i>623</i>             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_instruct</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Task: Narrate </span><span class="si">{</span><span class="n">p_name</span><span class="si">}</span><span class="s2"> using the ability &#39;</span><span class="si">{</span><span class="n">ability</span><span class="si">}</span><span class="s2">&#39;. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (141 > 79 characters):</p>

               <a href="app.source.html#l624">
                  <tt><i>624</i>             <span class="sa">f</span><span class="s2">&quot;Describe the *process* and *sensory effects* of the ability activating, using flavorful language appropriate for &#39;</span><span class="si">{</span><span class="n">ability</span><span class="si">}</span><span class="s2">&#39;. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (276 > 79 characters):</p>

               <a href="app.source.html#l625">
                  <tt><i>625</i>             <span class="sa">f</span><span class="s2">&quot;Show the outcome through narrative description (success, partial success, failure, unexpected consequence) based *only* on the ability concept, current situation (location=</span><span class="si">{</span><span class="n">loc_name</span><span class="si">}</span><span class="s2">, NPCs=</span><span class="si">{</span><span class="n">current_npcs</span><span class="si">}</span><span class="s2">), player&#39;s goal (</span><span class="si">{</span><span class="n">q_ctx</span><span class="si">}</span><span class="s2">), and Fate Points (</span><span class="si">{</span><span class="n">fate_pts</span><span class="si">}</span><span class="s2">). &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (195 > 79 characters):</p>

               <a href="app.source.html#l631">
                  <tt><i>631</i>         <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_instruct</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Task: Explain *narratively* why </span><span class="si">{</span><span class="n">p_name</span><span class="si">}</span><span class="s2"> cannot &#39;go </span><span class="si">{</span><span class="n">direction</span><span class="si">}</span><span class="s2">&#39; from </span><span class="si">{</span><span class="n">loc_name</span><span class="si">}</span><span class="s2">. Describe the obstacle or reason vividly. Mention available exits: </span><span class="si">{</span><span class="n">exits</span><span class="si">}</span><span class="s2">.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (207 > 79 characters):</p>

               <a href="app.source.html#l635">
                  <tt><i>635</i>         <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_instruct</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Task: Explain *narratively* why </span><span class="si">{</span><span class="n">p_name</span><span class="si">}</span><span class="s2"> couldn&#39;t use &#39;</span><span class="si">{</span><span class="n">ability</span><span class="si">}</span><span class="s2">&#39;. Reason provided: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">. Gently clarify the situation or ability&#39;s limitations through description.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l642">
                  <tt><i>642</i>         <span class="n">player_input</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># Use variable name consistently</span></tt>
               </a>
            </li><li>

               <p>Line too long (167 > 79 characters):</p>

               <a href="app.source.html#l646">
                  <tt><i>646</i>             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_instruct</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Task: Interpret player command &#39;</span><span class="si">{</span><span class="n">player_input</span><span class="si">}</span><span class="s2">&#39; and narrate the outcome. This command is NOT a move, look, or explicit ability use.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (114 > 79 characters):</p>

               <a href="app.source.html#l647">
                  <tt><i>647</i>             <span class="sa">f</span><span class="s2">&quot;Context: </span><span class="si">{</span><span class="n">char_profile</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">loc_name</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">fate_pts</span><span class="si">}</span><span class="s2"> Fate Points. Player Abilities: </span><span class="si">{</span><span class="n">abilities</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (139 > 79 characters):</p>

               <a href="app.source.html#l649">
                  <tt><i>649</i>             <span class="sa">f</span><span class="s2">&quot;Response Guidance: Determine player&#39;s intent. Consider how a </span><span class="si">{</span><span class="n">p_race</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">p_class</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">p_philosophy</span><span class="si">}</span><span class="s2">) would perform this action. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (145 > 79 characters):</p>

               <a href="app.source.html#l650">
                  <tt><i>650</i>             <span class="sa">f</span><span class="s2">&quot;*Show* the action unfolding and its immediate consequences through sensory details. Narrate a plausible outcome based on context. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (159 > 79 characters):</p>

               <a href="app.source.html#l651">
                  <tt><i>651</i>             <span class="sa">f</span><span class="s2">&quot;If the command is very simple (e.g., &#39;open door&#39;), briefly ask for *how* they do it (e.g., &#39;How do you try the door? Cautiously? Forcefully?&#39;). &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (116 > 79 characters):</p>

               <a href="app.source.html#l652">
                  <tt><i>652</i>             <span class="sa">f</span><span class="s2">&quot;If the command is vague, ask for clarification. If relevant, gently guide towards the quest: </span><span class="si">{</span><span class="n">q_ctx</span><span class="si">}</span><span class="s2">.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l656">
                  <tt><i>656</i>         <span class="n">interaction_verbs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;talk&quot;</span><span class="p">,</span> <span class="s2">&quot;ask&quot;</span><span class="p">,</span> <span class="s2">&quot;speak&quot;</span><span class="p">,</span> <span class="s2">&quot;say&quot;</span><span class="p">,</span> <span class="s2">&quot;greet&quot;</span><span class="p">,</span> <span class="s2">&quot;tell&quot;</span><span class="p">,</span> <span class="s2">&quot;question&quot;</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l657">
                  <tt><i>657</i>         <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">player_input</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">verb</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">verb</span> <span class="ow">in</span> <span class="n">interaction_verbs</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l658">
                  <tt><i>658</i>             <span class="n">target_npc_input</span> <span class="o">=</span> <span class="n">player_input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Get text after the verb</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l672">
                  <tt><i>672</i>                 <span class="n">npc_data</span> <span class="o">=</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npcs&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target_npc_found</span><span class="p">,{})</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l678">
                  <tt><i>678</i>                     <span class="sa">f</span><span class="s2">&quot;Target NPC (</span><span class="si">{</span><span class="n">target_npc_found</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">npc_desc</span><span class="si">}</span><span class="s2"> Personality: </span><span class="si">{</span><span class="n">npc_pers</span><span class="si">}</span><span class="s2">. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (107 > 79 characters):</p>

               <a href="app.source.html#l679">
                  <tt><i>679</i>                     <span class="sa">f</span><span class="s2">&quot;Knowledge Areas: </span><span class="si">{</span><span class="n">npc_knowledge</span><span class="si">}</span><span class="s2">. Typical Greetings: </span><span class="si">{</span><span class="n">npc_hooks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[])</span><span class="si">}</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (137 > 79 characters):</p>

               <a href="app.source.html#l682">
                  <tt><i>682</i>                     <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Interaction Guidance: Respond as </span><span class="si">{</span><span class="n">target_npc_found</span><span class="si">}</span><span class="s2">, reflecting their personality (</span><span class="si">{</span><span class="n">npc_pers</span><span class="si">}</span><span class="s2">) and knowledge. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (137 > 79 characters):</p>

               <a href="app.source.html#l683">
                  <tt><i>683</i>                     <span class="sa">f</span><span class="s2">&quot;Consider how they might react to a </span><span class="si">{</span><span class="n">p_race</span><span class="si">}</span><span class="s2"> asking about the topic derived from &#39;</span><span class="si">{</span><span class="n">player_input</span><span class="si">}</span><span class="s2">&#39;. Use their voice.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (123 > 79 characters):</p>

               <a href="app.source.html#l686">
                  <tt><i>686</i>                  <span class="n">prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Interaction Note: </span><span class="si">{</span><span class="n">npc_detail</span><span class="si">}</span><span class="s2">. Ask player to clarify who they are talking to if ambiguous.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (111 > 79 characters):</p>

               <a href="app.source.html#l692">
                  <tt><i>692</i>              <span class="sa">f</span><span class="s2">&quot;Analyze the following player text responses from a single chapter. Evaluate on these metrics:</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l694">
                  <tt><i>694</i>              <span class="sa">f</span><span class="s2">&quot;2. List of AWL words used (Extract words from the standard Academic Word List).</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (111 > 79 characters):</p>

               <a href="app.source.html#l696">
                  <tt><i>696</i>              <span class="sa">f</span><span class="s2">&quot;4. Critical Thinking evident (Low/Medium/High ability to strategize, infer, or make choices).</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (110 > 79 characters):</p>

               <a href="app.source.html#l698">
                  <tt><i>698</i>              <span class="sa">f</span><span class="s2">&quot;6. Descriptive Language Use (Low/Medium/High use of sensory details and evocative language).</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l700">
                  <tt><i>700</i>              <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">relevance_coherence_score</span><span class="se">\&quot;</span><span class="s2">:int, </span><span class="se">\&quot;</span><span class="s2">awl_words_used</span><span class="se">\&quot;</span><span class="s2">:[str], </span><span class="se">\&quot;</span><span class="s2">style_rating</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">L|M|H</span><span class="se">\&quot;</span><span class="s2">, &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l701">
                  <tt><i>701</i>              <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">thinking_rating</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">L|M|H</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">avg_length_category</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">S|M|L</span><span class="se">\&quot;</span><span class="s2">, &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (453 > 79 characters):</p>

               <a href="app.source.html#l709">
                  <tt><i>709</i>          <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Evaluate the player&#39;s answers based on their understanding of the chapter events, relevance to the questions, and evidence of reasoning (scale 1-10 for each answer).</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="se">\n</span><span class="s2">A</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="p">(</span><span class="n">answers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">answers</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;(No Answer)&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">questions</span><span class="p">)])</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Provide an overall average comprehension score (float, 1-10).</span><span class="se">\n</span><span class="s2">Respond ONLY with JSON: </span><span class="se">{{\&quot;</span><span class="s2">overall_comprehension_score</span><span class="se">\&quot;</span><span class="s2">: float</span><span class="se">}}</span><span class="s2">.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (170 > 79 characters):</p>

               <a href="app.source.html#l715">
                  <tt><i>715</i>         <span class="n">sheet_data_narrative</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sheet_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;boon&#39;</span><span class="p">,</span> <span class="s1">&#39;backstory&#39;</span><span class="p">,</span> <span class="s1">&#39;starting_quest&#39;</span><span class="p">]}</span></tt>
               </a>
            </li><li>

               <p>Line too long (191 > 79 characters):</p>

               <a href="app.source.html#l717">
                  <tt><i>717</i>             <span class="sa">f</span><span class="s2">&quot;Review the following player-created character sheet for narrative potential in the &#39;Daydream&#39; game (Dumpster Planet setting: chaotic realm of discarded ideas, hub: Thetopia).</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (318 > 79 characters):</p>

               <a href="app.source.html#l718">
                  <tt><i>718</i>             <span class="sa">f</span><span class="s2">&quot;Check for clarity, interesting hooks based on lore (Races: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;races&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">, Classes: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">, Philosophies: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;philosophies&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">), internal consistency, and playability. Focus on narrative aspects only.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l719">
                  <tt><i>719</i>             <span class="sa">f</span><span class="s2">&quot;Character Sheet:</span><span class="se">\n</span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">sheet_data_narrative</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (146 > 79 characters):</p>

               <a href="app.source.html#l720">
                  <tt><i>720</i>             <span class="sa">f</span><span class="s2">&quot;Respond ONLY with a JSON object containing specific, constructive recommendations focused on enhancing narrative depth or clarity. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (243 > 79 characters):</p>

               <a href="app.source.html#l721">
                  <tt><i>721</i>             <span class="sa">f</span><span class="s2">&quot;Structure: </span><span class="se">{{</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">recommendations</span><span class="se">\&quot;</span><span class="s2">: [ </span><span class="se">{{</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">field</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">field_name</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">type</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">clarify|enhance|issue|interesting</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">suggestion</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">text describing the suggestion...</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">}}</span><span class="s2"> ] </span><span class="se">}}</span><span class="s2"> or </span><span class="se">{{</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">recommendations</span><span class="se">\&quot;</span><span class="s2">: [] </span><span class="se">}}</span><span class="s2"> if it looks good.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (172 > 79 characters):</p>

               <a href="app.source.html#l729">
                  <tt><i>729</i>         <span class="n">char_data_narrative</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">char_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;boon&#39;</span><span class="p">,</span> <span class="s1">&#39;backstory&#39;</span><span class="p">,</span> <span class="s1">&#39;abilities&#39;</span><span class="p">,</span> <span class="s1">&#39;aspects&#39;</span><span class="p">]}</span></tt>
               </a>
            </li><li>

               <p>Line too long (116 > 79 characters):</p>

               <a href="app.source.html#l731">
                  <tt><i>731</i>         <span class="n">last_summary_text</span> <span class="o">=</span> <span class="n">summaries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">,</span><span class="s1">&#39;(No previous summary)&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">summaries</span> <span class="k">else</span> <span class="s1">&#39;(First Chapter)&#39;</span></tt>
               </a>
            </li><li>

               <p>Line too long (154 > 79 characters):</p>

               <a href="app.source.html#l733">
                  <tt><i>733</i>             <span class="sa">f</span><span class="s2">&quot;Generate the *next* quest (Chapter </span><span class="si">{</span><span class="n">chapter_num</span><span class="si">}</span><span class="s2">) for the Daydream game.</span><span class="se">\n</span><span class="s2">Character Profile:</span><span class="se">\n</span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">char_data_narrative</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (104 > 79 characters):</p>

               <a href="app.source.html#l734">
                  <tt><i>734</i>             <span class="sa">f</span><span class="s2">&quot;Most Recent Chapter Summary:</span><span class="se">\n</span><span class="si">{</span><span class="n">last_summary_text</span><span class="si">}</span><span class="se">\n</span><span class="s2">Target Hero&#39;s Journey Stage: </span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (158 > 79 characters):</p>

               <a href="app.source.html#l735">
                  <tt><i>735</i>             <span class="sa">f</span><span class="s2">&quot;Requirements:</span><span class="se">\n</span><span class="s2">1. Create a conflict/goal that *directly follows from or reacts to* the character details and the MOST RECENT chapter summary.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (110 > 79 characters):</p>

               <a href="app.source.html#l736">
                  <tt><i>736</i>             <span class="sa">f</span><span class="s2">&quot;2. Ensure strong narrative continuity. The quest should feel like a consequence or next step.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l738">
                  <tt><i>738</i>             <span class="sa">f</span><span class="s2">&quot;4. Provide an actionable starting step description that clearly guides the player.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (362 > 79 characters):</p>

               <a href="app.source.html#l740">
                  <tt><i>740</i>             <span class="sa">f</span><span class="s2">&quot;Respond ONLY with JSON: </span><span class="se">{{\&quot;</span><span class="s2">quest_id</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">Q_CH</span><span class="si">{</span><span class="n">chapter_num</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">char_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;char&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">title</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">Chapter </span><span class="si">{</span><span class="n">chapter_num</span><span class="si">}</span><span class="s2">: [Concise Title]</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">description</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">[Brief overall quest description building on previous chapter]</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">starting_step_id</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">STEP_01</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">starting_step_description</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">[Clear, actionable first step description]</span><span class="se">\&quot;}}</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (106 > 79 characters):</p>

               <a href="app.source.html#l747">
                  <tt><i>747</i>             <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;Missing Input&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Target word for vocabulary generation is missing&quot;</span><span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Line too long (566 > 79 characters):</p>

               <a href="app.source.html#l748">
                  <tt><i>748</i>         <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Task: Generate a contextual vocabulary list related to the word &#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39;.</span><span class="se">\n</span><span class="s2">1. Provide a clear definition for &#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39; suitable for grades 8-12.</span><span class="se">\n</span><span class="s2">2. List exactly 25 related words (synonyms, antonyms, conceptually linked terms).</span><span class="se">\n</span><span class="s2">3. Provide a clear definition for each of the 25 related words, suitable for grades 8-12.</span><span class="se">\n</span><span class="s2">Format ONLY JSON: </span><span class="se">{{\&quot;</span><span class="s2">target_word_info</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">{{\&quot;</span><span class="s2">word</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">definition</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">...</span><span class="se">\&quot;}}</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">related_words</span><span class="se">\&quot;</span><span class="s2">:[</span><span class="se">{{\&quot;</span><span class="s2">word</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">word1</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">definition</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">...</span><span class="se">\&quot;}}</span><span class="s2">,...,</span><span class="se">{{\&quot;</span><span class="s2">word</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">word25</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">definition</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">...</span><span class="se">\&quot;}}</span><span class="s2">]</span><span class="se">}}</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (125 > 79 characters):</p>

               <a href="app.source.html#l753">
                  <tt><i>753</i>         <span class="n">quest_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Quest:&#39;</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_quest_title&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; Step:&#39;</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l754">
                  <tt><i>754</i>         <span class="n">conversation_summary</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;conversation_summary&#39;</span><span class="p">,</span> <span class="s1">&#39;(no recent conversation)&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (223 > 79 characters):</p>

               <a href="app.source.html#l758">
                  <tt><i>758</i>             <span class="sa">f</span><span class="s2">&quot;Analyze the current game state. Turn Count: </span><span class="si">{</span><span class="n">turn_count</span><span class="si">}</span><span class="s2">. Inputs this Chapter: </span><span class="si">{</span><span class="n">inputs_count</span><span class="si">}</span><span class="s2">. Character: </span><span class="si">{</span><span class="n">char_info</span><span class="si">}</span><span class="s2">. Current Objective: </span><span class="si">{</span><span class="n">quest_info</span><span class="si">}</span><span class="s2">. Recent Conversation Summary:</span><span class="se">\n</span><span class="si">{</span><span class="n">conversation_summary</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (230 > 79 characters):</p>

               <a href="app.source.html#l759">
                  <tt><i>759</i>             <span class="sa">f</span><span class="s2">&quot;Task: Evaluate if the chapter has had sufficient narrative development and player interaction for a meaningful end-of-chapter evaluation (consider turns &gt; </span><span class="si">{</span><span class="n">EOC_CHECK_START_TURN</span><span class="si">}</span><span class="s2"> and inputs &gt; </span><span class="si">{</span><span class="n">MIN_INPUTS_FOR_EOC</span><span class="si">}</span><span class="s2">).</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (199 > 79 characters):</p>

               <a href="app.source.html#l760">
                  <tt><i>760</i>             <span class="sa">f</span><span class="s2">&quot;1. If significant progress on the objective OR substantial exploration/interaction has occurred, AND the chapter feels sufficiently developed for evaluation, respond ONLY with &#39;YES&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (197 > 79 characters):</p>

               <a href="app.source.html#l761">
                  <tt><i>761</i>             <span class="sa">f</span><span class="s2">&quot;2. If a natural pause point seems reached (e.g., objective part met) BUT the chapter feels short or lacks interaction depth for a good evaluation, respond ONLY with &#39;SUGGEST_TASK&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (256 > 79 characters):</p>

               <a href="app.source.html#l767">
                  <tt><i>767</i>              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_instruct</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Task: Inform the player they&#39;ve reached a natural pause point, but the current chapter could use a bit more activity for a full reflection. Offer them a chance to define a brief, personal side task for writing practice.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (158 > 79 characters):</p>

               <a href="app.source.html#l768">
                  <tt><i>768</i>              <span class="sa">f</span><span class="s2">&quot;Ask them clearly: &#39;What small, immediate goal or observation would your character like to focus on right now before we conclude this chapter?&#39;&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l775">
                  <tt><i>775</i>               <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_instruct</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Player proposed side task: &#39;</span><span class="si">{</span><span class="n">player_idea</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (261 > 79 characters):</p>

               <a href="app.source.html#l776">
                  <tt><i>776</i>               <span class="sa">f</span><span class="s2">&quot;Task: Interpret the player&#39;s idea. Formulate a concise, actionable mini-objective (1-2 steps max) based on their input. If the idea is too complex or vague, generate a simpler, related objective suitable for a short detour (approx 3-5 turns).</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (116 > 79 characters):</p>

               <a href="app.source.html#l777">
                  <tt><i>777</i>               <span class="sa">f</span><span class="s2">&quot;Respond ONLY with JSON: </span><span class="se">{{\&quot;</span><span class="s2">side_quest_objective</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">[Generated concise objective description]</span><span class="se">\&quot;}}</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (121 > 79 characters):</p>

               <a href="app.source.html#l784">
                  <tt><i>784</i>               <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_instruct</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">Side Quest Objective Was: &#39;</span><span class="si">{</span><span class="n">side_quest_obj</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">Recent Conversation:</span><span class="se">\n</span><span class="si">{</span><span class="n">recent_conv</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (244 > 79 characters):</p>

               <a href="app.source.html#l785">
                  <tt><i>785</i>               <span class="sa">f</span><span class="s2">&quot;Task: Briefly assess if the player seems to have reasonably addressed or completed their self-defined side quest objective based ONLY on the recent conversation provided. Focus on effort/engagement rather than strict success.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l793">
                  <tt><i>793</i>         <span class="n">ai_outcome</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ai_outcome&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># Last AI response narrating outcome</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l794">
                  <tt><i>794</i>         <span class="n">check_criteria</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ai_check_criteria&#39;</span><span class="p">,</span> <span class="s1">&#39;if the player performed the action&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (122 > 79 characters):</p>

               <a href="app.source.html#l797">
                  <tt><i>797</i>             <span class="sa">f</span><span class="s2">&quot;Evaluate if the player&#39;s action likely completed the step based on the outcome and the specific criteria.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (131 > 79 characters):</p>

               <a href="app.source.html#l801">
                  <tt><i>801</i>             <span class="sa">f</span><span class="s2">&quot;Criteria: Based *only* on the Player&#39;s Action and Narrated Outcome text provided above, determine </span><span class="si">{</span><span class="n">check_criteria</span><span class="si">}</span><span class="s2">. &quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l802">
                  <tt><i>802</i>             <span class="sa">f</span><span class="s2">&quot;Focus on whether the described action or intent occurred this turn.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l807">
                  <tt><i>807</i>         <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown prompt type requested: &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;. Using fallback.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l808">
                  <tt><i>808</i>         <span class="n">prompt</span> <span class="o">=</span> <span class="n">base_instruct</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">My Task: Respond gracefully to an unclear request.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l814">
                  <tt><i>814</i>         <span class="c1"># logging.debug(f&quot;Full Prompt for {prompt_type}: {prompt}&quot;) # Uncomment for deep debugging</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l815">
                  <tt><i>815</i>         <span class="n">response</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l821">
                  <tt><i>821</i>              <span class="n">block_reason</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">feedback</span><span class="p">,</span> <span class="s1">&#39;block_reason&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">feedback</span> <span class="k">else</span> <span class="s1">&#39;Unknown&#39;</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l823">
                  <tt><i>823</i>              <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI response blocked for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;. Reason: </span><span class="si">{</span><span class="n">block_reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (126 > 79 characters):</p>

               <a href="app.source.html#l825">
                  <tt><i>825</i>              <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI Error&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span> <span class="k">if</span> <span class="n">is_json</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;Error: AI response blocked (</span><span class="si">{</span><span class="n">block_reason</span><span class="si">}</span><span class="s2">).&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (117 > 79 characters):</p>

               <a href="app.source.html#l832">
                  <tt><i>832</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI generation finished unexpectedly for &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;. Reason: </span><span class="si">{</span><span class="n">finish_reason_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l833">
                  <tt><i>833</i>             <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;Blocked: Safety&quot;</span> <span class="k">if</span> <span class="n">is_safety</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;AI stopped: </span><span class="si">{</span><span class="n">finish_reason_name</span><span class="si">}</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (127 > 79 characters):</p>

               <a href="app.source.html#l836">
                  <tt><i>836</i>                  <span class="n">ratings_str_list</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">probability</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">candidate</span><span class="o">.</span><span class="n">safety_ratings</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">blocked</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (124 > 79 characters):</p>

               <a href="app.source.html#l842">
                  <tt><i>842</i>             <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI Error&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span> <span class="k">if</span> <span class="n">is_json</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;Error: AI generation stopped (</span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="s2">).&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l848">
                  <tt><i>848</i>              <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI response content is empty for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (128 > 79 characters):</p>

               <a href="app.source.html#l853">
                  <tt><i>853</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI response was not a string for &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39; (Type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ai_text</span><span class="p">)</span><span class="si">}</span><span class="s2">). Attempting conversion.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (118 > 79 characters):</p>

               <a href="app.source.html#l862">
                  <tt><i>862</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI returned an empty string when JSON was expected for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l866">
                  <tt><i>866</i>                 <span class="n">clean_json_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^```json\s*|\s*```$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ai_text</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (133 > 79 characters):</p>

               <a href="app.source.html#l869">
                  <tt><i>869</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to decode AI JSON response for &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;. Error: </span><span class="si">{</span><span class="n">json_err</span><span class="si">}</span><span class="s2">. Raw text: &gt;&gt;&gt;</span><span class="si">{</span><span class="n">ai_text</span><span class="si">}</span><span class="s2">&lt;&lt;&lt;&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l871">
                  <tt><i>871</i>                 <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\{.*\}&#39;</span><span class="p">,</span> <span class="n">ai_text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span> <span class="c1"># Find first JSON-like object</span></tt>
               </a>
            </li><li>

               <p>Line too long (123 > 79 characters):</p>

               <a href="app.source.html#l875">
                  <tt><i>875</i>                         <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully recovered JSON object from malformed response for &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (124 > 79 characters):</p>

               <a href="app.source.html#l878">
                  <tt><i>878</i>                         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempted JSON recovery failed for &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;. Recovery error: </span><span class="si">{</span><span class="n">recovery_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l880">
                  <tt><i>880</i>                 <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;JSON Parse Fail&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">json_err</span><span class="p">),</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="n">ai_text</span><span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Line too long (100 > 79 characters):</p>

               <a href="app.source.html#l883">
                  <tt><i>883</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error processing JSON response for &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l884">
                  <tt><i>884</i>                 <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;JSON Processing Error&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="n">ai_text</span><span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Line too long (113 > 79 characters):</p>

               <a href="app.source.html#l888">
                  <tt><i>888</i>             <span class="n">cleaned</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(AI|Storyteller|Assistant|Guide):\s*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cleaned</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l890">
                  <tt><i>890</i>             <span class="k">return</span> <span class="n">cleaned</span> <span class="k">if</span> <span class="n">cleaned</span> <span class="k">else</span> <span class="s2">&quot;(The Storyteller seems lost in thought...)&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (110 > 79 characters):</p>

               <a href="app.source.html#l894">
                  <tt><i>894</i>          <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vertex AI API call failed for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">api_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (155 > 79 characters):</p>

               <a href="app.source.html#l897">
                  <tt><i>897</i>          <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI Error&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;API Call Failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">api_err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span> <span class="k">if</span> <span class="n">is_json</span> <span class="k">else</span> <span class="s2">&quot;Error: Could not communicate with the Storyteller AI.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l905">
                  <tt><i>905</i> <span class="sd">    { &quot;settings&quot;: { &quot;use_default_awl&quot;: bool, &quot;awl_color_bg&quot;: str, &quot;ai_color_bg&quot;: str },</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l914">
                  <tt><i>914</i>     <span class="n">fallback_return</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="n">default_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s2">&quot;vocab&quot;</span><span class="p">:</span> <span class="p">{}}</span> <span class="c1"># Use copy</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l917">
                  <tt><i>917</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;get_active_vocab_data called without user_id or DB connection.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l926">
                  <tt><i>926</i>         <span class="n">profile_doc</span> <span class="o">=</span> <span class="n">profile_ref</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;vocab_settings&#39;</span><span class="p">])</span> <span class="c1"># Only fetch the settings field</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l931">
                  <tt><i>931</i>                 <span class="c1"># Update settings from Firestore, keeping defaults if keys are missing</span></tt>
               </a>
            </li><li>

               <p>Line too long (121 > 79 characters):</p>

               <a href="app.source.html#l932">
                  <tt><i>932</i>                 <span class="n">user_settings</span><span class="p">[</span><span class="s1">&#39;use_default_awl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_default_awl&#39;</span><span class="p">,</span> <span class="n">user_settings</span><span class="p">[</span><span class="s1">&#39;use_default_awl&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (112 > 79 characters):</p>

               <a href="app.source.html#l933">
                  <tt><i>933</i>                 <span class="n">user_settings</span><span class="p">[</span><span class="s1">&#39;awl_color_bg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;awl_color_bg&#39;</span><span class="p">,</span> <span class="n">user_settings</span><span class="p">[</span><span class="s1">&#39;awl_color_bg&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (109 > 79 characters):</p>

               <a href="app.source.html#l934">
                  <tt><i>934</i>                 <span class="n">user_settings</span><span class="p">[</span><span class="s1">&#39;ai_color_bg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ai_color_bg&#39;</span><span class="p">,</span> <span class="n">user_settings</span><span class="p">[</span><span class="s1">&#39;ai_color_bg&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (142 > 79 characters):</p>

               <a href="app.source.html#l936">
                  <tt><i>936</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Firestore &#39;vocab_settings&#39; for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> is not a dictionary (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">settings_data</span><span class="p">)</span><span class="si">}</span><span class="s2">). Using defaults.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (116 > 79 characters):</p>

               <a href="app.source.html#l938">
                  <tt><i>938</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No profile document or vocab_settings found for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">. Using default settings.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l945">
                  <tt><i>945</i>                 <span class="c1"># We only need word, definition, and source here. Color applied later.</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l948">
                  <tt><i>948</i>                     <span class="n">definition</span> <span class="o">=</span> <span class="n">AWL_DEFINITIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lower_word</span><span class="p">,</span> <span class="s2">&quot;Definition not found.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (102 > 79 characters):</p>

               <a href="app.source.html#l949">
                  <tt><i>949</i>                     <span class="k">if</span> <span class="n">lower_word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">consolidated_vocab</span><span class="p">:</span> <span class="c1"># Avoid overwriting AI list words if same</span></tt>
               </a>
            </li><li>

               <p>Line too long (128 > 79 characters):</p>

               <a href="app.source.html#l955">
                  <tt><i>955</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AWL vocabulary enabled for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, but AWL_WORDS or AWL_DEFINITIONS data is missing.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (165 > 79 characters):</p>

               <a href="app.source.html#l961">
                  <tt><i>961</i>         <span class="n">active_ai_lists_query</span> <span class="o">=</span> <span class="n">custom_lists_ref</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">FieldFilter</span><span class="p">(</span><span class="s1">&#39;is_active&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">FieldFilter</span><span class="p">(</span><span class="s1">&#39;is_ai_generated&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">stream</span><span class="p">()</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l965">
                  <tt><i>965</i>             <span class="n">list_name</span> <span class="o">=</span> <span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;AI List&#39;</span><span class="p">)</span> <span class="c1"># Use list name as source</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l972">
                  <tt><i>972</i>                     <span class="c1"># Add word to consolidated list, overwriting AWL if same word</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l975">
                  <tt><i>975</i>                         <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">list_name</span> <span class="c1"># Use the AI list name as the source</span></tt>
               </a>
            </li><li>

               <p>Line too long (122 > 79 characters):</p>

               <a href="app.source.html#l978">
                  <tt><i>978</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping invalid word entry in list </span><span class="si">{</span><span class="n">list_doc</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">word_entry</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l981">
                  <tt><i>981</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching vocabulary data for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (120 > 79 characters):</p>

               <a href="app.source.html#l985">
                  <tt><i>985</i>     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compiled </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">consolidated_vocab</span><span class="p">)</span><span class="si">}</span><span class="s2"> active vocab words for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">. Settings: </span><span class="si">{</span><span class="n">user_settings</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l994">
                  <tt><i>994</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Database unavailable: cannot execute get_user_characters.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (100 > 79 characters):</p>

               <a href="app.source.html#l1002">
                  <tt><i>1002</i>         <span class="n">docs_query</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;characters&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">FieldFilter</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">))</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l1014">
                  <tt><i>1014</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch characters for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (100 > 79 characters):</p>

               <a href="app.source.html#l1020">
                  <tt><i>1020</i> <span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads full character data from Firestore, ensuring user ownership and initializing fields.&quot;&quot;&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (114 > 79 characters):</p>

               <a href="app.source.html#l1022">
                  <tt><i>1022</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;load_character_data missing arguments or DB connection. User: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, Char: </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (136 > 79 characters):</p>

               <a href="app.source.html#l1032">
                  <tt><i>1032</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SECURITY ALERT: User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> attempted to load character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> owned by </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l1052">
                  <tt><i>1052</i>             <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Use constant if defined, else string</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1055">
                  <tt><i>1055</i>             <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">FS_QUEST_FLAGS</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># Initialize as empty dict if missing</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1056">
                  <tt><i>1056</i>             <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">FS_INVENTORY</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Initialize as empty list if missing</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l1069">
                  <tt><i>1069</i>                 <span class="n">race_mod</span> <span class="o">=</span> <span class="n">RACE_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fate_point_mod&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l1073">
                  <tt><i>1073</i>             <span class="n">deprecated_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;xp&#39;</span><span class="p">,</span> <span class="s1">&#39;xp_next_level&#39;</span><span class="p">,</span> <span class="s1">&#39;attribute_points_to_spend&#39;</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (114 > 79 characters):</p>

               <a href="app.source.html#l1077">
                  <tt><i>1077</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;) for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l1080">
                  <tt><i>1080</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Character document </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> not found for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l1084">
                  <tt><i>1084</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l1089">
                  <tt><i>1089</i> <span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves character data to Firestore, ensuring necessary fields exist and formatting lists.&quot;&quot;&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l1091">
                  <tt><i>1091</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;save_character_data missing arguments or DB connection. User: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1095">
                  <tt><i>1095</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;save_character_data called without &#39;id&#39; in character_data.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l1104">
                  <tt><i>1104</i>         <span class="k">if</span> <span class="s1">&#39;learned_vocab&#39;</span> <span class="ow">in</span> <span class="n">save_data</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">],</span> <span class="nb">set</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l1105">
                  <tt><i>1105</i>             <span class="n">save_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">save_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]))</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l1110">
                  <tt><i>1110</i>         <span class="n">save_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">save_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CONVERSATION</span><span class="p">,</span> <span class="p">[]))[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l1112">
                  <tt><i>1112</i>         <span class="n">save_data</span><span class="p">[</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">save_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">,</span> <span class="p">[]))</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l1114">
                  <tt><i>1114</i>         <span class="n">save_data</span><span class="p">[</span><span class="n">FS_QUEST_FLAGS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">save_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_QUEST_FLAGS</span><span class="p">,</span> <span class="p">{}))</span> <span class="c1"># Ensure it&#39;s a dict</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l1115">
                  <tt><i>1115</i>         <span class="n">save_data</span><span class="p">[</span><span class="n">FS_INVENTORY</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">save_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_INVENTORY</span><span class="p">,</span> <span class="p">[]))</span> <span class="c1"># Ensure it&#39;s a list</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1118">
                  <tt><i>1118</i>         <span class="n">save_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Don&#39;t save the ID within the document data itself</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1120">
                  <tt><i>1120</i>              <span class="n">SESSION_CONVERSATION</span><span class="p">,</span> <span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_ACTIVE</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l1123">
                  <tt><i>1123</i>              <span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">,</span> <span class="n">SESSION_NEW_CHAR_DETAILS</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l1129">
                  <tt><i>1129</i>         <span class="n">deprecated_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;xp&#39;</span><span class="p">,</span> <span class="s1">&#39;xp_next_level&#39;</span><span class="p">,</span> <span class="s1">&#39;attribute_points_to_spend&#39;</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l1133">
                  <tt><i>1133</i>         <span class="c1"># Ensure core fields always exist before saving to prevent errors on load</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l1135">
                  <tt><i>1135</i>             <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Unnamed Character&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l1136">
                  <tt><i>1136</i>             <span class="s1">&#39;philosophy_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">,</span> <span class="s1">&#39;boon&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;backstory&#39;</span><span class="p">:</span> <span class="s1">&#39;A mystery.&#39;</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l1137">
                  <tt><i>1137</i>             <span class="s1">&#39;abilities&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;aspects&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;current_location&#39;</span><span class="p">:</span> <span class="n">STARTING_LOCATION</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l1138">
                  <tt><i>1138</i>             <span class="s1">&#39;current_quest_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;current_step_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;current_quest_title&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l1139">
                  <tt><i>1139</i>             <span class="s1">&#39;current_step_description&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;turn_count&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SESSION_EOC_PROMPTED</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1144">
                  <tt><i>1144</i>             <span class="n">save_data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="c1"># Set default only if key is missing</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l1146">
                  <tt><i>1146</i>         <span class="c1"># Recalculate default fate points if missing (should have been set by load_character_data)</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l1148">
                  <tt><i>1148</i>             <span class="n">race_mod</span> <span class="o">=</span> <span class="n">RACE_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">save_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fate_point_mod&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l1153">
                  <tt><i>1153</i>         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully saved character document </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l1156">
                  <tt><i>1156</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save character </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1167">
                  <tt><i>1167</i>         <span class="n">profile_doc</span> <span class="o">=</span> <span class="n">profile_ref</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;has_premium&#39;</span><span class="p">])</span> <span class="c1"># Only fetch necessary field</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1171">
                  <tt><i>1171</i>             <span class="k">return</span> <span class="kc">False</span> <span class="c1"># Default to False if profile doesn&#39;t exist or lacks field</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l1174">
                  <tt><i>1174</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during premium access check for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l1194">
                  <tt><i>1194</i> <span class="k">def</span><span class="w"> </span><span class="nf">check_step_completion</span><span class="p">(</span><span class="n">p_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">step_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l1196">
                  <tt><i>1196</i> <span class="sd">    Checks if the conditions for completing the current quest step are met based</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l1197">
                  <tt><i>1197</i> <span class="sd">    on player data (quest flags, inventory) or signals if an AI check is required.</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l1203">
                  <tt><i>1203</i>         <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;check_step_completion called with missing step_data or p_data.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (114 > 79 characters):</p>

               <a href="app.source.html#l1208">
                  <tt><i>1208</i>         <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> is missing a valid trigger condition string.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l1214">
                  <tt><i>1214</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid trigger format: &#39;</span><span class="si">{</span><span class="n">trigger</span><span class="si">}</span><span class="s2">&#39;. Expected &#39;type:condition&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (131 > 79 characters):</p>

               <a href="app.source.html#l1220">
                  <tt><i>1220</i>     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking trigger: type=&#39;</span><span class="si">{</span><span class="n">trigger_type</span><span class="si">}</span><span class="s2">&#39;, condition=&#39;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">&#39; for step </span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (102 > 79 characters):</p>

               <a href="app.source.html#l1224">
                  <tt><i>1224</i>         <span class="c1"># Expects format &quot;flag_name == True&quot; or &quot;flag_name == False&quot; (case-insensitive for True/False)</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l1225">
                  <tt><i>1225</i>         <span class="n">state_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*([\w_]+)\s*==\s*(True|False)\s*$&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l1232">
                  <tt><i>1232</i>             <span class="n">actual_value</span> <span class="o">=</span> <span class="n">quest_flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Default to False if flag not set</span></tt>
               </a>
            </li><li>

               <p>Line too long (117 > 79 characters):</p>

               <a href="app.source.html#l1234">
                  <tt><i>1234</i>             <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;State var check: Flag &#39;</span><span class="si">{</span><span class="n">flag_name</span><span class="si">}</span><span class="s2">&#39;, Expected: </span><span class="si">{</span><span class="n">expected_value</span><span class="si">}</span><span class="s2">, Actual: </span><span class="si">{</span><span class="n">actual_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (132 > 79 characters):</p>

               <a href="app.source.html#l1238">
                  <tt><i>1238</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid state_var trigger format: &#39;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">&#39;. Expected &#39;flag_name == True&#39; or &#39;flag_name == False&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l1244">
                  <tt><i>1244</i>         <span class="n">required_items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">condition</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; and &#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l1246">
                  <tt><i>1246</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid inventory_has trigger: No items specified in &#39;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l1251">
                  <tt><i>1251</i>         <span class="n">inventory_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">inventory</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inventory</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">))</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span></tt>
               </a>
            </li><li>

               <p>Line too long (141 > 79 characters):</p>

               <a href="app.source.html#l1261">
                  <tt><i>1261</i>             <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inventory check failed: Missing item(s) </span><span class="si">{</span><span class="n">missing_items</span><span class="si">}</span><span class="s2">. Required: </span><span class="si">{</span><span class="n">required_items</span><span class="si">}</span><span class="s2">, Has: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">inventory_set</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l1267">
                  <tt><i>1267</i>         <span class="c1"># Return False for completion status *for now*, but provide the criteria string</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l1268">
                  <tt><i>1268</i>         <span class="c1"># The game loop will perform the check based on the player&#39;s action this turn.</span></tt>
               </a>
            </li><li>

               <p>Line too long (125 > 79 characters):</p>

               <a href="app.source.html#l1271">
                  <tt><i>1271</i>              <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI Check trigger found for step </span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> but condition is empty.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (120 > 79 characters):</p>

               <a href="app.source.html#l1274">
                  <tt><i>1274</i>         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI Check trigger identified. Criteria: &#39;</span><span class="si">{</span><span class="n">ai_check_criteria</span><span class="si">}</span><span class="s2">&#39;. Evaluation required in game loop.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l1279">
                  <tt><i>1279</i>         <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown trigger condition type: &#39;</span><span class="si">{</span><span class="n">trigger_type</span><span class="si">}</span><span class="s2">&#39; in trigger &#39;</span><span class="si">{</span><span class="n">trigger</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1286">
                  <tt><i>1286</i> <span class="k">def</span><span class="w"> </span><span class="nf">apply_reward</span><span class="p">(</span><span class="n">p_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">reward_data</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l1290">
                  <tt><i>1290</i> <span class="sd">    Returns announcement text (str) or None if silent/invalid. Modifies p_data directly.</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l1302">
                  <tt><i>1302</i>     <span class="n">silent</span> <span class="o">=</span> <span class="n">reward_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;silent&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Check if reward announcement should be suppressed</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l1307">
                  <tt><i>1307</i>     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying reward: </span><span class="si">{</span><span class="n">reward_data</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id_log</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (165 > 79 characters):</p>

               <a href="app.source.html#l1317">
                  <tt><i>1317</i>                          <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Character </span><span class="si">{</span><span class="n">char_id_log</span><span class="si">}</span><span class="s2"> fate_points field is not numeric (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">current_fp</span><span class="p">)</span><span class="si">}</span><span class="s2">). Resetting to base before applying change.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (143 > 79 characters):</p>

               <a href="app.source.html#l1321">
                  <tt><i>1321</i>                         <span class="n">announcement</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;You gain </span><span class="si">{</span><span class="n">fp_change</span><span class="si">}</span><span class="s2"> Fate Point(s).&quot;</span> <span class="k">if</span> <span class="n">fp_change</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;You lose </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">fp_change</span><span class="p">)</span><span class="si">}</span><span class="s2"> Fate Point(s).&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (113 > 79 characters):</p>

               <a href="app.source.html#l1322">
                  <tt><i>1322</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Applied </span><span class="si">{</span><span class="n">fp_change</span><span class="si">}</span><span class="s2"> Fate Points reward. New total: </span><span class="si">{</span><span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;fate_points&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1324">
                  <tt><i>1324</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Invalid &#39;value&#39; for fate_points reward: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1329">
                  <tt><i>1329</i>                 <span class="n">announcement</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Info: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Use details as the announcement</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1336">
                  <tt><i>1336</i>                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flag_value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Line too long (107 > 79 characters):</p>

               <a href="app.source.html#l1338">
                  <tt><i>1338</i>                          <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Set quest flag &#39;</span><span class="si">{</span><span class="n">flag_name</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">flag_value</span><span class="si">}</span><span class="s2">&#39; via info reward.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (186 > 79 characters):</p>

               <a href="app.source.html#l1340">
                  <tt><i>1340</i>                          <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Invalid flag name (&#39;</span><span class="si">{</span><span class="n">flag_name</span><span class="si">}</span><span class="s2">&#39;) or value (&#39;</span><span class="si">{</span><span class="n">flag_value</span><span class="si">}</span><span class="s2">&#39;) in &#39;set_flag&#39; for info reward. Flag name must be string, value must be boolean.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l1341">
                  <tt><i>1341</i>             <span class="k">elif</span> <span class="n">flag_to_set_data</span><span class="p">:</span> <span class="c1"># Log warning if format is wrong but it exists</span></tt>
               </a>
            </li><li>

               <p>Line too long (151 > 79 characters):</p>

               <a href="app.source.html#l1342">
                  <tt><i>1342</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Invalid &#39;set_flag&#39; format in info reward: </span><span class="si">{</span><span class="n">flag_to_set_data</span><span class="si">}</span><span class="s2">. Expected a dictionary </span><span class="se">{{</span><span class="s2">&#39;flag_name&#39;: True/False</span><span class="se">}}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (121 > 79 characters):</p>

               <a href="app.source.html#l1355">
                  <tt><i>1355</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Character </span><span class="si">{</span><span class="n">char_id_log</span><span class="si">}</span><span class="s2"> inventory field is not a list. Cannot add item &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l1357">
                  <tt><i>1357</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Item reward specified but &#39;name&#39; is missing or not a string: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (120 > 79 characters):</p>

               <a href="app.source.html#l1365">
                  <tt><i>1365</i>                         <span class="n">flag_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;relationship_</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Create a unique, clean flag name</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l1367">
                  <tt><i>1367</i>                         <span class="n">current_value</span> <span class="o">=</span> <span class="n">quest_flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Default to 0</span></tt>
               </a>
            </li><li>

               <p>Line too long (167 > 79 characters):</p>

               <a href="app.source.html#l1369">
                  <tt><i>1369</i>                             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Relationship flag &#39;</span><span class="si">{</span><span class="n">flag_name</span><span class="si">}</span><span class="s2">&#39; has non-numeric value (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">current_value</span><span class="p">)</span><span class="si">}</span><span class="s2">). Resetting to 0 before applying change.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (127 > 79 characters):</p>

               <a href="app.source.html#l1374">
                  <tt><i>1374</i>                             <span class="n">announcement</span> <span class="o">=</span> <span class="n">details</span> <span class="k">if</span> <span class="n">details</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;Your relationship with </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> changed (</span><span class="si">{</span><span class="n">rel_change</span><span class="si">:</span><span class="s2">+</span><span class="si">}</span><span class="s2">).&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (145 > 79 characters):</p>

               <a href="app.source.html#l1375">
                  <tt><i>1375</i>                         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Applied relationship change for &#39;</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&#39; by </span><span class="si">{</span><span class="n">rel_change</span><span class="si">}</span><span class="s2">. New value: </span><span class="si">{</span><span class="n">new_value</span><span class="si">}</span><span class="s2"> (Flag: </span><span class="si">{</span><span class="n">flag_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l1377">
                  <tt><i>1377</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Invalid &#39;change&#39; value for relationship reward: </span><span class="si">{</span><span class="n">change</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (117 > 79 characters):</p>

               <a href="app.source.html#l1379">
                  <tt><i>1379</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Relationship reward specified but &#39;target&#39; is missing or not a string: </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (104 > 79 characters):</p>

               <a href="app.source.html#l1385">
                  <tt><i>1385</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error applying reward </span><span class="si">{</span><span class="n">reward_data</span><span class="si">}</span><span class="s2"> for char </span><span class="si">{</span><span class="n">char_id_log</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l1386">
                  <tt><i>1386</i>         <span class="n">announcement</span> <span class="o">=</span> <span class="s2">&quot;An error occurred while processing a reward.&quot;</span> <span class="c1"># Generic error for user</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l1417">
                  <tt><i>1417</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2"> found, proceeding with login for UID: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l1419">
                  <tt><i>1419</i>             <span class="c1"># Since the Admin SDK can&#39;t directly verify passwords, this remains a placeholder</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l1420">
                  <tt><i>1420</i>             <span class="c1"># for a more secure flow (e.g., using a client-side library to sign in and</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l1421">
                  <tt><i>1421</i>             <span class="c1"># then sending the token to the backend). The warning is updated to reflect this.</span></tt>
               </a>
            </li><li>

               <p>Line too long (158 > 79 characters):</p>

               <a href="app.source.html#l1422">
                  <tt><i>1422</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SECURITY-NOTE: Password for </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2"> is NOT verified by this backend logic. A secure frontend-to-backend auth flow is required.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1434">
                  <tt><i>1434</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Login attempt failed for non-existent user: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l1437">
                  <tt><i>1437</i>             <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;An unexpected error occurred during login. Please try again.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (103 > 79 characters):</p>

               <a href="app.source.html#l1438">
                  <tt><i>1438</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred during login for </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l1457">
                  <tt><i>1457</i>             <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Please provide a valid email and a password (at least 6 characters).&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1461">
                  <tt><i>1461</i>             <span class="n">user</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="n">firebase_app</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l1462">
                  <tt><i>1462</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New Firebase Auth user created: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l1470">
                  <tt><i>1470</i>                     <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">firestore</span><span class="o">.</span><span class="n">SERVER_TIMESTAMP</span><span class="p">,</span> <span class="c1"># Record creation time</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l1472">
                  <tt><i>1472</i>                     <span class="s1">&#39;vocab_settings&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;use_default_awl&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="c1"># Default vocab setting</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l1473">
                  <tt><i>1473</i>                     <span class="n">FS_PLAYER_HAS_SEEN_INTRO</span><span class="p">:</span> <span class="kc">False</span>  <span class="c1"># &lt;&lt;&lt; REVISED: Set intro flag to False &gt;&gt;&gt;</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1475">
                  <tt><i>1475</i>                 <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;player_profiles&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">profile_data</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (120 > 79 characters):</p>

               <a href="app.source.html#l1476">
                  <tt><i>1476</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Firestore player profile created for </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2"> (with </span><span class="si">{</span><span class="n">FS_PLAYER_HAS_SEEN_INTRO</span><span class="si">}</span><span class="s2">=False)&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l1477">
                  <tt><i>1477</i>                 <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Account created successfully! Please log in.&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (117 > 79 characters):</p>

               <a href="app.source.html#l1481">
                  <tt><i>1481</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create Firestore profile for new user </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">db_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (129 > 79 characters):</p>

               <a href="app.source.html#l1482">
                  <tt><i>1482</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Account created, but profile initialization failed. Please contact support if issues persist.&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l1486">
                  <tt><i>1486</i>             <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Signup failed: This email address is already registered.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l1511">
                  <tt><i>1511</i>         <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Use pop with default None to avoid errors if key missing</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l1535">
                  <tt><i>1535</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> attempting to load character: </span><span class="si">{</span><span class="n">char_id_to_load</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1541">
                  <tt><i>1541</i>                     <span class="n">SESSION_LAST_AI_OUTPUT</span><span class="p">,</span> <span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l1542">
                  <tt><i>1542</i>                     <span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="n">SESSION_EOC_PROMPTED</span><span class="p">,</span> <span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l1551">
                  <tt><i>1551</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LOCATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_location&#39;</span><span class="p">,</span> <span class="n">STARTING_LOCATION</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l1552">
                  <tt><i>1552</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CONVERSATION</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Load convo log</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l1553">
                  <tt><i>1553</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Load chapter inputs</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l1556">
                  <tt><i>1556</i>                 <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Character &#39;</span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; loaded successfully.&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l1563">
                  <tt><i>1563</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> initiating custom character creation.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (104 > 79 characters):</p>

               <a href="app.source.html#l1577">
                  <tt><i>1577</i>             <span class="n">template</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">premade_character_templates</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">premade_id</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (100 > 79 characters):</p>

               <a href="app.source.html#l1579">
                  <tt><i>1579</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> selected invalid pre-made template ID: </span><span class="si">{</span><span class="n">premade_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (131 > 79 characters):</p>

               <a href="app.source.html#l1583">
                  <tt><i>1583</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> creating character from pre-made template: </span><span class="si">{</span><span class="n">premade_id</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">template</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;)&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l1604">
                  <tt><i>1604</i>             <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">new_char_data</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">]):</span></tt>
               </a>
            </li><li>

               <p>Line too long (114 > 79 characters):</p>

               <a href="app.source.html#l1605">
                  <tt><i>1605</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pre-made template &#39;</span><span class="si">{</span><span class="n">premade_id</span><span class="si">}</span><span class="s2">&#39; is missing required Race/Class/Philosophy name.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (109 > 79 characters):</p>

               <a href="app.source.html#l1606">
                  <tt><i>1606</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Selected pre-made character template is incomplete. Please contact support.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (100 > 79 characters):</p>

               <a href="app.source.html#l1610">
                  <tt><i>1610</i>             <span class="n">race_abilities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">RACE_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new_char_data</span><span class="p">[</span><span class="s1">&#39;race_name&#39;</span><span class="p">],</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abilities&#39;</span><span class="p">,</span> <span class="p">[]))</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l1611">
                  <tt><i>1611</i>             <span class="n">class_ability</span> <span class="o">=</span> <span class="n">CLASS_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new_char_data</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">],</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ability&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l1612">
                  <tt><i>1612</i>             <span class="n">phil_ability</span> <span class="o">=</span> <span class="n">PHILOSOPHY_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new_char_data</span><span class="p">[</span><span class="s1">&#39;philosophy_name&#39;</span><span class="p">],</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ability&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l1618">
                  <tt><i>1618</i>             <span class="n">class_focus</span> <span class="o">=</span> <span class="n">CLASS_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new_char_data</span><span class="p">[</span><span class="s1">&#39;class_name&#39;</span><span class="p">],</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;focus&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (121 > 79 characters):</p>

               <a href="app.source.html#l1620">
                  <tt><i>1620</i>             <span class="k">if</span> <span class="s2">&quot;Artistic Shell&quot;</span> <span class="ow">in</span> <span class="n">new_char_data</span><span class="p">[</span><span class="s1">&#39;abilities&#39;</span><span class="p">]:</span> <span class="n">aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Shell Design: Undefined&quot;</span><span class="p">)</span> <span class="c1"># Example aspect</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l1623">
                  <tt><i>1623</i>             <span class="n">race_mod</span> <span class="o">=</span> <span class="n">RACE_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">new_char_data</span><span class="p">[</span><span class="s1">&#39;race_name&#39;</span><span class="p">],</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fate_point_mod&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l1628">
                  <tt><i>1628</i>             <span class="n">start_s_id</span><span class="p">,</span> <span class="n">start_s_desc</span><span class="p">,</span> <span class="n">start_q_title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Begin your journey.&quot;</span><span class="p">,</span> <span class="s2">&quot;Starting Quest&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l1637">
                  <tt><i>1637</i>                              <span class="n">start_s_desc</span> <span class="o">=</span> <span class="n">start_s_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;Begin your journey.&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (279 > 79 characters):</p>

               <a href="app.source.html#l1652">
                  <tt><i>1652</i>                     <span class="n">keys_to_clear</span> <span class="o">=</span> <span class="p">[</span> <span class="n">SESSION_LAST_AI_OUTPUT</span><span class="p">,</span> <span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="n">SESSION_EOC_PROMPTED</span><span class="p">,</span> <span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">,</span> <span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_ACTIVE</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_TURNS</span> <span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l1656">
                  <tt><i>1656</i>                     <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LOCATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_location&#39;</span><span class="p">,</span> <span class="n">STARTING_LOCATION</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1657">
                  <tt><i>1657</i>                     <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CONVERSATION</span><span class="p">,</span> <span class="p">[])</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l1658">
                  <tt><i>1658</i>                     <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">,</span> <span class="p">[])</span></tt>
               </a>
            </li><li>

               <p>Line too long (106 > 79 characters):</p>

               <a href="app.source.html#l1660">
                  <tt><i>1660</i>                     <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pre-made character &#39;</span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; created and loaded!&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l1663">
                  <tt><i>1663</i>                     <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Character created but failed to load. Please try loading from profile.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l1671">
                  <tt><i>1671</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> attempting to save vocabulary color settings.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (109 > 79 characters):</p>

               <a href="app.source.html#l1676">
                  <tt><i>1676</i>             <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^#[0-9a-fA-F]</span><span class="si">{6}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">awl_color</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^#[0-9a-fA-F]</span><span class="si">{6}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">ai_color</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l1677">
                  <tt><i>1677</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Invalid color format submitted. Please use the color picker.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l1681">
                  <tt><i>1681</i>                 <span class="n">profile_ref</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;player_profiles&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1682">
                  <tt><i>1682</i>                 <span class="c1"># Use set with merge=True to update or add the vocab_settings field</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l1689">
                  <tt><i>1689</i>                         <span class="c1"># If you add a toggle for that, fetch existing settings first.</span></tt>
               </a>
            </li><li>

               <p>Line too long (110 > 79 characters):</p>

               <a href="app.source.html#l1692">
                  <tt><i>1692</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved vocab color settings for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: AWL=</span><span class="si">{</span><span class="n">awl_color</span><span class="si">}</span><span class="s2">, AI=</span><span class="si">{</span><span class="n">ai_color</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l1695">
                  <tt><i>1695</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save vocab color settings for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l1696">
                  <tt><i>1696</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;An error occurred while saving color settings.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l1726">
                  <tt><i>1726</i>                 <span class="n">profile_doc_ref</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;player_profiles&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (122 > 79 characters):</p>

               <a href="app.source.html#l1728">
                  <tt><i>1728</i>                 <span class="n">p_doc</span> <span class="o">=</span> <span class="n">profile_doc_ref</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;player_level&#39;</span><span class="p">,</span> <span class="s1">&#39;total_player_xp&#39;</span><span class="p">,</span> <span class="s1">&#39;has_premium&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;vocab_settings&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l1732">
                  <tt><i>1732</i>                     <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;player_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;player_level&#39;</span><span class="p">,</span> <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;player_level&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (117 > 79 characters):</p>

               <a href="app.source.html#l1733">
                  <tt><i>1733</i>                     <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;total_player_xp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_player_xp&#39;</span><span class="p">,</span> <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;total_player_xp&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l1734">
                  <tt><i>1734</i>                     <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;has_premium&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;has_premium&#39;</span><span class="p">,</span> <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;has_premium&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l1735">
                  <tt><i>1735</i>                     <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fs_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l1737">
                  <tt><i>1737</i>                     <span class="c1"># Carefully update vocab_settings, preserving existing keys and adding defaults</span></tt>
               </a>
            </li><li>

               <p>Line too long (164 > 79 characters):</p>

               <a href="app.source.html#l1740">
                  <tt><i>1740</i>                         <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;vocab_settings&#39;</span><span class="p">][</span><span class="s1">&#39;use_default_awl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saved_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_default_awl&#39;</span><span class="p">,</span> <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;vocab_settings&#39;</span><span class="p">][</span><span class="s1">&#39;use_default_awl&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (155 > 79 characters):</p>

               <a href="app.source.html#l1741">
                  <tt><i>1741</i>                         <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;vocab_settings&#39;</span><span class="p">][</span><span class="s1">&#39;awl_color_bg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saved_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;awl_color_bg&#39;</span><span class="p">,</span> <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;vocab_settings&#39;</span><span class="p">][</span><span class="s1">&#39;awl_color_bg&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (152 > 79 characters):</p>

               <a href="app.source.html#l1742">
                  <tt><i>1742</i>                         <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;vocab_settings&#39;</span><span class="p">][</span><span class="s1">&#39;ai_color_bg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">saved_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ai_color_bg&#39;</span><span class="p">,</span> <span class="n">profile_data</span><span class="p">[</span><span class="s1">&#39;vocab_settings&#39;</span><span class="p">][</span><span class="s1">&#39;ai_color_bg&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (146 > 79 characters):</p>

               <a href="app.source.html#l1744">
                  <tt><i>1744</i>                         <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vocab settings for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> in Firestore is not a dict (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">saved_settings</span><span class="p">)</span><span class="si">}</span><span class="s2">). Using defaults.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (103 > 79 characters):</p>

               <a href="app.source.html#l1746">
                  <tt><i>1746</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player profile document not found for logged-in user: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1747">
                  <tt><i>1747</i>                     <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Could not load your player profile details.&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (103 > 79 characters):</p>

               <a href="app.source.html#l1749">
                  <tt><i>1749</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch player profile for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l1755">
                  <tt><i>1755</i>             <span class="n">profile</span><span class="o">=</span><span class="n">profile_data</span><span class="p">,</span> <span class="c1"># Pass the full profile data, including vocab_settings</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l1766">
                  <tt><i>1766</i>     <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entering character_creation_view. Method: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l1771">
                  <tt><i>1771</i>         <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POST request received. creation_stage = </span><span class="si">{</span><span class="n">creation_stage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l1775">
                  <tt><i>1775</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> submitting custom character details for AI review.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (118 > 79 characters):</p>

               <a href="app.source.html#l1779">
                  <tt><i>1779</i>                 <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;boon&#39;</span><span class="p">,</span> <span class="s1">&#39;backstory&#39;</span><span class="p">,</span> <span class="s1">&#39;starting_quest&#39;</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (123 > 79 characters):</p>

               <a href="app.source.html#l1783">
                  <tt><i>1783</i>             <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;boon&#39;</span><span class="p">,</span> <span class="s1">&#39;backstory&#39;</span><span class="p">,</span> <span class="s1">&#39;starting_quest&#39;</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l1784">
                  <tt><i>1784</i>             <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">required_fields</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">char_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field</span><span class="p">)]</span></tt>
               </a>
            </li><li>

               <p>Line too long (112 > 79 characters):</p>

               <a href="app.source.html#l1786">
                  <tt><i>1786</i>                 <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please fill out all character detail fields (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> missing).&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l1787">
                  <tt><i>1787</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Validation failed, re-rendering template with errors.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l1788">
                  <tt><i>1788</i>                 <span class="c1"># Render as if initial stage (reviewing=False, no recommendations)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l1802">
                  <tt><i>1802</i>             <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored char_details in session: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1804">
                  <tt><i>1804</i>             <span class="n">ai_response</span> <span class="o">=</span> <span class="n">get_ai_response</span><span class="p">(</span><span class="s2">&quot;REVIEW_CHARACTER_SHEET&quot;</span><span class="p">,</span> <span class="n">review_context</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l1809">
                  <tt><i>1809</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI review returned </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">recommendations</span><span class="p">)</span><span class="si">}</span><span class="s2"> recommendations.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l1810">
                  <tt><i>1810</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;AI has reviewed your character concept. See suggestions below.&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (138 > 79 characters):</p>

               <a href="app.source.html#l1812">
                  <tt><i>1812</i>                 <span class="n">error_reason</span> <span class="o">=</span> <span class="n">ai_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ai_response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;AI communication failure&#39;</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l1813">
                  <tt><i>1813</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI character review failed. Reason: </span><span class="si">{</span><span class="n">error_reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (123 > 79 characters):</p>

               <a href="app.source.html#l1814">
                  <tt><i>1814</i>                 <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI couldn&#39;t review your concept (</span><span class="si">{</span><span class="n">error_reason</span><span class="si">}</span><span class="s2">). You can finalize, edit, or start over.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (109 > 79 characters):</p>

               <a href="app.source.html#l1819">
                  <tt><i>1819</i>             <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored ai_recommendations in session: </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (149 > 79 characters):</p>

               <a href="app.source.html#l1840">
                  <tt><i>1840</i>             <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session after clearing: details=</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">)</span><span class="si">}</span><span class="s2">, recs=</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (163 > 79 characters):</p>

               <a href="app.source.html#l1849">
                  <tt><i>1849</i>             <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session after clearing recs for edit: details=</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">)</span><span class="si">}</span><span class="s2">, recs=</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l1850">
                  <tt><i>1850</i>             <span class="c1"># Redirect back to the GET handler, which will now render editable fields</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l1855">
                  <tt><i>1855</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> attempting to finalize custom character.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1857">
                  <tt><i>1857</i>             <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved final_details from session: </span><span class="si">{</span><span class="n">final_details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l1859">
                  <tt><i>1859</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Character details were lost. Please start over.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l1886">
                  <tt><i>1886</i>             <span class="n">start_goal</span> <span class="o">=</span> <span class="n">final_char_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;starting_quest&#39;</span><span class="p">,</span> <span class="s1">&#39;Find purpose&#39;</span><span class="p">)</span> <span class="c1"># Use form input</span></tt>
               </a>
            </li><li>

               <p>Line too long (113 > 79 characters):</p>

               <a href="app.source.html#l1889">
                  <tt><i>1889</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required character detail (Race/Class/Philosophy). Please start over.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (147 > 79 characters):</p>

               <a href="app.source.html#l1890">
                  <tt><i>1890</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing essential name(s) finalizing character for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: R=</span><span class="si">{</span><span class="n">race_name</span><span class="si">}</span><span class="s2">, C=</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">, P=</span><span class="si">{</span><span class="n">philosophy_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l1898">
                  <tt><i>1898</i>                 <span class="n">race_abilities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">RACE_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">race_name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abilities&#39;</span><span class="p">,</span> <span class="p">[]))</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l1900">
                  <tt><i>1900</i>                 <span class="n">phil_ability</span> <span class="o">=</span> <span class="n">PHILOSOPHY_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">philosophy_name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ability&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (120 > 79 characters):</p>

               <a href="app.source.html#l1908">
                  <tt><i>1908</i>                 <span class="k">if</span> <span class="s2">&quot;Artistic Shell&quot;</span> <span class="ow">in</span> <span class="n">final_char_data</span><span class="p">[</span><span class="s1">&#39;abilities&#39;</span><span class="p">]:</span> <span class="n">aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Shell Design: Undefined&quot;</span><span class="p">)</span> <span class="c1"># Example</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l1911">
                  <tt><i>1911</i>                 <span class="n">race_mod</span> <span class="o">=</span> <span class="n">RACE_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">race_name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fate_point_mod&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l1915">
                  <tt><i>1915</i>                 <span class="n">final_char_data</span><span class="p">[</span><span class="s1">&#39;current_quest_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Q_CH1_</span><span class="si">{</span><span class="n">new_char_id</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Unique ID</span></tt>
               </a>
            </li><li>

               <p>Line too long (106 > 79 characters):</p>

               <a href="app.source.html#l1916">
                  <tt><i>1916</i>                 <span class="n">final_char_data</span><span class="p">[</span><span class="s1">&#39;current_quest_title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Chapter 1: </span><span class="si">{</span><span class="n">start_goal</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span> <span class="c1"># Title from goal</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l1918">
                  <tt><i>1918</i>                 <span class="n">final_char_data</span><span class="p">[</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_goal</span> <span class="c1"># Step desc from goal</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l1921">
                  <tt><i>1921</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Internal data error finding details for </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Please check selections.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l1922">
                  <tt><i>1922</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KeyError finalizing character for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (106 > 79 characters):</p>

               <a href="app.source.html#l1928">
                  <tt><i>1928</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred calculating character stats: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Please start over.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l1929">
                  <tt><i>1929</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calculating derived fields for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l1939">
                  <tt><i>1939</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Character saved successfully with ID: </span><span class="si">{</span><span class="n">saved_id</span><span class="si">}</span><span class="s2">. Clearing session.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (118 > 79 characters):</p>

               <a href="app.source.html#l1944">
                  <tt><i>1944</i>                 <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Custom character &#39;</span><span class="si">{</span><span class="n">final_char_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; created successfully!&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l1945">
                  <tt><i>1945</i>                 <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span> <span class="c1"># Go back to profile after creation</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l1947">
                  <tt><i>1947</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Failed to save the finalized character. Please try again.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l1948">
                  <tt><i>1948</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;save_character_data returned None during finalization.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l1955">
                  <tt><i>1955</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid creation_stage &#39;</span><span class="si">{</span><span class="n">creation_stage</span><span class="si">}</span><span class="s2">&#39; received.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (116 > 79 characters):</p>

               <a href="app.source.html#l1966">
                  <tt><i>1966</i>         <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Session values: details=</span><span class="si">{</span><span class="n">char_details_from_session</span><span class="si">}</span><span class="s2">, recs=</span><span class="si">{</span><span class="n">recommendations_from_session</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l1969">
                  <tt><i>1969</i>         <span class="n">is_reviewing_stage</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">char_details_from_session</span> <span class="ow">and</span> <span class="n">recommendations_from_session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l1973">
                  <tt><i>1973</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rendering creation page. Reviewing=</span><span class="si">{</span><span class="n">is_reviewing_stage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l1980">
                  <tt><i>1980</i>                 <span class="n">ai_recommendations</span><span class="o">=</span><span class="n">recommendations_from_session</span><span class="p">,</span> <span class="c1"># Pass recommendations if they exist</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l2007">
                  <tt><i>2007</i>         <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Non-premium user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> attempted AI vocabulary generation.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (106 > 79 characters):</p>

               <a href="app.source.html#l2008">
                  <tt><i>2008</i>         <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI vocabulary generation is a premium feature.&quot;</span><span class="p">}),</span> <span class="mi">403</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2012">
                  <tt><i>2012</i>         <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Please provide a target word.&quot;</span><span class="p">}),</span> <span class="mi">400</span></tt>
               </a>
            </li><li>

               <p>Line too long (109 > 79 characters):</p>

               <a href="app.source.html#l2014">
                  <tt><i>2014</i>     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> requesting AI vocabulary list generation for target word: &#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (123 > 79 characters):</p>

               <a href="app.source.html#l2024">
                  <tt><i>2024</i>             <span class="n">target_info</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">target_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;word&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">target_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;definition&#39;</span><span class="p">)</span> <span class="ow">and</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l2025">
                  <tt><i>2025</i>             <span class="n">related_words</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">related_words</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">related_words</span><span class="p">)</span> <span class="o">==</span> <span class="mi">25</span> <span class="ow">and</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l2026">
                  <tt><i>2026</i>             <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;word&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">w</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;definition&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">related_words</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (164 > 79 characters):</p>

               <a href="app.source.html#l2029">
                  <tt><i>2029</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI vocabulary generation for &#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39; returned incomplete or invalid data structure for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">. Response: </span><span class="si">{</span><span class="n">ai_response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (129 > 79 characters):</p>

               <a href="app.source.html#l2030">
                  <tt><i>2030</i>             <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI failed to generate the vocabulary list in the expected format.&quot;</span><span class="p">}),</span> <span class="mi">500</span></tt>
               </a>
            </li><li>

               <p>Line too long (112 > 79 characters):</p>

               <a href="app.source.html#l2033">
                  <tt><i>2033</i>         <span class="n">word_list_data</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;word&quot;</span><span class="p">:</span> <span class="n">target_info</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">],</span><span class="s2">&quot;definition&quot;</span><span class="p">:</span> <span class="n">target_info</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">]}]</span> <span class="o">+</span> <span class="n">related_words</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2034">
                  <tt><i>2034</i>         <span class="n">list_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ai_</span><span class="si">{</span><span class="n">target_word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (118 > 79 characters):</p>

               <a href="app.source.html#l2039">
                  <tt><i>2039</i>             <span class="s2">&quot;is_ai_generated&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">firestore</span><span class="o">.</span><span class="n">SERVER_TIMESTAMP</span><span class="p">,</span> <span class="s2">&quot;is_active&quot;</span><span class="p">:</span> <span class="kc">True</span> <span class="c1"># Activate by default</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l2045">
                  <tt><i>2045</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully saved AI generated vocabulary list </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l2046">
                  <tt><i>2046</i>             <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI vocabulary list based on &#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39; created successfully!&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (156 > 79 characters):</p>

               <a href="app.source.html#l2047">
                  <tt><i>2047</i>             <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Vocabulary list for &#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39; created!&quot;</span><span class="p">,</span> <span class="s2">&quot;list_id&quot;</span><span class="p">:</span> <span class="n">list_id</span><span class="p">,</span> <span class="s2">&quot;list_name&quot;</span><span class="p">:</span> <span class="n">list_name</span> <span class="p">}),</span> <span class="mi">200</span></tt>
               </a>
            </li><li>

               <p>Line too long (122 > 79 characters):</p>

               <a href="app.source.html#l2049">
                  <tt><i>2049</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save generated AI vocabulary list </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (125 > 79 characters):</p>

               <a href="app.source.html#l2050">
                  <tt><i>2050</i>             <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to save the generated vocabulary list to your profile.&quot;</span><span class="p">}),</span> <span class="mi">500</span></tt>
               </a>
            </li><li>

               <p>Line too long (132 > 79 characters):</p>

               <a href="app.source.html#l2053">
                  <tt><i>2053</i>         <span class="n">error_reason</span> <span class="o">=</span> <span class="n">ai_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span><span class="s1">&#39;Unknown AI error&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ai_response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;AI communication failure&#39;</span></tt>
               </a>
            </li><li>

               <p>Line too long (129 > 79 characters):</p>

               <a href="app.source.html#l2054">
                  <tt><i>2054</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI vocabulary generation failed for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, target word &#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39;. Reason: </span><span class="si">{</span><span class="n">error_reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (119 > 79 characters):</p>

               <a href="app.source.html#l2055">
                  <tt><i>2055</i>         <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;AI Storyteller could not generate the list: </span><span class="si">{</span><span class="n">error_reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}),</span> <span class="mi">500</span></tt>
               </a>
            </li><li>

               <p>Line too long (120 > 79 characters):</p>

               <a href="app.source.html#l2066">
                  <tt><i>2066</i>         <span class="n">list_ref</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;player_profiles&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;custom_vocab_lists&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">list_id</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (103 > 79 characters):</p>

               <a href="app.source.html#l2069">
                  <tt><i>2069</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt to toggle non-existent vocab list </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l2070">
                  <tt><i>2070</i>             <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Vocabulary list not found.&quot;</span><span class="p">}),</span> <span class="mi">404</span></tt>
               </a>
            </li><li>

               <p>Line too long (117 > 79 characters):</p>

               <a href="app.source.html#l2074">
                  <tt><i>2074</i>         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Toggled vocab list </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="s1">&#39;active&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">new_status</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;inactive&#39;</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l2078">
                  <tt><i>2078</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error toggling vocabulary list </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (100 > 79 characters):</p>

               <a href="app.source.html#l2079">
                  <tt><i>2079</i>         <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to update vocabulary list status.&quot;</span><span class="p">}),</span> <span class="mi">500</span></tt>
               </a>
            </li><li>

               <p>Line too long (120 > 79 characters):</p>

               <a href="app.source.html#l2088">
                  <tt><i>2088</i>         <span class="n">list_ref</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;player_profiles&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;custom_vocab_lists&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">list_id</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (103 > 79 characters):</p>

               <a href="app.source.html#l2091">
                  <tt><i>2091</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt to delete non-existent vocab list </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l2092">
                  <tt><i>2092</i>             <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Vocabulary list not found.&quot;</span><span class="p">}),</span> <span class="mi">404</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l2095">
                  <tt><i>2095</i>         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleted vocabulary list </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">list_name</span><span class="si">}</span><span class="s2">&#39;) for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l2096">
                  <tt><i>2096</i>         <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vocabulary list &#39;</span><span class="si">{</span><span class="n">list_name</span><span class="si">}</span><span class="s2">&#39; deleted.&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span> <span class="c1"># User feedback</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2097">
                  <tt><i>2097</i>         <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;List &#39;</span><span class="si">{</span><span class="n">list_name</span><span class="si">}</span><span class="s2">&#39; deleted.&quot;</span><span class="p">}),</span> <span class="mi">200</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l2099">
                  <tt><i>2099</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting vocabulary list </span><span class="si">{</span><span class="n">list_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l2100">
                  <tt><i>2100</i>         <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to delete vocabulary list.&quot;</span><span class="p">}),</span> <span class="mi">500</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l2111">
                  <tt><i>2111</i>         <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;No character is currently loaded. Please select one from your profile.&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2117">
                  <tt><i>2117</i>         <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_CHARACTER_ID</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Clear invalid character ID from session</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2126">
                  <tt><i>2126</i>     <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LOCATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_location&#39;</span><span class="p">,</span> <span class="n">STARTING_LOCATION</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l2129">
                  <tt><i>2129</i>     <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_ACTIVE</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_SIDE_QUEST_ACTIVE</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2130">
                  <tt><i>2130</i>     <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2131">
                  <tt><i>2131</i>     <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_TURNS</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_SIDE_QUEST_TURNS</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2133">
                  <tt><i>2133</i>     <span class="n">curr_loc</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LOCATION</span><span class="p">]</span> <span class="c1"># Use local variable for current location</span></tt>
               </a>
            </li><li>

               <p>Line too long (113 > 79 characters):</p>

               <a href="app.source.html#l2147">
                  <tt><i>2147</i>             <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;Input too long (Max </span><span class="si">{</span><span class="n">MAX_INPUT_LENGTH</span><span class="si">}</span><span class="s2">). Be concise.&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l2152">
                  <tt><i>2152</i>             <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span> <span class="c1"># Save after adding system message</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2158">
                  <tt><i>2158</i>             <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Reset flag regardless of answer</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2163">
                  <tt><i>2163</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> accepted AI-suggested EOC for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l2165">
                  <tt><i>2165</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span> <span class="c1"># Set session state to start EOC</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2166">
                  <tt><i>2166</i>                 <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span> <span class="c1"># Save reset flag/turn count</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2169">
                  <tt><i>2169</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> declined AI-suggested EOC for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l2170">
                  <tt><i>2170</i>                 <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Okay, continuing the adventure!&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l2172">
                  <tt><i>2172</i>                 <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span> <span class="c1"># Update persistent log</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2173">
                  <tt><i>2173</i>                 <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span> <span class="c1"># Save reset flag &amp; message</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2176">
                  <tt><i>2176</i>                 <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;Player&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">p_input</span><span class="p">})</span> <span class="c1"># Log their input</span></tt>
               </a>
            </li><li>

               <p>Line too long (100 > 79 characters):</p>

               <a href="app.source.html#l2177">
                  <tt><i>2177</i>                 <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Please respond with &#39;yes&#39; or &#39;no&#39;.&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l2180">
                  <tt><i>2180</i>                 <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Re-prompt by setting flag back</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l2181">
                  <tt><i>2181</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Re-prompt by setting flag back</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2192">
                  <tt><i>2192</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> proposing side quest: </span><span class="si">{</span><span class="n">p_input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (144 > 79 characters):</p>

               <a href="app.source.html#l2194">
                  <tt><i>2194</i>                 <span class="n">ai_context_sideq</span><span class="o">.</span><span class="n">update</span><span class="p">({</span> <span class="n">k</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;current_location&#39;</span><span class="p">]})</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l2195">
                  <tt><i>2195</i>                 <span class="n">ai_resp_json</span> <span class="o">=</span> <span class="n">get_ai_response</span><span class="p">(</span><span class="s2">&quot;PROCESS_PLAYER_SIDEQUEST_IDEA&quot;</span><span class="p">,</span> <span class="n">ai_context_sideq</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l2197">
                  <tt><i>2197</i>                 <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ai_resp_json</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;side_quest_objective&#39;</span> <span class="ow">in</span> <span class="n">ai_resp_json</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l2201">
                  <tt><i>2201</i>                     <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Task: </span><span class="si">{</span><span class="n">new_desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l2202">
                  <tt><i>2202</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> starting side quest: </span><span class="si">{</span><span class="n">new_desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (156 > 79 characters):</p>

               <a href="app.source.html#l2204">
                  <tt><i>2204</i>                     <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Let&#39;s try simpler. What would you like to observe or interact with briefly?&quot;</span><span class="p">})</span> <span class="c1"># Ask again</span></tt>
               </a>
            </li><li>

               <p>Line too long (113 > 79 characters):</p>

               <a href="app.source.html#l2205">
                  <tt><i>2205</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process side quest idea for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">. Response: </span><span class="si">{</span><span class="n">ai_resp_json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (110 > 79 characters):</p>

               <a href="app.source.html#l2209">
                  <tt><i>2209</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> side quest &#39;</span><span class="si">{</span><span class="n">side_quest_desc</span><span class="si">}</span><span class="s2">&#39; (Turn </span><span class="si">{</span><span class="n">side_quest_turns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (102 > 79 characters):</p>

               <a href="app.source.html#l2212">
                  <tt><i>2212</i>                     <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="s1">&#39;player_race&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Line too long (121 > 79 characters):</p>

               <a href="app.source.html#l2213">
                  <tt><i>2213</i>                     <span class="s1">&#39;player_class&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="s1">&#39;player_philosophy&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Line too long (119 > 79 characters):</p>

               <a href="app.source.html#l2214">
                  <tt><i>2214</i>                     <span class="s1">&#39;player_abilities&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abilities&#39;</span><span class="p">,[]),</span> <span class="s1">&#39;player_fate_points&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fate_points&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l2215">
                  <tt><i>2215</i>                     <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">curr_loc</span><span class="p">,</span> <span class="s1">&#39;location_data&#39;</span><span class="p">:</span> <span class="n">world_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l2216">
                  <tt><i>2216</i>                     <span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span></tt>
               </a>
            </li><li>

               <p>Line too long (102 > 79 characters):</p>

               <a href="app.source.html#l2218">
                  <tt><i>2218</i>                     <span class="s1">&#39;current_quest_title&#39;</span><span class="p">:</span> <span class="s1">&#39;(Side Quest)&#39;</span><span class="p">,</span> <span class="s1">&#39;current_step_description&#39;</span><span class="p">:</span> <span class="n">side_quest_desc</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2220">
                  <tt><i>2220</i>                 <span class="n">ai_resp</span> <span class="o">=</span> <span class="n">get_ai_response</span><span class="p">(</span><span class="s2">&quot;INTERPRET_COMMAND&quot;</span><span class="p">,</span> <span class="n">ai_context_action</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l2225">
                  <tt><i>2225</i>                 <span class="c1"># Consider adding an AI check EVALUATE_SIDEQUEST_COMPLETION later if needed</span></tt>
               </a>
            </li><li>

               <p>Line too long (138 > 79 characters):</p>

               <a href="app.source.html#l2228">
                  <tt><i>2228</i>                      <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Finished with that detour. Now, let&#39;s reflect on the main chapter...&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l2229">
                  <tt><i>2229</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> completed side quest: </span><span class="si">{</span><span class="n">side_quest_desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l2237">
                  <tt><i>2237</i>                      <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span> <span class="c1"># Save log</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l2240">
                  <tt><i>2240</i>                      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;end_of_chapter&#39;</span><span class="p">))</span> <span class="c1"># Go straight to EOC</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2253">
                  <tt><i>2253</i>         <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">chapter_inputs_log</span> <span class="c1"># Update session log</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l2260">
                  <tt><i>2260</i>             <span class="k">if</span> <span class="s1">&#39;learned_vocab&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p_data</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">],</span> <span class="nb">set</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l2263">
                  <tt><i>2263</i>             <span class="n">player_xp_gain</span><span class="p">,</span> <span class="n">new_awl_words</span> <span class="o">=</span> <span class="n">calculate_xp</span><span class="p">(</span><span class="n">p_input</span><span class="p">,</span> <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l2266">
                  <tt><i>2266</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> learned new AWL words: </span><span class="si">{</span><span class="n">new_awl_words</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l2269">
                  <tt><i>2269</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> gained </span><span class="si">{</span><span class="n">player_xp_gain</span><span class="si">}</span><span class="s2"> Player XP this turn.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2271">
                  <tt><i>2271</i>                      <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;player_profiles&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span></tt>
               </a>
            </li><li>

               <p>Line too long (102 > 79 characters):</p>

               <a href="app.source.html#l2275">
                  <tt><i>2275</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update Player XP in Firestore for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">xp_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l2277">
                  <tt><i>2277</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during vocabulary XP calculation: </span><span class="si">{</span><span class="n">vocab_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (102 > 79 characters):</p>

               <a href="app.source.html#l2291">
                  <tt><i>2291</i>             <span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span> <span class="c1"># Desc, NPCs</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l2292">
                  <tt><i>2292</i>             <span class="s1">&#39;thetopia_general_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;setting&#39;</span><span class="p">,{}),</span> <span class="c1"># World context</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2297">
                  <tt><i>2297</i>             <span class="s1">&#39;current_step_description&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l2310">
                  <tt><i>2310</i>         <span class="k">if</span> <span class="n">verb</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;go&quot;</span><span class="p">,</span><span class="s2">&quot;move&quot;</span><span class="p">,</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="s2">&quot;e&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;u&quot;</span><span class="p">,</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="s2">&quot;north&quot;</span><span class="p">,</span><span class="s2">&quot;south&quot;</span><span class="p">,</span><span class="s2">&quot;east&quot;</span><span class="p">,</span><span class="s2">&quot;west&quot;</span><span class="p">,</span><span class="s2">&quot;up&quot;</span><span class="p">,</span><span class="s2">&quot;down&quot;</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l2318">
                  <tt><i>2318</i>                 <span class="n">d_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="s1">&#39;north&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="s1">&#39;south&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">:</span><span class="s1">&#39;east&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">:</span><span class="s1">&#39;west&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">:</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="s1">&#39;down&#39;</span><span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2323">
                  <tt><i>2323</i>                     <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;current_location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_loc</span> <span class="c1"># Update character data</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2327">
                  <tt><i>2327</i>                     <span class="n">needs_desc_after_move</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Flag to get description later</span></tt>
               </a>
            </li><li>

               <p>Line too long (111 > 79 characters):</p>

               <a href="app.source.html#l2342">
                  <tt><i>2342</i>                             <span class="nb">next</span><span class="p">((</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">ABILITY_NAME_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">abil_input</span> <span class="o">==</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> \</tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l2343">
                  <tt><i>2343</i>                             <span class="n">abil_input</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="c1"># Fallback to capitalized input</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l2346">
                  <tt><i>2346</i>                     <span class="n">reason</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Your character does not have the ability &#39;</span><span class="si">{</span><span class="n">norm_abil</span><span class="si">}</span><span class="s2">&#39;.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2363">
                  <tt><i>2363</i>         <span class="k">elif</span> <span class="n">verb</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;journal&quot;</span><span class="p">,</span><span class="s2">&quot;quest&quot;</span><span class="p">,</span><span class="s2">&quot;log&quot;</span><span class="p">,</span><span class="s2">&quot;vocab&quot;</span><span class="p">,</span><span class="s2">&quot;words&quot;</span><span class="p">,</span><span class="s2">&quot;report&quot;</span><span class="p">,</span><span class="s2">&quot;reports&quot;</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l2373">
                  <tt><i>2373</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LAST_AI_OUTPUT</span><span class="p">]</span> <span class="o">=</span> <span class="n">ai_resp</span> <span class="c1"># Store last output for potential AI check</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l2383">
                  <tt><i>2383</i>                 <span class="n">is_complete_without_ai</span><span class="p">,</span> <span class="n">ai_check_criteria</span> <span class="o">=</span> <span class="n">check_step_completion</span><span class="p">(</span><span class="n">p_data</span><span class="p">,</span> <span class="n">current_step_data</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l2386">
                  <tt><i>2386</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">s_id</span><span class="si">}</span><span class="s2"> of quest </span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2"> completed via state/inventory check.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l2389">
                  <tt><i>2389</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performing AI Check for step </span><span class="si">{</span><span class="n">s_id</span><span class="si">}</span><span class="s2">. Criteria: &#39;</span><span class="si">{</span><span class="n">ai_check_criteria</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l2391">
                  <tt><i>2391</i>                         <span class="s1">&#39;step_description&#39;</span><span class="p">:</span> <span class="n">current_step_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l2393">
                  <tt><i>2393</i>                         <span class="s1">&#39;ai_outcome&#39;</span><span class="p">:</span> <span class="n">ai_resp</span> <span class="ow">or</span> <span class="s2">&quot;(No AI response this turn)&quot;</span><span class="p">,</span> <span class="c1"># Use last AI response</span></tt>
               </a>
            </li><li>

               <p>Line too long (116 > 79 characters):</p>

               <a href="app.source.html#l2394">
                  <tt><i>2394</i>                         <span class="s1">&#39;ai_check_criteria&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;if the action fulfilled: &#39;</span><span class="si">{</span><span class="n">ai_check_criteria</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="c1"># Add context for AI</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2399">
                  <tt><i>2399</i>                     <span class="n">ai_eval_resp</span> <span class="o">=</span> <span class="n">get_ai_response</span><span class="p">(</span><span class="s2">&quot;EVALUATE_STEP_COMPLETION&quot;</span><span class="p">,</span> <span class="n">ai_eval_context</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2401">
                  <tt><i>2401</i>                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ai_eval_resp</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ai_eval_resp</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;YES&#39;</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l2403">
                  <tt><i>2403</i>                         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">s_id</span><span class="si">}</span><span class="s2"> of quest </span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2"> completed via AI Check evaluating TRUE.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (121 > 79 characters):</p>

               <a href="app.source.html#l2405">
                  <tt><i>2405</i>                         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI Check for step </span><span class="si">{</span><span class="n">s_id</span><span class="si">}</span><span class="s2"> evaluated FALSE or Error. AI Response: &#39;</span><span class="si">{</span><span class="n">ai_eval_resp</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l2407">
                  <tt><i>2407</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find step data for current step: </span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">s_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (121 > 79 characters):</p>

               <a href="app.source.html#l2418">
                  <tt><i>2418</i>                     <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;Objective Complete: &#39;</span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;Objective Details Missing&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;!&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l2421">
                  <tt><i>2421</i>                 <span class="n">reward_msg</span> <span class="o">=</span> <span class="n">apply_reward</span><span class="p">(</span><span class="n">p_data</span><span class="p">,</span> <span class="n">step_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;step_reward&quot;</span><span class="p">),</span> <span class="n">user_id</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2428">
                  <tt><i>2428</i>                 <span class="n">step_was_final</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_s_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># It&#39;s final if no next_step defined</span></tt>
               </a>
            </li><li>

               <p>Line too long (113 > 79 characters):</p>

               <a href="app.source.html#l2432">
                  <tt><i>2432</i>                 <span class="n">trigger_eoc_condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">step_was_major</span> <span class="ow">or</span> <span class="n">step_was_final</span><span class="p">)</span> <span class="ow">and</span> <span class="n">inputs_count</span> <span class="o">&gt;=</span> <span class="n">MIN_INPUTS_FOR_EOC</span></tt>
               </a>
            </li><li>

               <p>Line too long (112 > 79 characters):</p>

               <a href="app.source.html#l2436">
                  <tt><i>2436</i>                         <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;A significant moment in your journey...&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (113 > 79 characters):</p>

               <a href="app.source.html#l2441">
                  <tt><i>2441</i>                             <span class="n">final_reward_msg</span> <span class="o">=</span> <span class="n">apply_reward</span><span class="p">(</span><span class="n">p_data</span><span class="p">,</span> <span class="n">quest_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;completion_reward&quot;</span><span class="p">),</span> <span class="n">user_id</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2443">
                  <tt><i>2443</i>                                 <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">final_reward_msg</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2445">
                  <tt><i>2445</i>                         <span class="n">p_data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">FS_QUEST_FLAGS</span><span class="p">,</span> <span class="p">{})[</span><span class="sa">f</span><span class="s2">&quot;quest_</span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2">_completed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2448">
                  <tt><i>2448</i>                     <span class="c1"># Clear current quest info and reset turn count for EOC flow</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l2455">
                  <tt><i>2455</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chapter end triggered by completing step </span><span class="si">{</span><span class="n">s_id</span><span class="si">}</span><span class="s2"> of quest </span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l2461">
                  <tt><i>2461</i>                         <span class="n">next_desc</span> <span class="o">=</span> <span class="n">next_step_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;Continue your quest.&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l2464">
                  <tt><i>2464</i>                         <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;New Objective: </span><span class="si">{</span><span class="n">next_desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l2465">
                  <tt><i>2465</i>                         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Advanced to step </span><span class="si">{</span><span class="n">next_s_id</span><span class="si">}</span><span class="s2"> in quest </span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (115 > 79 characters):</p>

               <a href="app.source.html#l2468">
                  <tt><i>2468</i>                         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot find data for next step </span><span class="si">{</span><span class="n">next_s_id</span><span class="si">}</span><span class="s2"> in quest </span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2">. Ending quest.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (103 > 79 characters):</p>

               <a href="app.source.html#l2469">
                  <tt><i>2469</i>                         <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;current_quest_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;current_step_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># End quest</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2472">
                  <tt><i>2472</i>                     <span class="c1"># Final step completed, but didn&#39;t trigger EOC (e.g., too few inputs)</span></tt>
               </a>
            </li><li>

               <p>Line too long (109 > 79 characters):</p>

               <a href="app.source.html#l2475">
                  <tt><i>2475</i>                         <span class="n">final_reward_msg</span> <span class="o">=</span> <span class="n">apply_reward</span><span class="p">(</span><span class="n">p_data</span><span class="p">,</span> <span class="n">quest_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;completion_reward&quot;</span><span class="p">),</span> <span class="n">user_id</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l2477">
                  <tt><i>2477</i>                             <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">final_reward_msg</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l2478">
                  <tt><i>2478</i>                     <span class="n">p_data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">FS_QUEST_FLAGS</span><span class="p">,</span> <span class="p">{})[</span><span class="sa">f</span><span class="s2">&quot;quest_</span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2">_completed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <p>Line too long (146 > 79 characters):</p>

               <a href="app.source.html#l2479">
                  <tt><i>2479</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final step </span><span class="si">{</span><span class="n">s_id</span><span class="si">}</span><span class="s2"> completed for quest </span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2">, but EOC not triggered (Inputs: </span><span class="si">{</span><span class="n">inputs_count</span><span class="si">}</span><span class="s2">). Quest ended.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (107 > 79 characters):</p>

               <a href="app.source.html#l2487">
                  <tt><i>2487</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CRITICAL: Cannot find step data for completed step </span><span class="si">{</span><span class="n">s_id</span><span class="si">}</span><span class="s2"> in quest </span><span class="si">{</span><span class="n">q_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2489">
                  <tt><i>2489</i>         <span class="c1"># --- Get New Location Description (if moved and chapter didn&#39;t end) ---</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2496">
                  <tt><i>2496</i>                 <span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,</span> <span class="p">{}),</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l2505">
                  <tt><i>2505</i>                 <span class="s1">&#39;current_step_description&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2510">
                  <tt><i>2510</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LAST_AI_OUTPUT</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc_txt</span> <span class="c1"># Update last AI output</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l2516">
                  <tt><i>2516</i>             <span class="n">turn_num</span> <span class="o">%</span> <span class="n">EOC_CHECK_INTERVAL</span> <span class="o">==</span> <span class="p">(</span><span class="n">EOC_CHECK_START_TURN</span> <span class="o">%</span> <span class="n">EOC_CHECK_INTERVAL</span><span class="p">)</span> <span class="ow">and</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l2517">
                  <tt><i>2517</i>             <span class="ow">not</span> <span class="n">step_completed_this_turn</span> <span class="c1"># Don&#39;t suggest EOC on the same turn a step was completed</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l2520">
                  <tt><i>2520</i>             <span class="n">eoc_check_context</span> <span class="o">=</span> <span class="n">ai_context</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Use the main context from this turn</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l2523">
                  <tt><i>2523</i>             <span class="c1"># Build conversation summary from recent messages (including this turn)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l2524">
                  <tt><i>2524</i>             <span class="n">recent_conv_log</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_CONVERSATION</span><span class="p">,</span> <span class="p">[])[:]</span> <span class="c1"># Copy log before this turn</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l2525">
                  <tt><i>2525</i>             <span class="n">recent_conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;Player&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="n">p_input</span><span class="p">})</span> <span class="c1"># Add player input</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l2526">
                  <tt><i>2526</i>             <span class="k">if</span> <span class="n">ai_resp</span><span class="p">:</span> <span class="n">recent_conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="n">ai_resp</span><span class="p">})</span> <span class="c1"># Add AI output</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2527">
                  <tt><i>2527</i>             <span class="c1"># Add any system messages added *this turn* (step complete, rewards)</span></tt>
               </a>
            </li><li>

               <p>Line too long (148 > 79 characters):</p>

               <a href="app.source.html#l2528">
                  <tt><i>2528</i>             <span class="n">system_msgs_this_turn</span> <span class="o">=</span> <span class="p">[</span><span class="n">msg</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">conv_log</span> <span class="k">if</span> <span class="n">msg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_CONVERSATION</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">and</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;speaker&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;System&#39;</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2532">
                  <tt><i>2532</i>                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;speaker&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">][:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Truncate long messages</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l2536">
                  <tt><i>2536</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking AI EOC suggestion for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> turn </span><span class="si">{</span><span class="n">turn_num</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2537">
                  <tt><i>2537</i>             <span class="n">eoc_suggestion</span> <span class="o">=</span> <span class="n">get_ai_response</span><span class="p">(</span><span class="s2">&quot;CHECK_CHAPTER_PROGRESS&quot;</span><span class="p">,</span> <span class="n">eoc_check_context</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l2538">
                  <tt><i>2538</i>             <span class="n">suggestion</span> <span class="o">=</span> <span class="n">eoc_suggestion</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eoc_suggestion</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (162 > 79 characters):</p>

               <a href="app.source.html#l2542">
                  <tt><i>2542</i>                  <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="s2">&quot;This feels like a good place to pause and reflect on this chapter. Shall we conclude it? (yes/no)&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2545">
                  <tt><i>2545</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI suggested EOC for </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Player prompted.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (142 > 79 characters):</p>

               <a href="app.source.html#l2549">
                  <tt><i>2549</i>                  <span class="n">side_quest_init_ctx</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;current_location&#39;</span><span class="p">]}</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l2550">
                  <tt><i>2550</i>                  <span class="n">init_resp</span> <span class="o">=</span> <span class="n">get_ai_response</span><span class="p">(</span><span class="s2">&quot;INITIATE_PLAYER_SIDEQUEST&quot;</span><span class="p">,</span> <span class="n">side_quest_init_ctx</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l2554">
                  <tt><i>2554</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Desc will be set by player response</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2556">
                  <tt><i>2556</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Ensure EOC prompt is off</span></tt>
               </a>
            </li><li>

               <p>Line too long (104 > 79 characters):</p>

               <a href="app.source.html#l2560">
                  <tt><i>2560</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI EOC check result: &#39;</span><span class="si">{</span><span class="n">suggestion</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Continuing chapter.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2561">
                  <tt><i>2561</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Ensure EOC prompt is off</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l2566">
                  <tt><i>2566</i>         <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span> <span class="c1"># Update session log</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2567">
                  <tt><i>2567</i>         <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="c1"># Update data to be saved</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l2568">
                  <tt><i>2568</i>         <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">]</span> <span class="c1"># Update data to be saved</span></tt>
               </a>
            </li><li>

               <p>Line too long (104 > 79 characters):</p>

               <a href="app.source.html#l2569">
                  <tt><i>2569</i>         <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Sync EOC prompt status</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l2579">
                  <tt><i>2579</i>             <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;CRITICAL ERROR: Failed to save your progress! Please reload your character.&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2595">
                  <tt><i>2595</i>         <span class="n">show_intro_this_time</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Flag to indicate if intro is displayed *this* time</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2597">
                  <tt><i>2597</i>         <span class="c1"># Heuristic: Is this the character&#39;s first turn ever? (0 turns, empty log)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l2598">
                  <tt><i>2598</i>         <span class="n">first_character_turn</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;turn_count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CONVERSATION</span><span class="p">))</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l2606">
                  <tt><i>2606</i>                 <span class="n">player_has_seen_intro</span> <span class="o">=</span> <span class="n">profile_doc</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_PLAYER_HAS_SEEN_INTRO</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2608">
                  <tt><i>2608</i>                 <span class="c1"># Profile doc missing for logged-in user? Should not happen after signup.</span></tt>
               </a>
            </li><li>

               <p>Line too long (139 > 79 characters):</p>

               <a href="app.source.html#l2610">
                  <tt><i>2610</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player profile document not found for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> when checking intro status. Assuming intro needed.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (111 > 79 characters):</p>

               <a href="app.source.html#l2613">
                  <tt><i>2613</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch </span><span class="si">{</span><span class="n">FS_PLAYER_HAS_SEEN_INTRO</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l2614">
                  <tt><i>2614</i>             <span class="c1"># If DB read fails, assume they HAVE seen intro to avoid repeated display on error</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l2620">
                  <tt><i>2620</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Displaying introduction for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> (char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (288 > 79 characters):</p>

               <a href="app.source.html#l2624">
                  <tt><i>2624</i> <span class="s2">Welcome to your Daydream! You are a new player located on Dumpster Planet, responsible for containing all of the wasted ideas from human daydreams. The games governing AI is named The Great Recycler and is responsible for cleaning up Daydream by elevating ideas from trash to treasure. </span></tt>
               </a>
            </li><li>

               <p>Line too long (142 > 79 characters):</p>

               <a href="app.source.html#l2626">
                  <tt><i>2626</i> <span class="s2">Your journey begins in Thetopia, a pocket of stability amidst the chaotic Dumpster Planet  a realm made from forgotten ideas and lost dreams.</span></tt>
               </a>
            </li><li>

               <p>Line too long (393 > 79 characters):</p>

               <a href="app.source.html#l2628">
                  <tt><i>2628</i> <span class="s2">Here, your greatest tool is your imagination! The more descriptive and detailed you are in your actions and narration, the richer your adventure will become, and the more the story will evolve based on *your* writing. Don&#39;t be afraid to write detailed descriptions and express your character&#39;s thoughts and feelings. This helps me understand your intent and bring the world to life around you.</span></tt>
               </a>
            </li><li>

               <p>Line too long (390 > 79 characters):</p>

               <a href="app.source.html#l2630">
                  <tt><i>2630</i> <span class="s2">Our adventure is structured around quests, which form chapters in your story. Each chapter is inspired by a stage of the classic Hero&#39;s Journey, giving our quest a unique theme. As you complete chapters, we&#39;ll pause to reflect. I&#39;ll help analyze your writing and comprehension, not for a grade, but to help you grow stronger in your storytelling skills. The goal is to improve through play!</span></tt>
               </a>
            </li><li>

               <p>Line too long (102 > 79 characters):</p>

               <a href="app.source.html#l2632">
                  <tt><i>2632</i> <span class="s2">Do you have any questions before we begin, or are you ready to dive into your first quest in Thetopia?</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l2638">
                  <tt><i>2638</i>             <span class="c1"># (This prevents duplication if user refreshes the page immediately after intro)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l2639">
                  <tt><i>2639</i>             <span class="k">if</span> <span class="ow">not</span> <span class="n">conv_log_for_session</span> <span class="ow">or</span> <span class="n">conv_log_for_session</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">intro_text</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2640">
                  <tt><i>2640</i>                  <span class="n">conv_log_for_session</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;Storyteller&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">intro_text</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2644">
                  <tt><i>2644</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log_for_session</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2650">
                  <tt><i>2650</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated </span><span class="si">{</span><span class="n">FS_PLAYER_HAS_SEEN_INTRO</span><span class="si">}</span><span class="s2"> to True for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l2652">
                  <tt><i>2652</i>                 <span class="k">if</span> <span class="ow">not</span> <span class="n">conv_log_for_session</span> <span class="ow">or</span> <span class="n">conv_log_for_session</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">intro_text</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l2655">
                  <tt><i>2655</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update </span><span class="si">{</span><span class="n">FS_PLAYER_HAS_SEEN_INTRO</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l2661">
                  <tt><i>2661</i>         <span class="n">conv_log_from_session</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_CONVERSATION</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Get potentially updated log</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l2662">
                  <tt><i>2662</i>         <span class="n">vocab_info</span> <span class="o">=</span> <span class="n">get_active_vocab_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="c1"># Gets settings (inc. colors) and vocab</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2667">
                  <tt><i>2667</i>         <span class="c1"># Needs setup ONLY if it&#39;s the first turn AND intro wasn&#39;t shown this time</span></tt>
               </a>
            </li><li>

               <p>Line too long (119 > 79 characters):</p>

               <a href="app.source.html#l2671">
                  <tt><i>2671</i>              <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running INITIAL_SETUP AI for new character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> (Turn 0, Intro not shown this load).&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l2679">
                  <tt><i>2679</i>                  <span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span></tt>
               </a>
            </li><li>

               <p>Line too long (86 > 79 characters):</p>

               <a href="app.source.html#l2683">
                  <tt><i>2683</i>                  <span class="s1">&#39;current_step_description&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l2688">
                  <tt><i>2688</i>                  <span class="c1"># Check if this exact message is already the last one (avoid double add on reload)</span></tt>
               </a>
            </li><li>

               <p>Line too long (110 > 79 characters):</p>

               <a href="app.source.html#l2689">
                  <tt><i>2689</i>                  <span class="k">if</span> <span class="ow">not</span> <span class="n">conv_log_from_session</span> <span class="ow">or</span> <span class="n">conv_log_from_session</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">initial_ai_response</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l2690">
                  <tt><i>2690</i>                       <span class="n">conv_log_from_session</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">initial_ai_response</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l2691">
                  <tt><i>2691</i>                       <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log_from_session</span> <span class="c1"># Update session log</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l2694">
                  <tt><i>2694</i>                       <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log_from_session</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l2695">
                  <tt><i>2695</i>                       <span class="c1"># Save character data immediately after adding initial setup message</span></tt>
               </a>
            </li><li>

               <p>Line too long (133 > 79 characters):</p>

               <a href="app.source.html#l2698">
                  <tt><i>2698</i>                   <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INITIAL_SETUP failed or returned non-string for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Response: </span><span class="si">{</span><span class="n">initial_ai_response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l2707">
                  <tt><i>2707</i>             <span class="k">if</span> <span class="n">speaker</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;AI&#39;</span><span class="p">,</span> <span class="s1">&#39;Storyteller&#39;</span><span class="p">]:</span> <span class="c1"># &lt;&lt;&lt; REVISED: Include Storyteller &gt;&gt;&gt;</span></tt>
               </a>
            </li><li>

               <p>Line too long (113 > 79 characters):</p>

               <a href="app.source.html#l2708">
                  <tt><i>2708</i>                  <span class="n">text_with_vocab</span> <span class="o">=</span> <span class="n">apply_vocab_highlighting_python</span><span class="p">(</span><span class="n">text_to_process</span><span class="p">,</span> <span class="n">active_vocab</span><span class="p">,</span> <span class="n">vocab_settings</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l2709">
                  <tt><i>2709</i>                  <span class="n">text_with_all_highlights</span> <span class="o">=</span> <span class="n">apply_lore_highlighting_python</span><span class="p">(</span><span class="n">text_with_vocab</span><span class="p">,</span> <span class="n">lore_vocabulary</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l2710">
                  <tt><i>2710</i>                  <span class="n">processed_message</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_with_all_highlights</span> <span class="c1"># Use safe HTML</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2712">
                  <tt><i>2712</i>                  <span class="c1"># Allow basic HTML like line breaks in system messages if needed</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2713">
                  <tt><i>2713</i>                  <span class="n">processed_message</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_to_process</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (107 > 79 characters):</p>

               <a href="app.source.html#l2721">
                  <tt><i>2721</i>         <span class="n">fields_to_pop</span> <span class="o">=</span> <span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">,</span> <span class="n">FS_CHAPTER_INPUTS</span><span class="p">,</span> <span class="s1">&#39;learned_vocab&#39;</span><span class="p">,</span> <span class="n">FS_QUEST_FLAGS</span><span class="p">,</span> <span class="n">FS_INVENTORY</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l2728">
                  <tt><i>2728</i>             <span class="n">current_lore</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thetopia_lore&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># Safely access global</span></tt>
               </a>
            </li><li>

               <p>Line too long (114 > 79 characters):</p>

               <a href="app.source.html#l2731">
                  <tt><i>2731</i>                 <span class="n">keys_to_include</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;locations&#39;</span><span class="p">,</span> <span class="s1">&#39;npcs&#39;</span><span class="p">,</span> <span class="s1">&#39;races&#39;</span><span class="p">,</span> <span class="s1">&#39;classes&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophies&#39;</span><span class="p">,</span> <span class="s1">&#39;concepts&#39;</span><span class="p">,</span> <span class="s1">&#39;setting&#39;</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l2733">
                  <tt><i>2733</i>                     <span class="n">lore_data_for_json</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># Get each section safely</span></tt>
               </a>
            </li><li>

               <p>Line too long (140 > 79 characters):</p>

               <a href="app.source.html#l2735">
                  <tt><i>2735</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Global &#39;thetopia_lore&#39; variable is not a dictionary (Type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">current_lore</span><span class="p">)</span><span class="si">}</span><span class="s2">). Sending empty lore data.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l2739">
                  <tt><i>2739</i>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NameError accessing &#39;thetopia_lore&#39; globally. Sending empty lore data.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2742">
                  <tt><i>2742</i>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to serialize lore data to JSON: </span><span class="si">{</span><span class="n">json_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (104 > 79 characters):</p>

               <a href="app.source.html#l2755">
                  <tt><i>2755</i>              <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template rendering error in game_view GET: </span><span class="si">{</span><span class="n">render_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2756">
                  <tt><i>2756</i>              <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Critical error displaying game. Please reload your character.&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (132 > 79 characters):</p>

               <a href="app.source.html#l2783">
                  <tt><i>2783</i>         <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;word&quot;</span><span class="p">:</span> <span class="n">word</span><span class="p">,</span> <span class="s2">&quot;definition&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;definition&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">),</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">)}</span> <span class="c1"># Placeholder color</span></tt>
               </a>
            </li><li>

               <p>Line too long (135 > 79 characters):</p>

               <a href="app.source.html#l2796">
                  <tt><i>2796</i>         <span class="n">ai_lists_query</span> <span class="o">=</span> <span class="n">profile_ref</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;custom_vocab_lists&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">FieldFilter</span><span class="p">(</span><span class="s1">&#39;is_ai_generated&#39;</span><span class="p">,</span> <span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">stream</span><span class="p">()</span></tt>
               </a>
            </li><li>

               <p>Line too long (111 > 79 characters):</p>

               <a href="app.source.html#l2808">
                  <tt><i>2808</i>         <span class="n">ai_lists_metadata</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Use 0 as fallback for sort</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l2810">
                  <tt><i>2810</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch AI vocabulary list metadata for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2823">
                  <tt><i>2823</i>         <span class="n">ai_lists_metadata</span><span class="o">=</span><span class="n">ai_lists_metadata</span><span class="p">,</span> <span class="c1"># Pass list metadata for management</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l2825">
                  <tt><i>2825</i>         <span class="n">premium_active</span><span class="o">=</span><span class="n">check_premium_access</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="c1"># Pass premium status for UI elements</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l2845">
                  <tt><i>2845</i>     <span class="n">fields_to_pop</span> <span class="o">=</span> <span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">,</span> <span class="n">FS_CHAPTER_INPUTS</span><span class="p">,</span> <span class="n">FS_QUEST_FLAGS</span><span class="p">]</span> <span class="c1"># Keep FS_INVENTORY now!</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2850">
                  <tt><i>2850</i>          <span class="n">sheet_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sheet_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]))</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2858">
                  <tt><i>2858</i>     <span class="k">if</span> <span class="n">quest_log</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;No active quest&#39;</span> <span class="ow">and</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_quest_id&#39;</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l2860">
                  <tt><i>2860</i>         <span class="n">quest_log</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown Quest&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">qd</span> <span class="k">else</span> <span class="s1">&#39;Unknown Quest&#39;</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l2893">
                  <tt><i>2893</i>     <span class="n">eoc_state</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="s1">&#39;START&#39;</span><span class="p">)</span> <span class="c1"># Get current EOC state from session</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l2901">
                  <tt><i>2901</i>                  <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Error: Comprehension questions missing from session.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (127 > 79 characters):</p>

               <a href="app.source.html#l2902">
                  <tt><i>2902</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EOC state AWAIT_COMP_ANSWERS but no questions in session for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l2903">
                  <tt><i>2903</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span><span class="p">;</span> <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Reset state</span></tt>
               </a>
            </li><li>

               <p>Line too long (105 > 79 characters):</p>

               <a href="app.source.html#l2907">
                  <tt><i>2907</i>             <span class="n">answers</span> <span class="o">=</span> <span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;comp_answer_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">questions</span><span class="p">))]</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l2912">
                  <tt><i>2912</i>                 <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;comprehension_check.html&#39;</span><span class="p">,</span> <span class="n">questions</span><span class="o">=</span><span class="n">questions</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2916">
                  <tt><i>2916</i>             <span class="n">comp_res</span> <span class="o">=</span> <span class="n">get_ai_response</span><span class="p">(</span><span class="s2">&quot;EVALUATE_CHAPTER_COMPREHENSION&quot;</span><span class="p">,</span> <span class="n">eval_ctx</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (88 > 79 characters):</p>

               <a href="app.source.html#l2918">
                  <tt><i>2918</i>             <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp_res</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;overall_comprehension_score&#39;</span> <span class="ow">in</span> <span class="n">comp_res</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Line too long (161 > 79 characters):</p>

               <a href="app.source.html#l2923">
                  <tt><i>2923</i>                     <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid comprehension score format from AI: </span><span class="si">{</span><span class="n">comp_res</span><span class="p">[</span><span class="s1">&#39;overall_comprehension_score&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (97 > 79 characters):</p>

               <a href="app.source.html#l2925">
                  <tt><i>2925</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;The AI storyteller had trouble evaluating your comprehension.&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (124 > 79 characters):</p>

               <a href="app.source.html#l2926">
                  <tt><i>2926</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Comprehension evaluation failed for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Response: </span><span class="si">{</span><span class="n">comp_res</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l2931">
                  <tt><i>2931</i>                 <span class="n">chapter_text</span> <span class="o">=</span> <span class="s2">&quot;(No player inputs recorded for this chapter)&quot;</span> <span class="c1"># Handle empty</span></tt>
               </a>
            </li><li>

               <p>Line too long (108 > 79 characters):</p>

               <a href="app.source.html#l2936">
                  <tt><i>2936</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;The AI storyteller couldn&#39;t analyze your writing style for this chapter.&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (116 > 79 characters):</p>

               <a href="app.source.html#l2937">
                  <tt><i>2937</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing analysis failed for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Response: </span><span class="si">{</span><span class="n">anal_res</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l2943">
                  <tt><i>2943</i>                 <span class="o">+</span> <span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;avg_length_category&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l2948">
                  <tt><i>2948</i>                 <span class="o">+</span> <span class="p">{</span><span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;descriptive_language_rating&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l2952">
                  <tt><i>2952</i>             <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chapter Complete! You earned </span><span class="si">{</span><span class="n">xp_gained</span><span class="si">}</span><span class="s2"> Player XP!&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l2956">
                  <tt><i>2956</i>                 <span class="n">profile_ref</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;player_profiles&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l2957">
                  <tt><i>2957</i>                 <span class="n">profile_ref</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;total_player_xp&#39;</span><span class="p">:</span> <span class="n">firestore</span><span class="o">.</span><span class="n">Increment</span><span class="p">(</span><span class="n">xp_gained</span><span class="p">)})</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l2958">
                  <tt><i>2958</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player XP +</span><span class="si">{</span><span class="n">xp_gained</span><span class="si">}</span><span class="s2"> updated in Firestore for user: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l2960">
                  <tt><i>2960</i>                 <span class="n">profile_doc</span> <span class="o">=</span> <span class="n">profile_ref</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;total_player_xp&#39;</span><span class="p">,</span> <span class="s1">&#39;player_level&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Line too long (102 > 79 characters):</p>

               <a href="app.source.html#l2969">
                  <tt><i>2969</i>                         <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Congratulations! You&#39;ve reached Player Level </span><span class="si">{</span><span class="n">new_level</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l2970">
                  <tt><i>2970</i>                         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> leveled up to </span><span class="si">{</span><span class="n">new_level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (121 > 79 characters):</p>

               <a href="app.source.html#l2972">
                  <tt><i>2972</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not retrieve profile data after XP update for level check. User: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (118 > 79 characters):</p>

               <a href="app.source.html#l2974">
                  <tt><i>2974</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update player XP/Level in Firestore for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (90 > 79 characters):</p>

               <a href="app.source.html#l2975">
                  <tt><i>2975</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Could not update your Player XP due to a server error.&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2979">
                  <tt><i>2979</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;* **Comprehension Score:** </span><span class="si">{</span><span class="n">comp_score</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2"> / 10</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (118 > 79 characters):</p>

               <a href="app.source.html#l2983">
                  <tt><i>2983</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * AWL Words Used (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">awl_used</span><span class="p">)</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">awl_used</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">awl_used</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;None&#39;</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (113 > 79 characters):</p>

               <a href="app.source.html#l2984">
                  <tt><i>2984</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Relevance &amp; Coherence: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;relevance_coherence_score&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> / 5</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l2985">
                  <tt><i>2985</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Style Complexity: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;style_rating&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (95 > 79 characters):</p>

               <a href="app.source.html#l2986">
                  <tt><i>2986</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Critical Thinking: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thinking_rating&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (96 > 79 characters):</p>

               <a href="app.source.html#l2987">
                  <tt><i>2987</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Average Length: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;avg_length_category&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (110 > 79 characters):</p>

               <a href="app.source.html#l2988">
                  <tt><i>2988</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Descriptive Language: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;descriptive_language_rating&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l2995">
                  <tt><i>2995</i>                 <span class="s2">&quot;comprehension_score&quot;</span><span class="p">:</span> <span class="n">comp_score</span><span class="p">,</span> <span class="s2">&quot;player_xp_gained&quot;</span><span class="p">:</span> <span class="n">xp_gained</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l3002">
                  <tt><i>3002</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_SUMMARY</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_text</span> <span class="c1"># Store summary for display</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l3003">
                  <tt><i>3003</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AWAIT_REPORT_ACK&#39;</span> <span class="c1"># Move to next state</span></tt>
               </a>
            </li><li>

               <p>Line too long (89 > 79 characters):</p>

               <a href="app.source.html#l3004">
                  <tt><i>3004</i>             <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Clear chapter inputs from session</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l3005">
                  <tt><i>3005</i>             <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Clear questions from session</span></tt>
               </a>
            </li><li>

               <p>Line too long (80 > 79 characters):</p>

               <a href="app.source.html#l3008">
                  <tt><i>3008</i>             <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;end_of_chapter&#39;</span><span class="p">))</span> <span class="c1"># Redirect to show report</span></tt>
               </a>
            </li><li>

               <p>Line too long (146 > 79 characters):</p>

               <a href="app.source.html#l3013">
                  <tt><i>3013</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> acknowledged EOC report for character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">, chapter </span><span class="si">{</span><span class="n">current_chapter_num</span><span class="si">}</span><span class="s2">. Generating next quest.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (124 > 79 characters):</p>

               <a href="app.source.html#l3018">
                  <tt><i>3018</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using Hero&#39;s Journey Stage &#39;</span><span class="si">{</span><span class="n">next_stage</span><span class="si">}</span><span class="s2">&#39; for Chapter </span><span class="si">{</span><span class="n">current_chapter_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> quest generation.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l3021">
                  <tt><i>3021</i>             <span class="n">next_q_id</span><span class="p">,</span> <span class="n">next_q_title</span><span class="p">,</span> <span class="n">next_s_id</span><span class="p">,</span> <span class="n">next_s_desc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span></tt>
               </a>
            </li><li>

               <p>Line too long (82 > 79 characters):</p>

               <a href="app.source.html#l3035">
                  <tt><i>3035</i>                 <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">next_q_id</span> <span class="ow">and</span> <span class="n">next_s_id</span> <span class="ow">and</span> <span class="n">next_q_title</span> <span class="ow">and</span> <span class="n">next_s_desc</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Line too long (117 > 79 characters):</p>

               <a href="app.source.html#l3036">
                  <tt><i>3036</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI quest generation returned incomplete data for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">q_gen_res</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (128 > 79 characters):</p>

               <a href="app.source.html#l3037">
                  <tt><i>3037</i>                      <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;The AI storyteller couldn&#39;t generate a specific new quest objective. Feel free to explore!&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (140 > 79 characters):</p>

               <a href="app.source.html#l3038">
                  <tt><i>3038</i>                      <span class="n">next_q_id</span><span class="p">,</span> <span class="n">next_q_title</span><span class="p">,</span> <span class="n">next_s_id</span><span class="p">,</span> <span class="n">next_s_desc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Explore Thetopia&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Forge your own path or seek rumors.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (112 > 79 characters):</p>

               <a href="app.source.html#l3040">
                  <tt><i>3040</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI generated next quest for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">next_q_id</span><span class="si">}</span><span class="s2"> - &#39;</span><span class="si">{</span><span class="n">next_q_title</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l3041">
                  <tt><i>3041</i>                      <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New objective received: </span><span class="si">{</span><span class="n">next_q_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span> <span class="c1"># Inform player</span></tt>
               </a>
            </li><li>

               <p>Line too long (136 > 79 characters):</p>

               <a href="app.source.html#l3043">
                  <tt><i>3043</i>                 <span class="n">error_reason</span> <span class="o">=</span> <span class="n">q_gen_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span><span class="s1">&#39;Unknown AI error&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q_gen_res</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;AI communication failure&#39;</span></tt>
               </a>
            </li><li>

               <p>Line too long (103 > 79 characters):</p>

               <a href="app.source.html#l3044">
                  <tt><i>3044</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI quest generation failed for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Reason: </span><span class="si">{</span><span class="n">error_reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (130 > 79 characters):</p>

               <a href="app.source.html#l3045">
                  <tt><i>3045</i>                 <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The AI storyteller had trouble determining your next quest (</span><span class="si">{</span><span class="n">error_reason</span><span class="si">}</span><span class="s2">). Time to explore!&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (135 > 79 characters):</p>

               <a href="app.source.html#l3046">
                  <tt><i>3046</i>                 <span class="n">next_q_id</span><span class="p">,</span> <span class="n">next_q_title</span><span class="p">,</span> <span class="n">next_s_id</span><span class="p">,</span> <span class="n">next_s_desc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Explore Thetopia&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Forge your own path or seek rumors.&quot;</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l3057">
                  <tt><i>3057</i>             <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="n">SESSION_EOC_SUMMARY</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l3066">
                  <tt><i>3066</i>             <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;An unexpected error occurred during chapter conclusion.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (135 > 79 characters):</p>

               <a href="app.source.html#l3067">
                  <tt><i>3067</i>             <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected EOC state &#39;</span><span class="si">{</span><span class="n">eoc_state</span><span class="si">}</span><span class="s2">&#39; encountered in POST for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Resetting EOC.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (130 > 79 characters):</p>

               <a href="app.source.html#l3068">
                  <tt><i>3068</i>             <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l3081">
                  <tt><i>3081</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_QUESTIONS</span><span class="p">]</span> <span class="o">=</span> <span class="n">questions</span> <span class="c1"># Store questions in session</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l3084">
                  <tt><i>3084</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initiating EOC comprehension check for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (83 > 79 characters):</p>

               <a href="app.source.html#l3085">
                  <tt><i>3085</i>             <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;comprehension_check.html&#39;</span><span class="p">,</span> <span class="n">questions</span><span class="o">=</span><span class="n">questions</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (106 > 79 characters):</p>

               <a href="app.source.html#l3091">
                  <tt><i>3091</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Re-displaying EOC comprehension check for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (87 > 79 characters):</p>

               <a href="app.source.html#l3092">
                  <tt><i>3092</i>                 <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;comprehension_check.html&#39;</span><span class="p">,</span> <span class="n">questions</span><span class="o">=</span><span class="n">questions</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l3094">
                  <tt><i>3094</i>                 <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Error: Comprehension questions lost. Restarting chapter conclusion.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (130 > 79 characters):</p>

               <a href="app.source.html#l3095">
                  <tt><i>3095</i>                 <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EOC state AWAIT_COMP_ANSWERS but no questions in session (GET). User: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (98 > 79 characters):</p>

               <a href="app.source.html#l3101">
                  <tt><i>3101</i>             <span class="n">summary</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="s2">&quot;Report summary is currently unavailable.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (94 > 79 characters):</p>

               <a href="app.source.html#l3102">
                  <tt><i>3102</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Displaying EOC report summary for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l3103">
                  <tt><i>3103</i>             <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;report_summary.html&#39;</span><span class="p">,</span> <span class="n">report_summary</span><span class="o">=</span><span class="n">summary</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (109 > 79 characters):</p>

               <a href="app.source.html#l3107">
                  <tt><i>3107</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EOC state was &#39;COMPLETE&#39; on GET request for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, redirecting to game.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l3112">
                  <tt><i>3112</i>              <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;An unexpected state was encountered during chapter conclusion.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (131 > 79 characters):</p>

               <a href="app.source.html#l3113">
                  <tt><i>3113</i>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected EOC state &#39;</span><span class="si">{</span><span class="n">eoc_state</span><span class="si">}</span><span class="s2">&#39; encountered in GET for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Resetting.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (131 > 79 characters):</p>

               <a href="app.source.html#l3114">
                  <tt><i>3114</i>              <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l3144">
                  <tt><i>3144</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempt to delete non-existent character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> by user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (119 > 79 characters):</p>

               <a href="app.source.html#l3150">
                  <tt><i>3150</i>             <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SECURITY ALERT: User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> denied deletion of character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> (owner mismatch).&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (101 > 79 characters):</p>

               <a href="app.source.html#l3156">
                  <tt><i>3156</i>         <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully deleted character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">char_name</span><span class="si">}</span><span class="s2">&#39;) for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l3162">
                  <tt><i>3162</i>                  <span class="n">SESSION_CHARACTER_ID</span><span class="p">,</span> <span class="n">SESSION_CONVERSATION</span><span class="p">,</span> <span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Line too long (93 > 79 characters):</p>

               <a href="app.source.html#l3164">
                  <tt><i>3164</i>                  <span class="n">SESSION_SIDE_QUEST_ACTIVE</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_TURNS</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l3169">
                  <tt><i>3169</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleared deleted character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> from active session.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (99 > 79 characters):</p>

               <a href="app.source.html#l3172">
                  <tt><i>3172</i>         <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deleting character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (81 > 79 characters):</p>

               <a href="app.source.html#l3173">
                  <tt><i>3173</i>         <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;An error occurred while trying to delete the character.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (85 > 79 characters):</p>

               <a href="app.source.html#l3184">
                  <tt><i>3184</i>     <span class="n">debug_mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FLASK_DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Line too long (84 > 79 characters):</p>

               <a href="app.source.html#l3187">
                  <tt><i>3187</i>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Daydream Server V5.3 ---&quot;</span><span class="p">)</span> <span class="c1"># &lt;&lt;&lt; Updated version number &gt;&gt;&gt;</span></tt>
               </a>
            </li><li>

               <p>Line too long (92 > 79 characters):</p>

               <a href="app.source.html#l3191">
                  <tt><i>3191</i>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Firebase Project: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GOOGLE_CLOUD_PROJECT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;daydream-455317&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Line too long (91 > 79 characters):</p>

               <a href="app.source.html#l3192">
                  <tt><i>3192</i>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Vertex AI Location: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;GOOGLE_CLOUD_LOCATION&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;us-central1&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E261">
               <span class="count sev-2">
                  277
               </span>
               <strong>E261:</strong> at least two spaces before inline comment

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l12">
                  <tt><i>12</i> <span class="kn">import</span><span class="w"> </span><span class="nn">re</span> <span class="c1"># Ensure re is imported</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l14">
                  <tt><i>14</i> <span class="kn">import</span><span class="w"> </span><span class="nn">json</span> <span class="c1"># Ensure json is imported</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l43">
                  <tt><i>43</i> <span class="k">def</span><span class="w"> </span><span class="nf">_fallback_calculate_xp</span><span class="p">(</span><span class="n">text_input</span><span class="p">,</span> <span class="n">learned_set</span><span class="p">):</span> <span class="c1"># Removed unused custom_vocab arg</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l46">
                  <tt><i>46</i> <span class="n">calculate_xp</span> <span class="o">=</span> <span class="n">_fallback_calculate_xp</span> <span class="c1"># Assign fallback initially</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l51">
                  <tt><i>51</i>     <span class="n">AWL_WORDS</span> <span class="o">=</span> <span class="n">imported_awl_words</span> <span class="c1"># Overwrite fallback if import succeeds</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l52">
                  <tt><i>52</i>     <span class="n">calculate_xp</span> <span class="o">=</span> <span class="n">imported_calculate_xp</span> <span class="c1"># Overwrite fallback if import succeeds</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l57">
                  <tt><i>57</i>         <span class="n">AWL_DEFINITIONS_PATH</span> <span class="o">=</span> <span class="s1">&#39;awl_definitions.json&#39;</span> <span class="c1"># The specific filename</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l59">
                  <tt><i>59</i>             <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">AWL_DEFINITIONS_PATH</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="c1"># Added encoding</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l78">
                  <tt><i>78</i>     <span class="k">pass</span> <span class="c1"># Keep fallbacks if import fails</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l111">
                  <tt><i>111</i>     <span class="n">world_map</span> <span class="o">=</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># Use locations as the world map source</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l132">
                  <tt><i>132</i>     <span class="k">pass</span> <span class="c1"># Keep fallbacks</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l149">
                  <tt><i>149</i> <span class="n">PREMADE_CHARS_PATH</span> <span class="o">=</span> <span class="s1">&#39;premade_characters.json&#39;</span> <span class="c1"># Define path outside try block</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l159">
                  <tt><i>159</i>                 <span class="n">premade_character_templates</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Reset to empty list</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l174">
                  <tt><i>174</i>     <span class="n">premade_character_templates</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Ensure it&#39;s empty on any error</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l203">
                  <tt><i>203</i> <span class="n">MAX_CONVO_LINES</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Max lines of conversation log saved to Firestore</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l207">
                  <tt><i>207</i> <span class="n">DEFAULT_SERVICE_ACCOUNT_KEY_FILE</span> <span class="o">=</span> <span class="s2">&quot;daydream-455317-e701a4533dc0.json&quot;</span> <span class="c1"># !! REPLACE !!</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l208">
                  <tt><i>208</i> <span class="n">DEFAULT_VOCAB_LIST_COLOR</span> <span class="o">=</span> <span class="s2">&quot;#ADD8E6&quot;</span> <span class="c1"># Example color</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l209">
                  <tt><i>209</i> <span class="n">DEFAULT_AWL_COLOR</span> <span class="o">=</span> <span class="s2">&quot;#FFC0CB&quot;</span> <span class="c1"># Example color</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l232">
                  <tt><i>232</i> <span class="n">FS_QUEST_FLAGS</span> <span class="o">=</span> <span class="s1">&#39;quest_flags&#39;</span> <span class="c1"># Dictionary to store flags like {&#39;fountain_analyzed&#39;: True}</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l233">
                  <tt><i>233</i> <span class="n">FS_INVENTORY</span> <span class="o">=</span> <span class="s1">&#39;inventory&#39;</span> <span class="c1"># List to store item names like [&#39;Cogwheel&#39;, &#39;Hydro-Spanner&#39;]</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l234">
                  <tt><i>234</i> <span class="n">FS_PLAYER_HAS_SEEN_INTRO</span> <span class="o">=</span> <span class="s1">&#39;has_seen_intro&#39;</span> <span class="c1"># &lt;&lt;&lt; NEW &gt;&gt;&gt; Firestore field name constant</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l239">
                  <tt><i>239</i> <span class="n">MIN_INPUTS_FOR_EOC</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># Example minimum inputs before EOC can trigger</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l240">
                  <tt><i>240</i> <span class="n">HERO_JOURNEY_STAGES</span> <span class="o">=</span> <span class="p">[</span> <span class="c1"># Simple stage progression based on chapter number</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l253">
                  <tt><i>253</i>     <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># Changed default level to INFO</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l298">
                  <tt><i>298</i>         <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Exit if the key is not configured</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l301">
                  <tt><i>301</i>     <span class="kn">import</span><span class="w"> </span><span class="nn">google.generativeai</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">genai</span> <span class="c1"># &lt;&lt;&lt; NEW IMPORT</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l302">
                  <tt><i>302</i>     <span class="kn">from</span><span class="w"> </span><span class="nn">google.generativeai.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">HarmCategory</span><span class="p">,</span> <span class="n">HarmBlockThreshold</span> <span class="c1"># &lt;&lt;&lt; ADDED IMPORT</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l339">
                  <tt><i>339</i>         <span class="k">if</span> <span class="n">transformed_key</span><span class="p">:</span> <span class="c1"># Avoid empty keys</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l345">
                  <tt><i>345</i>     <span class="n">processed_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c1"># Track indices already part of a found term</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l367">
                  <tt><i>367</i>             <span class="k">continue</span> <span class="c1"># Skip problematic terms</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l376">
                  <tt><i>376</i>         <span class="k">return</span> <span class="n">text</span> <span class="c1"># Return original text if no terms found or text is empty</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l409">
                  <tt><i>409</i>         <span class="n">last_end_index</span> <span class="o">=</span> <span class="n">end</span> <span class="c1"># Update position for next iteration</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l432">
                  <tt><i>432</i>         <span class="n">color_prefs</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Use empty dict to allow .get() with defaults</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l473">
                  <tt><i>473</i>         <span class="n">css_class</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;highlighted-vocab </span><span class="si">{</span><span class="n">source_class</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Keep class for potential generic styles</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l482">
                  <tt><i>482</i>             <span class="n">safe_title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;quot;&quot;</span><span class="p">)</span> <span class="c1"># Escape quotes for HTML attribute</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l487">
                  <tt><i>487</i>         <span class="n">matched_text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="c1"># Get the exact text matched</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l491">
                  <tt><i>491</i>         <span class="n">last_end_index</span> <span class="o">=</span> <span class="n">end</span> <span class="c1"># Update position for next iteration</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l508">
                  <tt><i>508</i>              <span class="s2">&quot;display_term&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;display_term&quot;</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()),</span> <span class="c1"># How the term should look</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l509">
                  <tt><i>509</i>              <span class="s2">&quot;lore_path&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lore_path&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Path for JS lookup</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l519">
                  <tt><i>519</i>          <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;#39;&quot;</span><span class="p">)</span> <span class="c1"># Use HTML entity for single quote</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l533">
                  <tt><i>533</i>          <span class="n">span_class</span><span class="o">=</span><span class="s2">&quot;lore-term&quot;</span><span class="p">,</span> <span class="c1"># CSS class for styling</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l534">
                  <tt><i>534</i>          <span class="n">data_attribute_name</span><span class="o">=</span><span class="s2">&quot;data-lore-path&quot;</span><span class="p">,</span> <span class="c1"># Attribute JS will use for lookups</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l551">
                  <tt><i>551</i>             <span class="s2">&quot;EVALUATE_STEP_COMPLETION&quot;</span><span class="p">,</span> <span class="c1"># Used by ai_check trigger</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l592">
                  <tt><i>592</i>     <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span> <span class="c1"># Default output format</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l642">
                  <tt><i>642</i>         <span class="n">player_input</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># Use variable name consistently</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l658">
                  <tt><i>658</i>             <span class="n">target_npc_input</span> <span class="o">=</span> <span class="n">player_input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Get text after the verb</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l751">
                  <tt><i>751</i>         <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span> <span class="c1"># Expecting YES / NO / SUGGEST_TASK</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l772">
                  <tt><i>772</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span> <span class="c1"># Expecting JSON objective back</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l780">
                  <tt><i>780</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span> <span class="c1"># Expecting YES/NO</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l790">
                  <tt><i>790</i>         <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span> <span class="c1"># Expecting YES/NO</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l792">
                  <tt><i>792</i>         <span class="n">player_action</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;player_action&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># Last player input</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l793">
                  <tt><i>793</i>         <span class="n">ai_outcome</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ai_outcome&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="c1"># Last AI response narrating outcome</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l849">
                  <tt><i>849</i>              <span class="n">ai_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># Use empty string if no text</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l857">
                  <tt><i>857</i>                 <span class="n">ai_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># Fallback to empty string on conversion failure</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l871">
                  <tt><i>871</i>                 <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\{.*\}&#39;</span><span class="p">,</span> <span class="n">ai_text</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span> <span class="c1"># Find first JSON-like object</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l885">
                  <tt><i>885</i>         <span class="k">else</span><span class="p">:</span> <span class="c1"># Text output</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l911">
                  <tt><i>911</i>         <span class="s1">&#39;awl_color_bg&#39;</span><span class="p">:</span> <span class="s1">&#39;#FFE6EB&#39;</span><span class="p">,</span> <span class="c1"># Default pinkish bg</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l914">
                  <tt><i>914</i>     <span class="n">fallback_return</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="n">default_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s2">&quot;vocab&quot;</span><span class="p">:</span> <span class="p">{}}</span> <span class="c1"># Use copy</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l921">
                  <tt><i>921</i>     <span class="n">user_settings</span> <span class="o">=</span> <span class="n">default_settings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Start with defaults</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l926">
                  <tt><i>926</i>         <span class="n">profile_doc</span> <span class="o">=</span> <span class="n">profile_ref</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;vocab_settings&#39;</span><span class="p">])</span> <span class="c1"># Only fetch the settings field</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l930">
                  <tt><i>930</i>             <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="c1"># Ensure it&#39;s a dictionary</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l949">
                  <tt><i>949</i>                     <span class="k">if</span> <span class="n">lower_word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">consolidated_vocab</span><span class="p">:</span> <span class="c1"># Avoid overwriting AI list words if same</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l952">
                  <tt><i>952</i>                             <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;AWL&quot;</span> <span class="c1"># Mark source clearly</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l965">
                  <tt><i>965</i>             <span class="n">list_name</span> <span class="o">=</span> <span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;AI List&#39;</span><span class="p">)</span> <span class="c1"># Use list name as source</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l975">
                  <tt><i>975</i>                         <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">list_name</span> <span class="c1"># Use the AI list name as the source</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1036">
                  <tt><i>1036</i>             <span class="n">data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">char_id</span> <span class="c1"># Add doc ID for reference</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1052">
                  <tt><i>1052</i>             <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Use constant if defined, else string</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1055">
                  <tt><i>1055</i>             <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">FS_QUEST_FLAGS</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># Initialize as empty dict if missing</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1056">
                  <tt><i>1056</i>             <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">FS_INVENTORY</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Initialize as empty list if missing</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1063">
                  <tt><i>1063</i>                 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loaded_vocab</span> <span class="c1"># Already a set</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1065">
                  <tt><i>1065</i>                 <span class="n">data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c1"># Fallback for unexpected types</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1101">
                  <tt><i>1101</i>         <span class="n">save_data</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span> <span class="c1"># Ensure user_id is set</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1107">
                  <tt><i>1107</i>             <span class="n">save_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Ensure it&#39;s always a list</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1114">
                  <tt><i>1114</i>         <span class="n">save_data</span><span class="p">[</span><span class="n">FS_QUEST_FLAGS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">save_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_QUEST_FLAGS</span><span class="p">,</span> <span class="p">{}))</span> <span class="c1"># Ensure it&#39;s a dict</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1115">
                  <tt><i>1115</i>         <span class="n">save_data</span><span class="p">[</span><span class="n">FS_INVENTORY</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">save_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_INVENTORY</span><span class="p">,</span> <span class="p">[]))</span> <span class="c1"># Ensure it&#39;s a list</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1118">
                  <tt><i>1118</i>         <span class="n">save_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Don&#39;t save the ID within the document data itself</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1144">
                  <tt><i>1144</i>             <span class="n">save_data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="c1"># Set default only if key is missing</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1167">
                  <tt><i>1167</i>         <span class="n">profile_doc</span> <span class="o">=</span> <span class="n">profile_ref</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;has_premium&#39;</span><span class="p">])</span> <span class="c1"># Only fetch necessary field</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1171">
                  <tt><i>1171</i>             <span class="k">return</span> <span class="kc">False</span> <span class="c1"># Default to False if profile doesn&#39;t exist or lacks field</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1232">
                  <tt><i>1232</i>             <span class="n">actual_value</span> <span class="o">=</span> <span class="n">quest_flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Default to False if flag not set</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1236">
                  <tt><i>1236</i>             <span class="k">return</span> <span class="n">is_complete</span><span class="p">,</span> <span class="kc">None</span> <span class="c1"># No AI check needed</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1263">
                  <tt><i>1263</i>         <span class="k">return</span> <span class="n">all_items_present</span><span class="p">,</span> <span class="kc">None</span> <span class="c1"># No AI check needed</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1272">
                  <tt><i>1272</i>              <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span> <span class="c1"># Treat as invalid trigger</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1293">
                  <tt><i>1293</i>         <span class="k">return</span> <span class="kc">None</span> <span class="c1"># No reward data or player data provided</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1296">
                  <tt><i>1296</i>     <span class="n">value</span> <span class="o">=</span> <span class="n">reward_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="c1"># Used by fate_points</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1297">
                  <tt><i>1297</i>     <span class="n">details</span> <span class="o">=</span> <span class="n">reward_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;details&quot;</span><span class="p">)</span> <span class="c1"># Used by info/relationship</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1298">
                  <tt><i>1298</i>     <span class="n">name</span> <span class="o">=</span> <span class="n">reward_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="c1"># Used by item</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1299">
                  <tt><i>1299</i>     <span class="n">target</span> <span class="o">=</span> <span class="n">reward_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span> <span class="c1"># Used by relationship</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1300">
                  <tt><i>1300</i>     <span class="n">change</span> <span class="o">=</span> <span class="n">reward_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">)</span> <span class="c1"># Used by relationship</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1301">
                  <tt><i>1301</i>     <span class="n">flag_to_set_data</span> <span class="o">=</span> <span class="n">reward_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;set_flag&quot;</span><span class="p">)</span> <span class="c1"># Used by info</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1302">
                  <tt><i>1302</i>     <span class="n">silent</span> <span class="o">=</span> <span class="n">reward_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;silent&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Check if reward announcement should be suppressed</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1305">
                  <tt><i>1305</i>     <span class="n">char_id_log</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="c1"># For logging</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1329">
                  <tt><i>1329</i>                 <span class="n">announcement</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Info: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Use details as the announcement</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1337">
                  <tt><i>1337</i>                          <span class="n">quest_flags</span><span class="p">[</span><span class="n">flag_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag_value</span> <span class="c1"># Set the flag</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1341">
                  <tt><i>1341</i>             <span class="k">elif</span> <span class="n">flag_to_set_data</span><span class="p">:</span> <span class="c1"># Log warning if format is wrong but it exists</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1365">
                  <tt><i>1365</i>                         <span class="n">flag_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;relationship_</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Create a unique, clean flag name</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1367">
                  <tt><i>1367</i>                         <span class="n">current_value</span> <span class="o">=</span> <span class="n">quest_flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flag_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Default to 0</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1386">
                  <tt><i>1386</i>         <span class="n">announcement</span> <span class="o">=</span> <span class="s2">&quot;An error occurred while processing a reward.&quot;</span> <span class="c1"># Generic error for user</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1427">
                  <tt><i>1427</i>             <span class="n">session</span><span class="o">.</span><span class="n">permanent</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Make session persistent</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1467">
                  <tt><i>1467</i>                     <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="c1"># Store email for reference</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1468">
                  <tt><i>1468</i>                     <span class="s1">&#39;player_level&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># Initial player level</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1469">
                  <tt><i>1469</i>                     <span class="s1">&#39;total_player_xp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1"># Initial player XP</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1470">
                  <tt><i>1470</i>                     <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">firestore</span><span class="o">.</span><span class="n">SERVER_TIMESTAMP</span><span class="p">,</span> <span class="c1"># Record creation time</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1471">
                  <tt><i>1471</i>                     <span class="s1">&#39;has_premium&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># Default to non-premium</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1472">
                  <tt><i>1472</i>                     <span class="s1">&#39;vocab_settings&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;use_default_awl&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="c1"># Default vocab setting</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1496">
                  <tt><i>1496</i> <span class="nd">@login_required</span> <span class="c1"># Ensure user must be logged in to log out</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1511">
                  <tt><i>1511</i>         <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Use pop with default None to avoid errors if key missing</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1522">
                  <tt><i>1522</i>     <span class="n">characters</span> <span class="o">=</span> <span class="n">get_user_characters</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="c1"># Fetch user&#39;s characters</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1538">
                  <tt><i>1538</i>             <span class="k">if</span> <span class="n">p_data</span><span class="p">:</span> <span class="c1"># Successfully loaded</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1552">
                  <tt><i>1552</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CONVERSATION</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Load convo log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1553">
                  <tt><i>1553</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Load chapter inputs</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1558">
                  <tt><i>1558</i>             <span class="k">else</span><span class="p">:</span> <span class="c1"># Load failed (error flashed in load_character_data)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1591">
                  <tt><i>1591</i>                 <span class="o">**</span><span class="n">template</span><span class="p">,</span> <span class="c1"># Unpack template data</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1593">
                  <tt><i>1593</i>                 <span class="s1">&#39;learned_vocab&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span> <span class="c1"># Initialize as set</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1620">
                  <tt><i>1620</i>             <span class="k">if</span> <span class="s2">&quot;Artistic Shell&quot;</span> <span class="ow">in</span> <span class="n">new_char_data</span><span class="p">[</span><span class="s1">&#39;abilities&#39;</span><span class="p">]:</span> <span class="n">aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Shell Design: Undefined&quot;</span><span class="p">)</span> <span class="c1"># Example aspect</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1665">
                  <tt><i>1665</i>             <span class="k">else</span><span class="p">:</span> <span class="c1"># Save failed</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1698">
                  <tt><i>1698</i>             <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span> <span class="c1"># Redirect back to profile</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1711">
                  <tt><i>1711</i>     <span class="k">else</span><span class="p">:</span> <span class="c1"># request.method == &#39;GET&#39;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1718">
                  <tt><i>1718</i>             <span class="s1">&#39;vocab_settings&#39;</span><span class="p">:</span> <span class="p">{</span> <span class="c1"># Initialize with ALL defaults</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1720">
                  <tt><i>1720</i>                 <span class="s1">&#39;awl_color_bg&#39;</span><span class="p">:</span> <span class="s1">&#39;#FFE6EB&#39;</span><span class="p">,</span> <span class="c1"># Default pinkish</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1739">
                  <tt><i>1739</i>                     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">saved_settings</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span> <span class="c1"># Check if it&#39;s a dict</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1755">
                  <tt><i>1755</i>             <span class="n">profile</span><span class="o">=</span><span class="n">profile_data</span><span class="p">,</span> <span class="c1"># Pass the full profile data, including vocab_settings</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1794">
                  <tt><i>1794</i>                     <span class="n">char_details</span><span class="o">=</span><span class="n">char_details</span><span class="p">,</span> <span class="c1"># Pass back entered details</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1796">
                  <tt><i>1796</i>                     <span class="n">reviewing</span><span class="o">=</span><span class="kc">False</span> <span class="c1"># Ensure fields are editable</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1815">
                  <tt><i>1815</i>                 <span class="n">recommendations</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Indicate review failure</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1830">
                  <tt><i>1830</i>                 <span class="n">reviewing</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># Now in review mode</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1871">
                  <tt><i>1871</i>                 <span class="s1">&#39;learned_vocab&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span> <span class="c1"># Initialize as set</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1880">
                  <tt><i>1880</i>             <span class="n">final_char_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">final_details</span><span class="p">)</span> <span class="c1"># Add the form details</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1886">
                  <tt><i>1886</i>             <span class="n">start_goal</span> <span class="o">=</span> <span class="n">final_char_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;starting_quest&#39;</span><span class="p">,</span> <span class="s1">&#39;Find purpose&#39;</span><span class="p">)</span> <span class="c1"># Use form input</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1908">
                  <tt><i>1908</i>                 <span class="k">if</span> <span class="s2">&quot;Artistic Shell&quot;</span> <span class="ow">in</span> <span class="n">final_char_data</span><span class="p">[</span><span class="s1">&#39;abilities&#39;</span><span class="p">]:</span> <span class="n">aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Shell Design: Undefined&quot;</span><span class="p">)</span> <span class="c1"># Example</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1915">
                  <tt><i>1915</i>                 <span class="n">final_char_data</span><span class="p">[</span><span class="s1">&#39;current_quest_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Q_CH1_</span><span class="si">{</span><span class="n">new_char_id</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Unique ID</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1916">
                  <tt><i>1916</i>                 <span class="n">final_char_data</span><span class="p">[</span><span class="s1">&#39;current_quest_title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Chapter 1: </span><span class="si">{</span><span class="n">start_goal</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span> <span class="c1"># Title from goal</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1918">
                  <tt><i>1918</i>                 <span class="n">final_char_data</span><span class="p">[</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_goal</span> <span class="c1"># Step desc from goal</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1945">
                  <tt><i>1945</i>                 <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span> <span class="c1"># Go back to profile after creation</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1962">
                  <tt><i>1962</i>     <span class="k">else</span><span class="p">:</span> <span class="c1"># request.method == &#39;GET&#39;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1980">
                  <tt><i>1980</i>                 <span class="n">ai_recommendations</span><span class="o">=</span><span class="n">recommendations_from_session</span><span class="p">,</span> <span class="c1"># Pass recommendations if they exist</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1981">
                  <tt><i>1981</i>                 <span class="n">reviewing</span><span class="o">=</span><span class="n">is_reviewing_stage</span> <span class="c1"># Pass the flag to template</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1995">
                  <tt><i>1995</i>                 <span class="n">char_details</span><span class="o">=</span><span class="p">{},</span> <span class="c1"># Empty initial details</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1996">
                  <tt><i>1996</i>                 <span class="n">ai_recommendations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># No recommendations</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1997">
                  <tt><i>1997</i>                 <span class="n">reviewing</span><span class="o">=</span><span class="kc">False</span> <span class="c1"># Not reviewing</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2035">
                  <tt><i>2035</i>         <span class="n">list_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39; Context&quot;</span> <span class="c1"># Create a descriptive name</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2036">
                  <tt><i>2036</i>         <span class="n">list_color</span> <span class="o">=</span> <span class="n">DEFAULT_VOCAB_LIST_COLOR</span> <span class="c1"># Use default color</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2039">
                  <tt><i>2039</i>             <span class="s2">&quot;is_ai_generated&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">firestore</span><span class="o">.</span><span class="n">SERVER_TIMESTAMP</span><span class="p">,</span> <span class="s2">&quot;is_active&quot;</span><span class="p">:</span> <span class="kc">True</span> <span class="c1"># Activate by default</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2067">
                  <tt><i>2067</i>         <span class="n">list_doc</span> <span class="o">=</span> <span class="n">list_ref</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;is_active&#39;</span><span class="p">])</span> <span class="c1"># Only fetch the field we need</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2075">
                  <tt><i>2075</i>         <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vocabulary list status updated.&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span> <span class="c1"># User feedback</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2089">
                  <tt><i>2089</i>         <span class="n">list_doc</span> <span class="o">=</span> <span class="n">list_ref</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="c1"># Get name for logging/feedback</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2096">
                  <tt><i>2096</i>         <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vocabulary list &#39;</span><span class="si">{</span><span class="n">list_name</span><span class="si">}</span><span class="s2">&#39; deleted.&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span> <span class="c1"># User feedback</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2116">
                  <tt><i>2116</i>     <span class="k">if</span> <span class="ow">not</span> <span class="n">p_data</span><span class="p">:</span> <span class="c1"># Handle case where character fails to load</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2117">
                  <tt><i>2117</i>         <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_CHARACTER_ID</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Clear invalid character ID from session</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2132">
                  <tt><i>2132</i>     <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Mark session as modified after sync</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2133">
                  <tt><i>2133</i>     <span class="n">curr_loc</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LOCATION</span><span class="p">]</span> <span class="c1"># Use local variable for current location</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2145">
                  <tt><i>2145</i>             <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;game_view&#39;</span><span class="p">))</span> <span class="c1"># Ignore empty input silently</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2152">
                  <tt><i>2152</i>             <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span> <span class="c1"># Save after adding system message</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2158">
                  <tt><i>2158</i>             <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Reset flag regardless of answer</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2159">
                  <tt><i>2159</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Reset session flag too</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2164">
                  <tt><i>2164</i>                 <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;turn_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Reset turn count for EOC</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2165">
                  <tt><i>2165</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span> <span class="c1"># Set session state to start EOC</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2166">
                  <tt><i>2166</i>                 <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span> <span class="c1"># Save reset flag/turn count</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2171">
                  <tt><i>2171</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log</span> <span class="c1"># Update session log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2172">
                  <tt><i>2172</i>                 <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span> <span class="c1"># Update persistent log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2173">
                  <tt><i>2173</i>                 <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span> <span class="c1"># Save reset flag &amp; message</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2175">
                  <tt><i>2175</i>             <span class="k">else</span><span class="p">:</span> <span class="c1"># Ambiguous response</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2176">
                  <tt><i>2176</i>                 <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;Player&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">p_input</span><span class="p">})</span> <span class="c1"># Log their input</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2180">
                  <tt><i>2180</i>                 <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Re-prompt by setting flag back</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2181">
                  <tt><i>2181</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Re-prompt by setting flag back</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2191">
                  <tt><i>2191</i>             <span class="k">if</span> <span class="n">side_quest_desc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Player defining task</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2200">
                  <tt><i>2200</i>                     <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_TURNS</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Start turn count</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2203">
                  <tt><i>2203</i>                 <span class="k">else</span><span class="p">:</span> <span class="c1"># Failed processing</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2204">
                  <tt><i>2204</i>                     <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Let&#39;s try simpler. What would you like to observe or interact with briefly?&quot;</span><span class="p">})</span> <span class="c1"># Ask again</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2207">
                  <tt><i>2207</i>             <span class="k">else</span><span class="p">:</span> <span class="c1"># Player performing task</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2236">
                  <tt><i>2236</i>                      <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;turn_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Reset main turn count for EOC</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2237">
                  <tt><i>2237</i>                      <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span> <span class="c1"># Save log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2240">
                  <tt><i>2240</i>                      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;end_of_chapter&#39;</span><span class="p">))</span> <span class="c1"># Go straight to EOC</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2253">
                  <tt><i>2253</i>         <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">chapter_inputs_log</span> <span class="c1"># Update session log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2287">
                  <tt><i>2287</i>             <span class="s1">&#39;player_aspects&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aspects&#39;</span><span class="p">,[]),</span> <span class="c1"># Include aspects</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2290">
                  <tt><i>2290</i>             <span class="s1">&#39;location_data&#39;</span><span class="p">:</span> <span class="n">world_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span> <span class="c1"># Exits, etc.</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2291">
                  <tt><i>2291</i>             <span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span> <span class="c1"># Desc, NPCs</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2292">
                  <tt><i>2292</i>             <span class="s1">&#39;thetopia_general_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;setting&#39;</span><span class="p">,{}),</span> <span class="c1"># World context</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2317">
                  <tt><i>2317</i>                 <span class="n">norm_d</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Take first word</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2319">
                  <tt><i>2319</i>                 <span class="n">final_d</span> <span class="o">=</span> <span class="n">d_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">norm_d</span><span class="p">,</span> <span class="n">norm_d</span><span class="p">)</span> <span class="c1"># Map abbreviations</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2323">
                  <tt><i>2323</i>                     <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;current_location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_loc</span> <span class="c1"># Update character data</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2324">
                  <tt><i>2324</i>                     <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LOCATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_loc</span> <span class="c1"># Update session</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2325">
                  <tt><i>2325</i>                     <span class="n">curr_loc</span> <span class="o">=</span> <span class="n">new_loc</span> <span class="c1"># Update local variable for this request</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2326">
                  <tt><i>2326</i>                     <span class="n">ai_resp</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;You move </span><span class="si">{</span><span class="n">final_d</span><span class="si">}</span><span class="s2">...&quot;</span> <span class="c1"># Simple confirmation</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2327">
                  <tt><i>2327</i>                     <span class="n">needs_desc_after_move</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Flag to get description later</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2343">
                  <tt><i>2343</i>                             <span class="n">abil_input</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="c1"># Fallback to capitalized input</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2373">
                  <tt><i>2373</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LAST_AI_OUTPUT</span><span class="p">]</span> <span class="o">=</span> <span class="n">ai_resp</span> <span class="c1"># Store last output for potential AI check</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2379">
                  <tt><i>2379</i>         <span class="k">if</span> <span class="n">q_id</span> <span class="ow">and</span> <span class="n">s_id</span><span class="p">:</span> <span class="c1"># Only check if on a quest step</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2393">
                  <tt><i>2393</i>                         <span class="s1">&#39;ai_outcome&#39;</span><span class="p">:</span> <span class="n">ai_resp</span> <span class="ow">or</span> <span class="s2">&quot;(No AI response this turn)&quot;</span><span class="p">,</span> <span class="c1"># Use last AI response</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2394">
                  <tt><i>2394</i>                         <span class="s1">&#39;ai_check_criteria&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;if the action fulfilled: &#39;</span><span class="si">{</span><span class="n">ai_check_criteria</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="c1"># Add context for AI</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2413">
                  <tt><i>2413</i>             <span class="n">step_data</span> <span class="o">=</span> <span class="n">get_quest_step</span><span class="p">(</span><span class="n">q_id</span><span class="p">,</span> <span class="n">s_id</span><span class="p">)</span> <span class="c1"># Re-fetch step data</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2428">
                  <tt><i>2428</i>                 <span class="n">step_was_final</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_s_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># It&#39;s final if no next_step defined</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2453">
                  <tt><i>2453</i>                     <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;turn_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Reset turns for EOC</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2469">
                  <tt><i>2469</i>                         <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;current_quest_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;current_step_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># End quest</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2494">
                  <tt><i>2494</i>                 <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">curr_loc</span><span class="p">,</span> <span class="c1"># Use the updated location</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2510">
                  <tt><i>2510</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_LAST_AI_OUTPUT</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc_txt</span> <span class="c1"># Update last AI output</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2517">
                  <tt><i>2517</i>             <span class="ow">not</span> <span class="n">step_completed_this_turn</span> <span class="c1"># Don&#39;t suggest EOC on the same turn a step was completed</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2520">
                  <tt><i>2520</i>             <span class="n">eoc_check_context</span> <span class="o">=</span> <span class="n">ai_context</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Use the main context from this turn</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2524">
                  <tt><i>2524</i>             <span class="n">recent_conv_log</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_CONVERSATION</span><span class="p">,</span> <span class="p">[])[:]</span> <span class="c1"># Copy log before this turn</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2525">
                  <tt><i>2525</i>             <span class="n">recent_conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;Player&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="n">p_input</span><span class="p">})</span> <span class="c1"># Add player input</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2526">
                  <tt><i>2526</i>             <span class="k">if</span> <span class="n">ai_resp</span><span class="p">:</span> <span class="n">recent_conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="n">ai_resp</span><span class="p">})</span> <span class="c1"># Add AI output</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2532">
                  <tt><i>2532</i>                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;speaker&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">][:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Truncate long messages</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2533">
                  <tt><i>2533</i>                 <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">recent_conv_log</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span> <span class="c1"># Take last 6 entries</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2543">
                  <tt><i>2543</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Set persistent flag</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2544">
                  <tt><i>2544</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Set session flag</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2554">
                  <tt><i>2554</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Desc will be set by player response</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2556">
                  <tt><i>2556</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Ensure EOC prompt is off</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2561">
                  <tt><i>2561</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Ensure EOC prompt is off</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2566">
                  <tt><i>2566</i>         <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span> <span class="c1"># Update session log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2567">
                  <tt><i>2567</i>         <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="c1"># Update data to be saved</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2568">
                  <tt><i>2568</i>         <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">]</span> <span class="c1"># Update data to be saved</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2569">
                  <tt><i>2569</i>         <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># Sync EOC prompt status</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2573">
                  <tt><i>2573</i>         <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Mark session as modified</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2585">
                  <tt><i>2585</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span> <span class="c1"># Set state for EOC route</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2589">
                  <tt><i>2589</i>             <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;game_view&#39;</span><span class="p">))</span> <span class="c1"># Continue in game view</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2592">
                  <tt><i>2592</i>     <span class="k">else</span><span class="p">:</span> <span class="c1"># request.method == &#39;GET&#39;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2595">
                  <tt><i>2595</i>         <span class="n">show_intro_this_time</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Flag to indicate if intro is displayed *this* time</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2619">
                  <tt><i>2619</i>             <span class="n">show_intro_this_time</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Mark that we are showing it now</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2661">
                  <tt><i>2661</i>         <span class="n">conv_log_from_session</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_CONVERSATION</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Get potentially updated log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2662">
                  <tt><i>2662</i>         <span class="n">vocab_info</span> <span class="o">=</span> <span class="n">get_active_vocab_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="c1"># Gets settings (inc. colors) and vocab</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2664">
                  <tt><i>2664</i>         <span class="n">vocab_settings</span> <span class="o">=</span> <span class="n">vocab_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;settings&quot;</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># Extract settings dict</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2691">
                  <tt><i>2691</i>                       <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log_from_session</span> <span class="c1"># Update session log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2707">
                  <tt><i>2707</i>             <span class="k">if</span> <span class="n">speaker</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;AI&#39;</span><span class="p">,</span> <span class="s1">&#39;Storyteller&#39;</span><span class="p">]:</span> <span class="c1"># &lt;&lt;&lt; REVISED: Include Storyteller &gt;&gt;&gt;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2710">
                  <tt><i>2710</i>                  <span class="n">processed_message</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_with_all_highlights</span> <span class="c1"># Use safe HTML</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2719">
                  <tt><i>2719</i>         <span class="n">template_data</span><span class="p">[</span><span class="s1">&#39;current_location_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">curr_loc</span> <span class="c1"># Add location name</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2726">
                  <tt><i>2726</i>         <span class="n">lore_data_for_json</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># Initialize empty dict</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2728">
                  <tt><i>2728</i>             <span class="n">current_lore</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thetopia_lore&#39;</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># Safely access global</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2733">
                  <tt><i>2733</i>                     <span class="n">lore_data_for_json</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># Get each section safely</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2740">
                  <tt><i>2740</i>              <span class="n">thetopia_lore_json</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span> <span class="c1"># Fallback empty JSON</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2743">
                  <tt><i>2743</i>              <span class="n">thetopia_lore_json</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span> <span class="c1"># Fallback empty JSON</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2751">
                  <tt><i>2751</i>                  <span class="n">thetopia_lore_data</span><span class="o">=</span><span class="n">thetopia_lore_json</span> <span class="c1"># Pass JSON string</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2773">
                  <tt><i>2773</i>         <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span> <span class="c1"># Redirect if char load fails</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2783">
                  <tt><i>2783</i>         <span class="n">entry</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;word&quot;</span><span class="p">:</span> <span class="n">word</span><span class="p">,</span> <span class="s2">&quot;definition&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;definition&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">),</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">)}</span> <span class="c1"># Placeholder color</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2786">
                  <tt><i>2786</i>         <span class="k">else</span><span class="p">:</span> <span class="c1"># Group AI words by their list name (source)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2805">
                  <tt><i>2805</i>                 <span class="s2">&quot;created_at&quot;</span><span class="p">:</span> <span class="n">list_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span> <span class="c1"># For sorting</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2808">
                  <tt><i>2808</i>         <span class="n">ai_lists_metadata</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Use 0 as fallback for sort</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2822">
                  <tt><i>2822</i>         <span class="n">ai_word_lists</span><span class="o">=</span><span class="n">ai_words_by_list</span><span class="p">,</span> <span class="c1"># Pass dict grouped by list name</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2823">
                  <tt><i>2823</i>         <span class="n">ai_lists_metadata</span><span class="o">=</span><span class="n">ai_lists_metadata</span><span class="p">,</span> <span class="c1"># Pass list metadata for management</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2825">
                  <tt><i>2825</i>         <span class="n">premium_active</span><span class="o">=</span><span class="n">check_premium_access</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="c1"># Pass premium status for UI elements</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2840">
                  <tt><i>2840</i>         <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span> <span class="c1"># Redirect if char load fails</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2843">
                  <tt><i>2843</i>     <span class="n">sheet_data</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Work with a copy</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2845">
                  <tt><i>2845</i>     <span class="n">fields_to_pop</span> <span class="o">=</span> <span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">,</span> <span class="n">FS_CHAPTER_INPUTS</span><span class="p">,</span> <span class="n">FS_QUEST_FLAGS</span><span class="p">]</span> <span class="c1"># Keep FS_INVENTORY now!</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2863">
                  <tt><i>2863</i>     <span class="n">inventory_list</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_INVENTORY</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># Get inventory list</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2870">
                  <tt><i>2870</i>         <span class="n">inventory</span><span class="o">=</span><span class="n">inventory_list</span> <span class="c1"># Pass the inventory list</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2889">
                  <tt><i>2889</i>         <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Clear EOC state too</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2893">
                  <tt><i>2893</i>     <span class="n">eoc_state</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="s1">&#39;START&#39;</span><span class="p">)</span> <span class="c1"># Get current EOC state from session</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2903">
                  <tt><i>2903</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span><span class="p">;</span> <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Reset state</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2917">
                  <tt><i>2917</i>             <span class="n">comp_score</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># Default score</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2921">
                  <tt><i>2921</i>                     <span class="n">comp_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">comp_score</span><span class="p">))</span> <span class="c1"># Clamp score</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2931">
                  <tt><i>2931</i>                 <span class="n">chapter_text</span> <span class="o">=</span> <span class="s2">&quot;(No player inputs recorded for this chapter)&quot;</span> <span class="c1"># Handle empty</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2942">
                  <tt><i>2942</i>                 <span class="mi">5</span> <span class="c1"># Base completion XP</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2949">
                  <tt><i>2949</i>                 <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">comp_score</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="c1"># Bonus for comprehension &gt; 5</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2951">
                  <tt><i>2951</i>             <span class="n">xp_gained</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xp_gained</span><span class="p">)</span> <span class="c1"># Ensure XP is not negative</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2965">
                  <tt><i>2965</i>                     <span class="n">xp_for_next</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_level</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># Example XP threshold</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2996">
                  <tt><i>2996</i>                 <span class="s2">&quot;analysis_raw&quot;</span><span class="p">:</span> <span class="n">anal_res</span> <span class="c1"># Store raw analysis</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2999">
                  <tt><i>2999</i>             <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Clear chapter inputs</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3002">
                  <tt><i>3002</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_SUMMARY</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_text</span> <span class="c1"># Store summary for display</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3003">
                  <tt><i>3003</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AWAIT_REPORT_ACK&#39;</span> <span class="c1"># Move to next state</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3004">
                  <tt><i>3004</i>             <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_CHAPTER_INPUTS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Clear chapter inputs from session</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3005">
                  <tt><i>3005</i>             <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># Clear questions from session</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3007">
                  <tt><i>3007</i>             <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span> <span class="c1"># Save updated character data</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3008">
                  <tt><i>3008</i>             <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;end_of_chapter&#39;</span><span class="p">))</span> <span class="c1"># Redirect to show report</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3041">
                  <tt><i>3041</i>                      <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New objective received: </span><span class="si">{</span><span class="n">next_q_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span> <span class="c1"># Inform player</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3042">
                  <tt><i>3042</i>             <span class="k">else</span><span class="p">:</span> <span class="c1"># Handle AI error</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3053">
                  <tt><i>3053</i>             <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Ensure clear for new chapter start</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3054">
                  <tt><i>3054</i>             <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;turn_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Reset turn count for new chapter</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3061">
                  <tt><i>3061</i>             <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span> <span class="c1"># Save final character state</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3062">
                  <tt><i>3062</i>             <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;game_view&#39;</span><span class="p">))</span> <span class="c1"># Redirect back to the game</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3073">
                  <tt><i>3073</i>     <span class="k">else</span><span class="p">:</span> <span class="c1"># request.method == &#39;GET&#39;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3076">
                  <tt><i>3076</i>             <span class="n">questions</span> <span class="o">=</span> <span class="p">[</span> <span class="c1"># Example questions</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3081">
                  <tt><i>3081</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_QUESTIONS</span><span class="p">]</span> <span class="o">=</span> <span class="n">questions</span> <span class="c1"># Store questions in session</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3082">
                  <tt><i>3082</i>             <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;AWAIT_COMP_ANSWERS&#39;</span> <span class="c1"># Update state</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3141">
                  <tt><i>3141</i>         <span class="n">char_doc</span> <span class="o">=</span> <span class="n">char_ref</span><span class="o">.</span><span class="n">get</span><span class="p">([</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="c1"># Fetch only needed fields</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3175">
                  <tt><i>3175</i>     <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span> <span class="c1"># Redirect back to profile page</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3181">
                  <tt><i>3181</i>     <span class="n">host</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FLASK_RUN_HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span> <span class="c1"># Default host</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3182">
                  <tt><i>3182</i>     <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;FLASK_RUN_PORT&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span> <span class="c1"># Default port</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3187">
                  <tt><i>3187</i>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Starting Daydream Server V5.3 ---&quot;</span><span class="p">)</span> <span class="c1"># &lt;&lt;&lt; Updated version number &gt;&gt;&gt;</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E111">
               <span class="count sev-2">
                  166
               </span>
               <strong>E111:</strong> indentation is not a multiple of 4

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l140">
                  <tt><i>140</i>              <span class="n">lore_vocabulary</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l500">
                  <tt><i>500</i> <span class="w">     </span><span class="sd">&quot;&quot;&quot;Applies highlighting spans for lore terms in Python.&quot;&quot;&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l501">
                  <tt><i>501</i>      <span class="k">if</span> <span class="ow">not</span> <span class="n">lore_vocab</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l502">
                  <tt><i>502</i>          <span class="k">return</span> <span class="n">text</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l505">
                  <tt><i>505</i>      <span class="n">processed_lore_terms</span> <span class="o">=</span> <span class="p">{}</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l506">
                  <tt><i>506</i>      <span class="k">for</span> <span class="n">keyword</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">lore_vocab</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l507">
                  <tt><i>507</i>          <span class="n">processed_lore_terms</span><span class="p">[</span><span class="n">keyword</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l513">
                  <tt><i>513</i>      <span class="n">found_terms</span> <span class="o">=</span> <span class="n">find_terms_in_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">processed_lore_terms</span><span class="p">,</span> <span class="n">key_transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l516">
                  <tt><i>516</i>      <span class="k">def</span><span class="w"> </span><span class="nf">format_lore_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l518">
                  <tt><i>518</i>          <span class="n">path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lore_path&quot;</span><span class="p">,</span> <span class="p">[])</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l519">
                  <tt><i>519</i>          <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;#39;&quot;</span><span class="p">)</span> <span class="c1"># Use HTML entity for single quote</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l521">
                  <tt><i>521</i>      <span class="k">def</span><span class="w"> </span><span class="nf">format_lore_title</span><span class="p">(</span><span class="n">data</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l523">
                  <tt><i>523</i>          <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Lore: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;display_term&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l525">
                  <tt><i>525</i>      <span class="k">def</span><span class="w"> </span><span class="nf">format_lore_display</span><span class="p">(</span><span class="n">original_keyword</span><span class="p">,</span> <span class="n">matched_text</span><span class="p">,</span> <span class="n">term_data</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l527">
                  <tt><i>527</i>          <span class="k">return</span> <span class="n">term_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;display_term&quot;</span><span class="p">,</span> <span class="n">matched_text</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l530">
                  <tt><i>530</i>      <span class="n">highlighted_text</span> <span class="o">=</span> <span class="n">process_text_for_highlighting</span><span class="p">(</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l539">
                  <tt><i>539</i>      <span class="k">return</span> <span class="n">highlighted_text</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l686">
                  <tt><i>686</i>                  <span class="n">prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Interaction Note: </span><span class="si">{</span><span class="n">npc_detail</span><span class="si">}</span><span class="s2">. Ask player to clarify who they are talking to if ambiguous.&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l689">
                  <tt><i>689</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l690">
                  <tt><i>690</i>          <span class="n">text_to_analyze</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;chapter_player_text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l691">
                  <tt><i>691</i>          <span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l706">
                  <tt><i>706</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l707">
                  <tt><i>707</i>          <span class="n">questions</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;questions&#39;</span><span class="p">,</span> <span class="p">[])</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l708">
                  <tt><i>708</i>          <span class="n">answers</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;answers&#39;</span><span class="p">,</span> <span class="p">[])</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l709">
                  <tt><i>709</i>          <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Evaluate the player&#39;s answers based on their understanding of the chapter events, relevance to the questions, and evidence of reasoning (scale 1-10 for each answer).</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="se">\n</span><span class="s2">A</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="p">(</span><span class="n">answers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">answers</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;(No Answer)&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">questions</span><span class="p">)])</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Provide an overall average comprehension score (float, 1-10).</span><span class="se">\n</span><span class="s2">Respond ONLY with JSON: </span><span class="se">{{\&quot;</span><span class="s2">overall_comprehension_score</span><span class="se">\&quot;</span><span class="s2">: float</span><span class="se">}}</span><span class="s2">.&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l766">
                  <tt><i>766</i>          <span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l772">
                  <tt><i>772</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span> <span class="c1"># Expecting JSON objective back</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l773">
                  <tt><i>773</i>          <span class="n">player_idea</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;player_sidequest_idea&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l774">
                  <tt><i>774</i>          <span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l780">
                  <tt><i>780</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span> <span class="c1"># Expecting YES/NO</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l781">
                  <tt><i>781</i>          <span class="n">side_quest_obj</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;side_quest_objective&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l782">
                  <tt><i>782</i>          <span class="n">recent_conv</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;conversation_summary&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l783">
                  <tt><i>783</i>          <span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l820">
                  <tt><i>820</i>              <span class="n">feedback</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;prompt_feedback&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l821">
                  <tt><i>821</i>              <span class="n">block_reason</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">feedback</span><span class="p">,</span> <span class="s1">&#39;block_reason&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">feedback</span> <span class="k">else</span> <span class="s1">&#39;Unknown&#39;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l822">
                  <tt><i>822</i>              <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Blocked: </span><span class="si">{</span><span class="n">block_reason</span><span class="si">}</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l823">
                  <tt><i>823</i>              <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI response blocked for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;. Reason: </span><span class="si">{</span><span class="n">block_reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l824">
                  <tt><i>824</i>              <span class="n">is_json</span> <span class="o">=</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l825">
                  <tt><i>825</i>              <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI Error&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">}</span> <span class="k">if</span> <span class="n">is_json</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;Error: AI response blocked (</span><span class="si">{</span><span class="n">block_reason</span><span class="si">}</span><span class="s2">).&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l836">
                  <tt><i>836</i>                  <span class="n">ratings_str_list</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">probability</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">candidate</span><span class="o">.</span><span class="n">safety_ratings</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">blocked</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l837">
                  <tt><i>837</i>                  <span class="k">if</span> <span class="n">ratings_str_list</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l838">
                  <tt><i>838</i>                      <span class="n">safety_ratings_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; [</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ratings_str_list</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l848">
                  <tt><i>848</i>              <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI response content is empty for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l849">
                  <tt><i>849</i>              <span class="n">ai_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># Use empty string if no text</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l862">
                  <tt><i>862</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI returned an empty string when JSON was expected for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l863">
                  <tt><i>863</i>                  <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI Error&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Empty JSON response&quot;</span><span class="p">}</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l894">
                  <tt><i>894</i>          <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vertex AI API call failed for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">api_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l895">
                  <tt><i>895</i>          <span class="n">is_json</span> <span class="o">=</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l897">
                  <tt><i>897</i>          <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI Error&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;API Call Failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">api_err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span> <span class="k">if</span> <span class="n">is_json</span> <span class="k">else</span> <span class="s2">&quot;Error: Could not communicate with the Storyteller AI.&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l997">
                  <tt><i>997</i>          <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User ID not provided to get_user_characters.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l998">
                  <tt><i>998</i>          <span class="k">return</span> <span class="n">chars</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1271">
                  <tt><i>1271</i>              <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI Check trigger found for step </span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> but condition is empty.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1272">
                  <tt><i>1272</i>              <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span> <span class="c1"># Treat as invalid trigger</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1317">
                  <tt><i>1317</i>                          <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Character </span><span class="si">{</span><span class="n">char_id_log</span><span class="si">}</span><span class="s2"> fate_points field is not numeric (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">current_fp</span><span class="p">)</span><span class="si">}</span><span class="s2">). Resetting to base before applying change.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1318">
                  <tt><i>1318</i>                          <span class="n">current_fp</span> <span class="o">=</span> <span class="n">BASE_FATE_POINTS</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1337">
                  <tt><i>1337</i>                          <span class="n">quest_flags</span><span class="p">[</span><span class="n">flag_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag_value</span> <span class="c1"># Set the flag</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1338">
                  <tt><i>1338</i>                          <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Set quest flag &#39;</span><span class="si">{</span><span class="n">flag_name</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">flag_value</span><span class="si">}</span><span class="s2">&#39; via info reward.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1340">
                  <tt><i>1340</i>                          <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Invalid flag name (&#39;</span><span class="si">{</span><span class="n">flag_name</span><span class="si">}</span><span class="s2">&#39;) or value (&#39;</span><span class="si">{</span><span class="n">flag_value</span><span class="si">}</span><span class="s2">&#39;) in &#39;set_flag&#39; for info reward. Flag name must be string, value must be boolean.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1342">
                  <tt><i>1342</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Invalid &#39;set_flag&#39; format in info reward: </span><span class="si">{</span><span class="n">flag_to_set_data</span><span class="si">}</span><span class="s2">. Expected a dictionary </span><span class="se">{{</span><span class="s2">&#39;flag_name&#39;: True/False</span><span class="se">}}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1348">
                  <tt><i>1348</i>                  <span class="n">inventory_list</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">FS_INVENTORY</span><span class="p">,</span> <span class="p">[])</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1349">
                  <tt><i>1349</i>                  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inventory_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1350">
                  <tt><i>1350</i>                      <span class="n">inventory_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1351">
                  <tt><i>1351</i>                      <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1352">
                  <tt><i>1352</i>                          <span class="n">announcement</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;You obtained: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1353">
                  <tt><i>1353</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Added item &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; to inventory.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1354">
                  <tt><i>1354</i>                  <span class="k">else</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1355">
                  <tt><i>1355</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Character </span><span class="si">{</span><span class="n">char_id_log</span><span class="si">}</span><span class="s2"> inventory field is not a list. Cannot add item &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1361">
                  <tt><i>1361</i>              <span class="k">if</span> <span class="n">target</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1378">
                  <tt><i>1378</i>              <span class="k">else</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1637">
                  <tt><i>1637</i>                              <span class="n">start_s_desc</span> <span class="o">=</span> <span class="n">start_s_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;Begin your journey.&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1889">
                  <tt><i>1889</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required character detail (Race/Class/Philosophy). Please start over.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1890">
                  <tt><i>1890</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing essential name(s) finalizing character for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: R=</span><span class="si">{</span><span class="n">race_name</span><span class="si">}</span><span class="s2">, C=</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">, P=</span><span class="si">{</span><span class="n">philosophy_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1891">
                  <tt><i>1891</i>                  <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1892">
                  <tt><i>1892</i>                  <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1893">
                  <tt><i>1893</i>                  <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1894">
                  <tt><i>1894</i>                  <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;character_creation_view&#39;</span><span class="p">))</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1921">
                  <tt><i>1921</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Internal data error finding details for </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Please check selections.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1922">
                  <tt><i>1922</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KeyError finalizing character for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1923">
                  <tt><i>1923</i>                  <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1924">
                  <tt><i>1924</i>                  <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1925">
                  <tt><i>1925</i>                  <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1926">
                  <tt><i>1926</i>                  <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;character_creation_view&#39;</span><span class="p">))</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1928">
                  <tt><i>1928</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred calculating character stats: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Please start over.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1929">
                  <tt><i>1929</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calculating derived fields for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1930">
                  <tt><i>1930</i>                  <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1931">
                  <tt><i>1931</i>                  <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1932">
                  <tt><i>1932</i>                  <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1933">
                  <tt><i>1933</i>                  <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;character_creation_view&#39;</span><span class="p">))</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2228">
                  <tt><i>2228</i>                      <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Finished with that detour. Now, let&#39;s reflect on the main chapter...&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2229">
                  <tt><i>2229</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Player </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> completed side quest: </span><span class="si">{</span><span class="n">side_quest_desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2231">
                  <tt><i>2231</i>                      <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_ACTIVE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2232">
                  <tt><i>2232</i>                      <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2233">
                  <tt><i>2233</i>                      <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_SIDE_QUEST_TURNS</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2235">
                  <tt><i>2235</i>                      <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2236">
                  <tt><i>2236</i>                      <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;turn_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Reset main turn count for EOC</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2237">
                  <tt><i>2237</i>                      <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span> <span class="c1"># Save log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2238">
                  <tt><i>2238</i>                      <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2239">
                  <tt><i>2239</i>                      <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2240">
                  <tt><i>2240</i>                      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;end_of_chapter&#39;</span><span class="p">))</span> <span class="c1"># Go straight to EOC</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2269">
                  <tt><i>2269</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> gained </span><span class="si">{</span><span class="n">player_xp_gain</span><span class="si">}</span><span class="s2"> Player XP this turn.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2270">
                  <tt><i>2270</i>                  <span class="k">try</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2271">
                  <tt><i>2271</i>                      <span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="p">(</span><span class="s1">&#39;player_profiles&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">document</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">({</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2274">
                  <tt><i>2274</i>                  <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">xp_err</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2275">
                  <tt><i>2275</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to update Player XP in Firestore for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">xp_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2542">
                  <tt><i>2542</i>                  <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="s2">&quot;This feels like a good place to pause and reflect on this chapter. Shall we conclude it? (yes/no)&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2543">
                  <tt><i>2543</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Set persistent flag</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2544">
                  <tt><i>2544</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Set session flag</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2545">
                  <tt><i>2545</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI suggested EOC for </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Player prompted.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2548">
                  <tt><i>2548</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI suggested player side quest for </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2549">
                  <tt><i>2549</i>                  <span class="n">side_quest_init_ctx</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;current_location&#39;</span><span class="p">]}</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2550">
                  <tt><i>2550</i>                  <span class="n">init_resp</span> <span class="o">=</span> <span class="n">get_ai_response</span><span class="p">(</span><span class="s2">&quot;INITIATE_PLAYER_SIDEQUEST&quot;</span><span class="p">,</span> <span class="n">side_quest_init_ctx</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2551">
                  <tt><i>2551</i>                  <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">init_resp</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2553">
                  <tt><i>2553</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_ACTIVE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2554">
                  <tt><i>2554</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Desc will be set by player response</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2555">
                  <tt><i>2555</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_SIDE_QUEST_TURNS</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2556">
                  <tt><i>2556</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Ensure EOC prompt is off</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2557">
                  <tt><i>2557</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2560">
                  <tt><i>2560</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI EOC check result: &#39;</span><span class="si">{</span><span class="n">suggestion</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Continuing chapter.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2561">
                  <tt><i>2561</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Ensure EOC prompt is off</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2562">
                  <tt><i>2562</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_PROMPTED</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2640">
                  <tt><i>2640</i>                  <span class="n">conv_log_for_session</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;Storyteller&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">intro_text</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2641">
                  <tt><i>2641</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log_for_session</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2642">
                  <tt><i>2642</i>                  <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2644">
                  <tt><i>2644</i>                  <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log_for_session</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2653">
                  <tt><i>2653</i>                      <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2671">
                  <tt><i>2671</i>              <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running INITIAL_SETUP AI for new character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> (Turn 0, Intro not shown this load).&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2673">
                  <tt><i>2673</i>              <span class="n">ai_context</span> <span class="o">=</span> <span class="p">{</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2685">
                  <tt><i>2685</i>              <span class="n">initial_ai_response</span> <span class="o">=</span> <span class="n">get_ai_response</span><span class="p">(</span><span class="s2">&quot;INITIAL_SETUP&quot;</span><span class="p">,</span> <span class="n">ai_context</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2687">
                  <tt><i>2687</i>              <span class="k">if</span> <span class="n">initial_ai_response</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_ai_response</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2689">
                  <tt><i>2689</i>                  <span class="k">if</span> <span class="ow">not</span> <span class="n">conv_log_from_session</span> <span class="ow">or</span> <span class="n">conv_log_from_session</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">initial_ai_response</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2690">
                  <tt><i>2690</i>                       <span class="n">conv_log_from_session</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">initial_ai_response</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2691">
                  <tt><i>2691</i>                       <span class="n">session</span><span class="p">[</span><span class="n">SESSION_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log_from_session</span> <span class="c1"># Update session log</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2692">
                  <tt><i>2692</i>                       <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2694">
                  <tt><i>2694</i>                       <span class="n">p_data</span><span class="p">[</span><span class="n">FS_CONVERSATION</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_log_from_session</span><span class="p">[</span><span class="o">-</span><span class="n">MAX_CONVO_LINES</span><span class="p">:]</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2696">
                  <tt><i>2696</i>                       <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2697">
                  <tt><i>2697</i>              <span class="k">else</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2698">
                  <tt><i>2698</i>                   <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INITIAL_SETUP failed or returned non-string for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Response: </span><span class="si">{</span><span class="n">initial_ai_response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2708">
                  <tt><i>2708</i>                  <span class="n">text_with_vocab</span> <span class="o">=</span> <span class="n">apply_vocab_highlighting_python</span><span class="p">(</span><span class="n">text_to_process</span><span class="p">,</span> <span class="n">active_vocab</span><span class="p">,</span> <span class="n">vocab_settings</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2709">
                  <tt><i>2709</i>                  <span class="n">text_with_all_highlights</span> <span class="o">=</span> <span class="n">apply_lore_highlighting_python</span><span class="p">(</span><span class="n">text_with_vocab</span><span class="p">,</span> <span class="n">lore_vocabulary</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2710">
                  <tt><i>2710</i>                  <span class="n">processed_message</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_with_all_highlights</span> <span class="c1"># Use safe HTML</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2713">
                  <tt><i>2713</i>                  <span class="n">processed_message</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_to_process</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2739">
                  <tt><i>2739</i>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NameError accessing &#39;thetopia_lore&#39; globally. Sending empty lore data.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2740">
                  <tt><i>2740</i>              <span class="n">thetopia_lore_json</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span> <span class="c1"># Fallback empty JSON</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2742">
                  <tt><i>2742</i>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to serialize lore data to JSON: </span><span class="si">{</span><span class="n">json_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2743">
                  <tt><i>2743</i>              <span class="n">thetopia_lore_json</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span> <span class="c1"># Fallback empty JSON</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2755">
                  <tt><i>2755</i>              <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template rendering error in game_view GET: </span><span class="si">{</span><span class="n">render_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2756">
                  <tt><i>2756</i>              <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Critical error displaying game. Please reload your character.&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2757">
                  <tt><i>2757</i>              <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_CHARACTER_ID</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2758">
                  <tt><i>2758</i>              <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2759">
                  <tt><i>2759</i>              <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2850">
                  <tt><i>2850</i>          <span class="n">sheet_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sheet_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]))</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2901">
                  <tt><i>2901</i>                  <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Error: Comprehension questions missing from session.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2902">
                  <tt><i>2902</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EOC state AWAIT_COMP_ANSWERS but no questions in session for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2903">
                  <tt><i>2903</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span><span class="p">;</span> <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Reset state</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2904">
                  <tt><i>2904</i>                  <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;end_of_chapter&#39;</span><span class="p">))</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2972">
                  <tt><i>2972</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not retrieve profile data after XP update for level check. User: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3036">
                  <tt><i>3036</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI quest generation returned incomplete data for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">q_gen_res</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3037">
                  <tt><i>3037</i>                      <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;The AI storyteller couldn&#39;t generate a specific new quest objective. Feel free to explore!&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3038">
                  <tt><i>3038</i>                      <span class="n">next_q_id</span><span class="p">,</span> <span class="n">next_q_title</span><span class="p">,</span> <span class="n">next_s_id</span><span class="p">,</span> <span class="n">next_s_desc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Explore Thetopia&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Forge your own path or seek rumors.&quot;</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3040">
                  <tt><i>3040</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI generated next quest for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">next_q_id</span><span class="si">}</span><span class="s2"> - &#39;</span><span class="si">{</span><span class="n">next_q_title</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3041">
                  <tt><i>3041</i>                      <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New objective received: </span><span class="si">{</span><span class="n">next_q_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">)</span> <span class="c1"># Inform player</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3112">
                  <tt><i>3112</i>              <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;An unexpected state was encountered during chapter conclusion.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3113">
                  <tt><i>3113</i>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected EOC state &#39;</span><span class="si">{</span><span class="n">eoc_state</span><span class="si">}</span><span class="s2">&#39; encountered in GET for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">, char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Resetting.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3114">
                  <tt><i>3114</i>              <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3115">
                  <tt><i>3115</i>              <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l3116">
                  <tt><i>3116</i>              <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">))</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E231">
               <span class="count sev-2">
                  156
               </span>
               <strong>E231:</strong> missing whitespace after ':'

                  (and 1 similar)

            </a>
            <ul class="details">
            <li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l555">
                  <tt><i>555</i>         <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;AI Error&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span><span class="s2">&quot;AI model not initialized&quot;</span><span class="p">}</span> <span class="k">if</span> <span class="n">is_json_output</span> <span class="k">else</span> <span class="s2">&quot;Error: The Storyteller AI is currently unavailable.&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l621">
                  <tt><i>621</i>         <span class="n">current_npcs</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;present_npcs&#39;</span><span class="p">,[])</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l641">
                  <tt><i>641</i>         <span class="n">lore_desc</span> <span class="o">=</span> <span class="n">loc_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;A place beyond description.&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l672">
                  <tt><i>672</i>                 <span class="n">npc_data</span> <span class="o">=</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;npcs&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target_npc_found</span><span class="p">,{})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l673">
                  <tt><i>673</i>                 <span class="n">npc_desc</span> <span class="o">=</span> <span class="n">npc_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="s1">&#39;An individual.&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l674">
                  <tt><i>674</i>                 <span class="n">npc_pers</span> <span class="o">=</span> <span class="n">npc_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;personality&#39;</span><span class="p">,[])</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l709">
                  <tt><i>709</i>          <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Evaluate the player&#39;s answers based on their understanding of the chapter events, relevance to the questions, and evidence of reasoning (scale 1-10 for each answer).</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;Q</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="se">\n</span><span class="s2">A</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="p">(</span><span class="n">answers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">answers</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;(No Answer)&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">questions</span><span class="p">)])</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Provide an overall average comprehension score (float, 1-10).</span><span class="se">\n</span><span class="s2">Respond ONLY with JSON: </span><span class="se">{{\&quot;</span><span class="s2">overall_comprehension_score</span><span class="se">\&quot;</span><span class="s2">: float</span><span class="se">}}</span><span class="s2">.&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 3 places):</p>

               <a href="app.source.html#l718">
                  <tt><i>718</i>             <span class="sa">f</span><span class="s2">&quot;Check for clarity, interesting hooks based on lore (Races: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;races&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">, Classes: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;classes&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">, Philosophies: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;philosophies&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">), internal consistency, and playability. Focus on narrative aspects only.</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l729">
                  <tt><i>729</i>         <span class="n">char_data_narrative</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">char_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;boon&#39;</span><span class="p">,</span> <span class="s1">&#39;backstory&#39;</span><span class="p">,</span> <span class="s1">&#39;abilities&#39;</span><span class="p">,</span> <span class="s1">&#39;aspects&#39;</span><span class="p">]}</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l729">
                  <tt><i>729</i>         <span class="n">char_data_narrative</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">char_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;boon&#39;</span><span class="p">,</span> <span class="s1">&#39;backstory&#39;</span><span class="p">,</span> <span class="s1">&#39;abilities&#39;</span><span class="p">,</span> <span class="s1">&#39;aspects&#39;</span><span class="p">]}</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l731">
                  <tt><i>731</i>         <span class="n">last_summary_text</span> <span class="o">=</span> <span class="n">summaries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">,</span><span class="s1">&#39;(No previous summary)&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">summaries</span> <span class="k">else</span> <span class="s1">&#39;(First Chapter)&#39;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l747">
                  <tt><i>747</i>             <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span><span class="s2">&quot;Missing Input&quot;</span><span class="p">,</span> <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;Target word for vocabulary generation is missing&quot;</span><span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l753">
                  <tt><i>753</i>         <span class="n">quest_info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Quest:&#39;</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_quest_title&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; Step:&#39;</span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l990">
                  <tt><i>990</i> <span class="k">def</span><span class="w"> </span><span class="nf">get_user_characters</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 2 places):</p>

               <a href="app.source.html#l1019">
                  <tt><i>1019</i> <span class="k">def</span><span class="w"> </span><span class="nf">load_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">char_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1069">
                  <tt><i>1069</i>                 <span class="n">race_mod</span> <span class="o">=</span> <span class="n">RACE_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fate_point_mod&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1077">
                  <tt><i>1077</i>             <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;) for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 2 places):</p>

               <a href="app.source.html#l1088">
                  <tt><i>1088</i> <span class="k">def</span><span class="w"> </span><span class="nf">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">character_data</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1148">
                  <tt><i>1148</i>             <span class="n">race_mod</span> <span class="o">=</span> <span class="n">RACE_DATA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">save_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fate_point_mod&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l1161">
                  <tt><i>1161</i> <span class="k">def</span><span class="w"> </span><span class="nf">check_premium_access</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1365">
                  <tt><i>1365</i>                         <span class="n">flag_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;relationship_</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># Create a unique, clean flag name</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1396">
                  <tt><i>1396</i> <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1445">
                  <tt><i>1445</i> <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/signup&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1498">
                  <tt><i>1498</i>     <span class="n">user_email</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SESSION_USER_EMAIL</span><span class="p">,</span><span class="s1">&#39;Unknown User&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1517">
                  <tt><i>1517</i> <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/profile&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1556">
                  <tt><i>1556</i>                 <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Character &#39;</span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; loaded successfully.&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1660">
                  <tt><i>1660</i>                     <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pre-made character &#39;</span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39; created and loaded!&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l1762">
                  <tt><i>1762</i> <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/create_character&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2010">
                  <tt><i>2010</i>     <span class="n">target_word</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;target_word&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2033">
                  <tt><i>2033</i>         <span class="n">word_list_data</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;word&quot;</span><span class="p">:</span> <span class="n">target_info</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">],</span><span class="s2">&quot;definition&quot;</span><span class="p">:</span> <span class="n">target_info</span><span class="p">[</span><span class="s1">&#39;definition&#39;</span><span class="p">]}]</span> <span class="o">+</span> <span class="n">related_words</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2034">
                  <tt><i>2034</i>         <span class="n">list_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ai_</span><span class="si">{</span><span class="n">target_word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2053">
                  <tt><i>2053</i>         <span class="n">error_reason</span> <span class="o">=</span> <span class="n">ai_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span><span class="s1">&#39;Unknown AI error&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ai_response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;AI communication failure&#39;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 2 places):</p>

               <a href="app.source.html#l2147">
                  <tt><i>2147</i>             <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;Input too long (Max </span><span class="si">{</span><span class="n">MAX_INPUT_LENGTH</span><span class="si">}</span><span class="s2">). Be concise.&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2189">
                  <tt><i>2189</i>             <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;Player&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">p_input</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2201">
                  <tt><i>2201</i>                     <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Task: </span><span class="si">{</span><span class="n">new_desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2204">
                  <tt><i>2204</i>                     <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Let&#39;s try simpler. What would you like to observe or interact with briefly?&quot;</span><span class="p">})</span> <span class="c1"># Ask again</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l2212">
                  <tt><i>2212</i>                     <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="s1">&#39;player_race&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l2213">
                  <tt><i>2213</i>                     <span class="s1">&#39;player_class&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span> <span class="s1">&#39;player_philosophy&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2214">
                  <tt><i>2214</i>                     <span class="s1">&#39;player_abilities&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abilities&#39;</span><span class="p">,[]),</span> <span class="s1">&#39;player_fate_points&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fate_points&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2215">
                  <tt><i>2215</i>                     <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="n">curr_loc</span><span class="p">,</span> <span class="s1">&#39;location_data&#39;</span><span class="p">:</span> <span class="n">world_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l2216">
                  <tt><i>2216</i>                     <span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2222">
                  <tt><i>2222</i>                     <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">ai_resp</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2228">
                  <tt><i>2228</i>                      <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Finished with that detour. Now, let&#39;s reflect on the main chapter...&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2251">
                  <tt><i>2251</i>         <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;Player&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">p_input</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2282">
                  <tt><i>2282</i>             <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2283">
                  <tt><i>2283</i>             <span class="s1">&#39;player_race&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2284">
                  <tt><i>2284</i>             <span class="s1">&#39;player_class&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2285">
                  <tt><i>2285</i>             <span class="s1">&#39;player_philosophy&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2286">
                  <tt><i>2286</i>             <span class="s1">&#39;player_abilities&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;abilities&#39;</span><span class="p">,[]),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2287">
                  <tt><i>2287</i>             <span class="s1">&#39;player_aspects&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;aspects&#39;</span><span class="p">,[]),</span> <span class="c1"># Include aspects</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2290">
                  <tt><i>2290</i>             <span class="s1">&#39;location_data&#39;</span><span class="p">:</span> <span class="n">world_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span> <span class="c1"># Exits, etc.</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l2291">
                  <tt><i>2291</i>             <span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span> <span class="c1"># Desc, NPCs</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2292">
                  <tt><i>2292</i>             <span class="s1">&#39;thetopia_general_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;setting&#39;</span><span class="p">,{}),</span> <span class="c1"># World context</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2296">
                  <tt><i>2296</i>             <span class="s1">&#39;current_quest_title&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_quest_title&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2297">
                  <tt><i>2297</i>             <span class="s1">&#39;current_step_description&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 13 places):</p>

               <a href="app.source.html#l2310">
                  <tt><i>2310</i>         <span class="k">if</span> <span class="n">verb</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;go&quot;</span><span class="p">,</span><span class="s2">&quot;move&quot;</span><span class="p">,</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="s2">&quot;e&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="s2">&quot;u&quot;</span><span class="p">,</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="s2">&quot;north&quot;</span><span class="p">,</span><span class="s2">&quot;south&quot;</span><span class="p">,</span><span class="s2">&quot;east&quot;</span><span class="p">,</span><span class="s2">&quot;west&quot;</span><span class="p">,</span><span class="s2">&quot;up&quot;</span><span class="p">,</span><span class="s2">&quot;down&quot;</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2311">
                  <tt><i>2311</i>             <span class="n">direction</span> <span class="o">=</span> <span class="n">target</span> <span class="k">if</span> <span class="n">verb</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;go&quot;</span><span class="p">,</span><span class="s2">&quot;move&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">verb</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l2315">
                  <tt><i>2315</i>                 <span class="n">exits</span> <span class="o">=</span> <span class="n">world_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exits&quot;</span><span class="p">,{})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 5 places):</p>

               <a href="app.source.html#l2318">
                  <tt><i>2318</i>                 <span class="n">d_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="s1">&#39;north&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="s1">&#39;south&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">:</span><span class="s1">&#39;east&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">:</span><span class="s1">&#39;west&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">:</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="s1">&#39;down&#39;</span><span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 6 places):</p>

               <a href="app.source.html#l2318">
                  <tt><i>2318</i>                 <span class="n">d_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="s1">&#39;north&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="s1">&#39;south&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">:</span><span class="s1">&#39;east&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">:</span><span class="s1">&#39;west&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">:</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="s1">&#39;down&#39;</span><span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2342">
                  <tt><i>2342</i>                             <span class="nb">next</span><span class="p">((</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">ABILITY_NAME_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">abil_input</span> <span class="o">==</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> \</tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2357">
                  <tt><i>2357</i>         <span class="k">elif</span> <span class="n">verb</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;look&quot;</span><span class="p">,</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;examine&quot;</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l2361">
                  <tt><i>2361</i>         <span class="k">elif</span> <span class="n">verb</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">,</span><span class="s2">&quot;char&quot;</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;inventory&quot;</span><span class="p">,</span> <span class="s2">&quot;inv&quot;</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 6 places):</p>

               <a href="app.source.html#l2363">
                  <tt><i>2363</i>         <span class="k">elif</span> <span class="n">verb</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;journal&quot;</span><span class="p">,</span><span class="s2">&quot;quest&quot;</span><span class="p">,</span><span class="s2">&quot;log&quot;</span><span class="p">,</span><span class="s2">&quot;vocab&quot;</span><span class="p">,</span><span class="s2">&quot;words&quot;</span><span class="p">,</span><span class="s2">&quot;report&quot;</span><span class="p">,</span><span class="s2">&quot;reports&quot;</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2372">
                  <tt><i>2372</i>             <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">ai_resp</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2396">
                  <tt><i>2396</i>                         <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2417">
                  <tt><i>2417</i>                     <span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2418">
                  <tt><i>2418</i>                     <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;Objective Complete: &#39;</span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;Objective Details Missing&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;!&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2418">
                  <tt><i>2418</i>                     <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;Objective Complete: &#39;</span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;Objective Details Missing&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;!&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2423">
                  <tt><i>2423</i>                     <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">reward_msg</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2436">
                  <tt><i>2436</i>                         <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;A significant moment in your journey...&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2443">
                  <tt><i>2443</i>                                 <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">final_reward_msg</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 2 places):</p>

               <a href="app.source.html#l2464">
                  <tt><i>2464</i>                         <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;New Objective: </span><span class="si">{</span><span class="n">next_desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2477">
                  <tt><i>2477</i>                             <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">final_reward_msg</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2493">
                  <tt><i>2493</i>                 <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2497">
                  <tt><i>2497</i>                 <span class="s1">&#39;player_race&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2498">
                  <tt><i>2498</i>                 <span class="s1">&#39;player_class&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2499">
                  <tt><i>2499</i>                 <span class="s1">&#39;player_philosophy&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2504">
                  <tt><i>2504</i>                 <span class="s1">&#39;current_quest_title&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_quest_title&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2505">
                  <tt><i>2505</i>                 <span class="s1">&#39;current_step_description&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2509">
                  <tt><i>2509</i>                 <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">desc_txt</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 2 places):</p>

               <a href="app.source.html#l2525">
                  <tt><i>2525</i>             <span class="n">recent_conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;Player&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="n">p_input</span><span class="p">})</span> <span class="c1"># Add player input</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 2 places):</p>

               <a href="app.source.html#l2526">
                  <tt><i>2526</i>             <span class="k">if</span> <span class="n">ai_resp</span><span class="p">:</span> <span class="n">recent_conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="n">ai_resp</span><span class="p">})</span> <span class="c1"># Add AI output</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 2 places):</p>

               <a href="app.source.html#l2542">
                  <tt><i>2542</i>                  <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="s2">&quot;This feels like a good place to pause and reflect on this chapter. Shall we conclude it? (yes/no)&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':':</p>

               <a href="app.source.html#l2551">
                  <tt><i>2551</i>                  <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">init_resp</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2674">
                  <tt><i>2674</i>                  <span class="s1">&#39;player_name&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2675">
                  <tt><i>2675</i>                  <span class="s1">&#39;player_race&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;race_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2676">
                  <tt><i>2676</i>                  <span class="s1">&#39;player_class&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2677">
                  <tt><i>2677</i>                  <span class="s1">&#39;player_philosophy&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',' (in 2 places):</p>

               <a href="app.source.html#l2679">
                  <tt><i>2679</i>                  <span class="s1">&#39;thetopia_location_lore&#39;</span><span class="p">:</span> <span class="n">thetopia_lore</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;locations&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curr_loc</span><span class="p">,{}),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2682">
                  <tt><i>2682</i>                  <span class="s1">&#39;current_quest_title&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_quest_title&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2683">
                  <tt><i>2683</i>                  <span class="s1">&#39;current_step_description&#39;</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_description&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2929">
                  <tt><i>2929</i>             <span class="n">chapter_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">FS_CHAPTER_INPUTS</span><span class="p">,[]))</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 3 places):</p>

               <a href="app.source.html#l2943">
                  <tt><i>2943</i>                 <span class="o">+</span> <span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;avg_length_category&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 3 places):</p>

               <a href="app.source.html#l2946">
                  <tt><i>2946</i>                 <span class="o">+</span> <span class="p">{</span><span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;style_rating&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 3 places):</p>

               <a href="app.source.html#l2947">
                  <tt><i>2947</i>                 <span class="o">+</span> <span class="p">{</span><span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thinking_rating&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ':' (in 3 places):</p>

               <a href="app.source.html#l2948">
                  <tt><i>2948</i>                 <span class="o">+</span> <span class="p">{</span><span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;descriptive_language_rating&#39;</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2984">
                  <tt><i>2984</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Relevance &amp; Coherence: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;relevance_coherence_score&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> / 5</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2985">
                  <tt><i>2985</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Style Complexity: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;style_rating&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2986">
                  <tt><i>2986</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Critical Thinking: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thinking_rating&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2987">
                  <tt><i>2987</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Average Length: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;avg_length_category&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l2988">
                  <tt><i>2988</i>             <span class="n">summary_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;    * Descriptive Language: </span><span class="si">{</span><span class="n">anal_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;descriptive_language_rating&#39;</span><span class="p">,</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace after ',':</p>

               <a href="app.source.html#l3043">
                  <tt><i>3043</i>                 <span class="n">error_reason</span> <span class="o">=</span> <span class="n">q_gen_res</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span><span class="s1">&#39;Unknown AI error&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">q_gen_res</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;AI communication failure&#39;</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E117">
               <span class="count sev-2">
                  54
               </span>
               <strong>E117:</strong> over-indented

                  (and 1 similar)

            </a>
            <ul class="details">
            <li>

               <p>Over-indented:</p>

               <a href="app.source.html#l140">
                  <tt><i>140</i>              <span class="n">lore_vocabulary</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l500">
                  <tt><i>500</i> <span class="w">     </span><span class="sd">&quot;&quot;&quot;Applies highlighting spans for lore terms in Python.&quot;&quot;&quot;</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l686">
                  <tt><i>686</i>                  <span class="n">prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Interaction Note: </span><span class="si">{</span><span class="n">npc_detail</span><span class="si">}</span><span class="s2">. Ask player to clarify who they are talking to if ambiguous.&quot;</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l689">
                  <tt><i>689</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l706">
                  <tt><i>706</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l766">
                  <tt><i>766</i>          <span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l772">
                  <tt><i>772</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span> <span class="c1"># Expecting JSON objective back</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l780">
                  <tt><i>780</i>          <span class="n">output_format</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span> <span class="c1"># Expecting YES/NO</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l820">
                  <tt><i>820</i>              <span class="n">feedback</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s1">&#39;prompt_feedback&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l836">
                  <tt><i>836</i>                  <span class="n">ratings_str_list</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">probability</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">candidate</span><span class="o">.</span><span class="n">safety_ratings</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">blocked</span><span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l848">
                  <tt><i>848</i>              <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI response content is empty for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l862">
                  <tt><i>862</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI returned an empty string when JSON was expected for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented (comment):</p>

               <a href="app.source.html#l893">
                  <tt><i>893</i>          <span class="c1"># Catch errors during the API call itself</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l894">
                  <tt><i>894</i>          <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vertex AI API call failed for prompt type &#39;</span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">api_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l997">
                  <tt><i>997</i>          <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User ID not provided to get_user_characters.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1271">
                  <tt><i>1271</i>              <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI Check trigger found for step </span><span class="si">{</span><span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;current_step_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> but condition is empty.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1317">
                  <tt><i>1317</i>                          <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Character </span><span class="si">{</span><span class="n">char_id_log</span><span class="si">}</span><span class="s2"> fate_points field is not numeric (</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">current_fp</span><span class="p">)</span><span class="si">}</span><span class="s2">). Resetting to base before applying change.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1337">
                  <tt><i>1337</i>                          <span class="n">quest_flags</span><span class="p">[</span><span class="n">flag_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag_value</span> <span class="c1"># Set the flag</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1340">
                  <tt><i>1340</i>                          <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Invalid flag name (&#39;</span><span class="si">{</span><span class="n">flag_name</span><span class="si">}</span><span class="s2">&#39;) or value (&#39;</span><span class="si">{</span><span class="n">flag_value</span><span class="si">}</span><span class="s2">&#39;) in &#39;set_flag&#39; for info reward. Flag name must be string, value must be boolean.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1342">
                  <tt><i>1342</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Invalid &#39;set_flag&#39; format in info reward: </span><span class="si">{</span><span class="n">flag_to_set_data</span><span class="si">}</span><span class="s2">. Expected a dictionary </span><span class="se">{{</span><span class="s2">&#39;flag_name&#39;: True/False</span><span class="se">}}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented (comment):</p>

               <a href="app.source.html#l1347">
                  <tt><i>1347</i>                  <span class="c1"># Ensure inventory list exists and append item</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1348">
                  <tt><i>1348</i>                  <span class="n">inventory_list</span> <span class="o">=</span> <span class="n">p_data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">FS_INVENTORY</span><span class="p">,</span> <span class="p">[])</span></tt>
               </a>
            </li><li>

               <p>Over-indented (comment):</p>

               <a href="app.source.html#l1360">
                  <tt><i>1360</i>              <span class="c1"># Example: Store relationship points in FS_QUEST_FLAGS</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1361">
                  <tt><i>1361</i>              <span class="k">if</span> <span class="n">target</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1637">
                  <tt><i>1637</i>                              <span class="n">start_s_desc</span> <span class="o">=</span> <span class="n">start_s_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;Begin your journey.&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1889">
                  <tt><i>1889</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required character detail (Race/Class/Philosophy). Please start over.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1921">
                  <tt><i>1921</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Internal data error finding details for </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Please check selections.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l1928">
                  <tt><i>1928</i>                  <span class="n">flash</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred calculating character stats: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Please start over.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2228">
                  <tt><i>2228</i>                      <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Finished with that detour. Now, let&#39;s reflect on the main chapter...&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2269">
                  <tt><i>2269</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> gained </span><span class="si">{</span><span class="n">player_xp_gain</span><span class="si">}</span><span class="s2"> Player XP this turn.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented (comment):</p>

               <a href="app.source.html#l2541">
                  <tt><i>2541</i>                  <span class="c1"># Prompt player to confirm EOC</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2542">
                  <tt><i>2542</i>                  <span class="n">conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="s2">&quot;This feels like a good place to pause and reflect on this chapter. Shall we conclude it? (yes/no)&quot;</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Over-indented (comment):</p>

               <a href="app.source.html#l2547">
                  <tt><i>2547</i>                  <span class="c1"># Initiate side quest flow</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2548">
                  <tt><i>2548</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI suggested player side quest for </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented (comment):</p>

               <a href="app.source.html#l2559">
                  <tt><i>2559</i>                  <span class="c1"># No suggestion or explicit NO</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2560">
                  <tt><i>2560</i>                  <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI EOC check result: &#39;</span><span class="si">{</span><span class="n">suggestion</span><span class="si">}</span><span class="s2">&#39; for </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Continuing chapter.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2640">
                  <tt><i>2640</i>                  <span class="n">conv_log_for_session</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;Storyteller&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">intro_text</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2653">
                  <tt><i>2653</i>                      <span class="n">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">p_data</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2671">
                  <tt><i>2671</i>              <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running INITIAL_SETUP AI for new character </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2"> (Turn 0, Intro not shown this load).&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2690">
                  <tt><i>2690</i>                       <span class="n">conv_log_from_session</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span> <span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">initial_ai_response</span><span class="p">})</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2698">
                  <tt><i>2698</i>                   <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INITIAL_SETUP failed or returned non-string for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">. Response: </span><span class="si">{</span><span class="n">initial_ai_response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2708">
                  <tt><i>2708</i>                  <span class="n">text_with_vocab</span> <span class="o">=</span> <span class="n">apply_vocab_highlighting_python</span><span class="p">(</span><span class="n">text_to_process</span><span class="p">,</span> <span class="n">active_vocab</span><span class="p">,</span> <span class="n">vocab_settings</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented (comment):</p>

               <a href="app.source.html#l2712">
                  <tt><i>2712</i>                  <span class="c1"># Allow basic HTML like line breaks in system messages if needed</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2713">
                  <tt><i>2713</i>                  <span class="n">processed_message</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_to_process</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2739">
                  <tt><i>2739</i>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NameError accessing &#39;thetopia_lore&#39; globally. Sending empty lore data.&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2742">
                  <tt><i>2742</i>              <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to serialize lore data to JSON: </span><span class="si">{</span><span class="n">json_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented (comment):</p>

               <a href="app.source.html#l2754">
                  <tt><i>2754</i>              <span class="c1"># Handle potential template rendering errors</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2755">
                  <tt><i>2755</i>              <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Template rendering error in game_view GET: </span><span class="si">{</span><span class="n">render_err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2850">
                  <tt><i>2850</i>          <span class="n">sheet_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sheet_data</span><span class="p">[</span><span class="s1">&#39;learned_vocab&#39;</span><span class="p">]))</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2901">
                  <tt><i>2901</i>                  <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;Error: Comprehension questions missing from session.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l2972">
                  <tt><i>2972</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not retrieve profile data after XP update for level check. User: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l3036">
                  <tt><i>3036</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI quest generation returned incomplete data for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">q_gen_res</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l3040">
                  <tt><i>3040</i>                      <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AI generated next quest for char </span><span class="si">{</span><span class="n">char_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">next_q_id</span><span class="si">}</span><span class="s2"> - &#39;</span><span class="si">{</span><span class="n">next_q_title</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Over-indented:</p>

               <a href="app.source.html#l3112">
                  <tt><i>3112</i>              <span class="n">flash</span><span class="p">(</span><span class="s2">&quot;An unexpected state was encountered during chapter conclusion.&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E114">
               <span class="count sev-2">
                  24
               </span>
               <strong>E114:</strong> indentation is not a multiple of 4 (comment)

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l504">
                  <tt><i>504</i>      <span class="c1"># Pre-process lore terms to include display data needed by the formatter</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l512">
                  <tt><i>512</i>      <span class="c1"># Find terms using the original key case for lore terms (can be proper nouns)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l515">
                  <tt><i>515</i>      <span class="c1"># Define formatters specific to lore</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l517">
                  <tt><i>517</i>          <span class="c1"># Format the lore path as a JSON string for the data attribute</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l522">
                  <tt><i>522</i>          <span class="c1"># Simple title using the display term</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l526">
                  <tt><i>526</i>          <span class="c1"># Display the term using its proper capitalization from lore data</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l529">
                  <tt><i>529</i>      <span class="c1"># Use the generic highlighting function</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l893">
                  <tt><i>893</i>          <span class="c1"># Catch errors during the API call itself</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l896">
                  <tt><i>896</i>          <span class="c1"># Return error in the expected format</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1347">
                  <tt><i>1347</i>                  <span class="c1"># Ensure inventory list exists and append item</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1360">
                  <tt><i>1360</i>              <span class="c1"># Example: Store relationship points in FS_QUEST_FLAGS</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2230">
                  <tt><i>2230</i>                      <span class="c1"># Clear side quest state from session</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2234">
                  <tt><i>2234</i>                      <span class="c1"># Start EOC flow</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2541">
                  <tt><i>2541</i>                  <span class="c1"># Prompt player to confirm EOC</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2547">
                  <tt><i>2547</i>                  <span class="c1"># Initiate side quest flow</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2552">
                  <tt><i>2552</i>                  <span class="c1"># Set side quest state in session</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2559">
                  <tt><i>2559</i>                  <span class="c1"># No suggestion or explicit NO</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2643">
                  <tt><i>2643</i>                  <span class="c1"># Also update the persistent log in p_data immediately</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2672">
                  <tt><i>2672</i>              <span class="c1"># Build context for INITIAL_SETUP</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2688">
                  <tt><i>2688</i>                  <span class="c1"># Check if this exact message is already the last one (avoid double add on reload)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2693">
                  <tt><i>2693</i>                       <span class="c1"># Also update the persistent log in p_data</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2695">
                  <tt><i>2695</i>                       <span class="c1"># Save character data immediately after adding initial setup message</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2712">
                  <tt><i>2712</i>                  <span class="c1"># Allow basic HTML like line breaks in system messages if needed</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2754">
                  <tt><i>2754</i>              <span class="c1"># Handle potential template rendering errors</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E302">
               <span class="count sev-2">
                  16
               </span>
               <strong>E302:</strong> expected 2 blank lines, found 0

                  (and 1 similar)

            </a>
            <ul class="details">
            <li>

               <p>Expected 2 blank lines, found 0:</p>

               <a href="app.source.html#l43">
                  <tt><i>43</i> <span class="k">def</span><span class="w"> </span><span class="nf">_fallback_calculate_xp</span><span class="p">(</span><span class="n">text_input</span><span class="p">,</span> <span class="n">learned_set</span><span class="p">):</span> <span class="c1"># Removed unused custom_vocab arg</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 0:</p>

               <a href="app.source.html#l83">
                  <tt><i>83</i> <span class="k">def</span><span class="w"> </span><span class="nf">_fallback_get_quest</span><span class="p">(</span><span class="n">quest_id</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 0:</p>

               <a href="app.source.html#l86">
                  <tt><i>86</i> <span class="k">def</span><span class="w"> </span><span class="nf">_fallback_get_quest_step</span><span class="p">(</span><span class="n">quest_id</span><span class="p">,</span> <span class="n">step_id</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l329">
                  <tt><i>329</i> <span class="k">def</span><span class="w"> </span><span class="nf">find_terms_in_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">terms_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">key_transform</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]:</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l373">
                  <tt><i>373</i> <span class="k">def</span><span class="w"> </span><span class="nf">process_text_for_highlighting</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">terms</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]],</span> <span class="n">span_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_attribute_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_formatter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;#39;&quot;</span><span class="p">),</span> <span class="n">title_formatter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;definition&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">display_formatter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">original_keyword</span><span class="p">,</span> <span class="n">matched_text</span><span class="p">,</span> <span class="n">term_data</span><span class="p">:</span> <span class="n">matched_text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l499">
                  <tt><i>499</i> <span class="k">def</span><span class="w"> </span><span class="nf">apply_lore_highlighting_python</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lore_vocab</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l990">
                  <tt><i>990</i> <span class="k">def</span><span class="w"> </span><span class="nf">get_user_characters</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l1019">
                  <tt><i>1019</i> <span class="k">def</span><span class="w"> </span><span class="nf">load_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">char_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l1088">
                  <tt><i>1088</i> <span class="k">def</span><span class="w"> </span><span class="nf">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">character_data</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l1161">
                  <tt><i>1161</i> <span class="k">def</span><span class="w"> </span><span class="nf">check_premium_access</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l1178">
                  <tt><i>1178</i> <span class="k">def</span><span class="w"> </span><span class="nf">login_required</span><span class="p">(</span><span class="n">f</span><span class="p">):</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l1762">
                  <tt><i>1762</i> <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/create_character&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l2001">
                  <tt><i>2001</i> <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/generate_vocab_list&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l2081">
                  <tt><i>2081</i> <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/delete_vocab_list/&lt;list_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l2762">
                  <tt><i>2762</i> <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/journal/vocab&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span></tt>
               </a>
            </li><li>

               <p>Expected 2 blank lines, found 1:</p>

               <a href="app.source.html#l2829">
                  <tt><i>2829</i> <span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/journal/character&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E701">
               <span class="count sev-2">
                  8
               </span>
               <strong>E701:</strong> multiple statements on one line (colon)

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l1614">
                  <tt><i>1614</i>             <span class="k">if</span> <span class="n">class_ability</span><span class="p">:</span> <span class="n">all_abilities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">class_ability</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1615">
                  <tt><i>1615</i>             <span class="k">if</span> <span class="n">phil_ability</span><span class="p">:</span> <span class="n">all_abilities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">phil_ability</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1620">
                  <tt><i>1620</i>             <span class="k">if</span> <span class="s2">&quot;Artistic Shell&quot;</span> <span class="ow">in</span> <span class="n">new_char_data</span><span class="p">[</span><span class="s1">&#39;abilities&#39;</span><span class="p">]:</span> <span class="n">aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Shell Design: Undefined&quot;</span><span class="p">)</span> <span class="c1"># Example aspect</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1653">
                  <tt><i>1653</i>                     <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys_to_clear</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1902">
                  <tt><i>1902</i>                 <span class="k">if</span> <span class="n">class_ability</span><span class="p">:</span> <span class="n">all_abilities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">class_ability</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1903">
                  <tt><i>1903</i>                 <span class="k">if</span> <span class="n">phil_ability</span><span class="p">:</span> <span class="n">all_abilities</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">phil_ability</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l1908">
                  <tt><i>1908</i>                 <span class="k">if</span> <span class="s2">&quot;Artistic Shell&quot;</span> <span class="ow">in</span> <span class="n">final_char_data</span><span class="p">[</span><span class="s1">&#39;abilities&#39;</span><span class="p">]:</span> <span class="n">aspects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Shell Design: Undefined&quot;</span><span class="p">)</span> <span class="c1"># Example</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2526">
                  <tt><i>2526</i>             <span class="k">if</span> <span class="n">ai_resp</span><span class="p">:</span> <span class="n">recent_conv_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;speaker&quot;</span><span class="p">:</span><span class="s2">&quot;AI&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span><span class="n">ai_resp</span><span class="p">})</span> <span class="c1"># Add AI output</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E702">
               <span class="count sev-2">
                  7
               </span>
               <strong>E702:</strong> multiple statements on one line (semicolon)

            </a>
            <ul class="details">
            <li>

               <p>Multiple statements on one line (semicolon):</p>

               <a href="app.source.html#l2469">
                  <tt><i>2469</i>                         <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;current_quest_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">p_data</span><span class="p">[</span><span class="s1">&#39;current_step_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># End quest</span></tt>
               </a>
            </li><li>

               <p>Multiple statements on one line (semicolon):</p>

               <a href="app.source.html#l2903">
                  <tt><i>2903</i>                  <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span><span class="p">;</span> <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Reset state</span></tt>
               </a>
            </li><li>

               <p>Multiple statements on one line (semicolon) (in 2 places):</p>

               <a href="app.source.html#l3068">
                  <tt><i>3068</i>             <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Multiple statements on one line (semicolon):</p>

               <a href="app.source.html#l3096">
                  <tt><i>3096</i>                 <span class="n">session</span><span class="p">[</span><span class="n">SESSION_EOC_STATE</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;START&#39;</span><span class="p">;</span> <span class="n">session</span><span class="o">.</span><span class="n">modified</span> <span class="o">=</span> <span class="kc">True</span></tt>
               </a>
            </li><li>

               <p>Multiple statements on one line (semicolon) (in 2 places):</p>

               <a href="app.source.html#l3114">
                  <tt><i>3114</i>              <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="kc">None</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E201">
               <span class="count sev-2">
                  5
               </span>
               <strong>E201:</strong> whitespace after '{'

                  (and 1 similar)

            </a>
            <ul class="details">
            <li>

               <p>Whitespace after '{':</p>

               <a href="app.source.html#l987">
                  <tt><i>987</i>     <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="n">user_settings</span><span class="p">,</span> <span class="s2">&quot;vocab&quot;</span><span class="p">:</span> <span class="n">consolidated_vocab</span> <span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Whitespace after '[':</p>

               <a href="app.source.html#l1652">
                  <tt><i>1652</i>                     <span class="n">keys_to_clear</span> <span class="o">=</span> <span class="p">[</span> <span class="n">SESSION_LAST_AI_OUTPUT</span><span class="p">,</span> <span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="n">SESSION_EOC_PROMPTED</span><span class="p">,</span> <span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">,</span> <span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_ACTIVE</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_TURNS</span> <span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Whitespace after '{':</p>

               <a href="app.source.html#l2047">
                  <tt><i>2047</i>             <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Vocabulary list for &#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39; created!&quot;</span><span class="p">,</span> <span class="s2">&quot;list_id&quot;</span><span class="p">:</span> <span class="n">list_id</span><span class="p">,</span> <span class="s2">&quot;list_name&quot;</span><span class="p">:</span> <span class="n">list_name</span> <span class="p">}),</span> <span class="mi">200</span></tt>
               </a>
            </li><li>

               <p>Whitespace after '{':</p>

               <a href="app.source.html#l2194">
                  <tt><i>2194</i>                 <span class="n">ai_context_sideq</span><span class="o">.</span><span class="n">update</span><span class="p">({</span> <span class="n">k</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;current_location&#39;</span><span class="p">]})</span></tt>
               </a>
            </li><li>

               <p>Whitespace after '{':</p>

               <a href="app.source.html#l2549">
                  <tt><i>2549</i>                  <span class="n">side_quest_init_ctx</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="n">p_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;race_name&#39;</span><span class="p">,</span> <span class="s1">&#39;class_name&#39;</span><span class="p">,</span> <span class="s1">&#39;philosophy_name&#39;</span><span class="p">,</span> <span class="s1">&#39;current_location&#39;</span><span class="p">]}</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E202">
               <span class="count sev-2">
                  3
               </span>
               <strong>E202:</strong> whitespace before '}'

                  (and 1 similar)

            </a>
            <ul class="details">
            <li>

               <p>Whitespace before '}':</p>

               <a href="app.source.html#l987">
                  <tt><i>987</i>     <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="n">user_settings</span><span class="p">,</span> <span class="s2">&quot;vocab&quot;</span><span class="p">:</span> <span class="n">consolidated_vocab</span> <span class="p">}</span></tt>
               </a>
            </li><li>

               <p>Whitespace before ']':</p>

               <a href="app.source.html#l1652">
                  <tt><i>1652</i>                     <span class="n">keys_to_clear</span> <span class="o">=</span> <span class="p">[</span> <span class="n">SESSION_LAST_AI_OUTPUT</span><span class="p">,</span> <span class="n">SESSION_EOC_STATE</span><span class="p">,</span> <span class="n">SESSION_EOC_QUESTIONS</span><span class="p">,</span> <span class="n">SESSION_EOC_SUMMARY</span><span class="p">,</span> <span class="n">SESSION_EOC_PROMPTED</span><span class="p">,</span> <span class="n">SESSION_NEW_CHAR_DETAILS</span><span class="p">,</span> <span class="n">SESSION_AI_RECOMMENDATIONS</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_ACTIVE</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_DESC</span><span class="p">,</span> <span class="n">SESSION_SIDE_QUEST_TURNS</span> <span class="p">]</span></tt>
               </a>
            </li><li>

               <p>Whitespace before '}':</p>

               <a href="app.source.html#l2047">
                  <tt><i>2047</i>             <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span> <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Vocabulary list for &#39;</span><span class="si">{</span><span class="n">target_word</span><span class="si">}</span><span class="s2">&#39; created!&quot;</span><span class="p">,</span> <span class="s2">&quot;list_id&quot;</span><span class="p">:</span> <span class="n">list_id</span><span class="p">,</span> <span class="s2">&quot;list_name&quot;</span><span class="p">:</span> <span class="n">list_name</span> <span class="p">}),</span> <span class="mi">200</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E227">
               <span class="count sev-2">
                  3
               </span>
               <strong>E227:</strong> missing whitespace around bitwise or shift operator

            </a>
            <ul class="details">
            <li>

               <p>Missing whitespace around bitwise or shift operator:</p>

               <a href="app.source.html#l866">
                  <tt><i>866</i>                 <span class="n">clean_json_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^```json\s*|\s*```$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ai_text</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span></tt>
               </a>
            </li><li>

               <p>Missing whitespace around bitwise or shift operator (in 2 places):</p>

               <a href="app.source.html#l1088">
                  <tt><i>1088</i> <span class="k">def</span><span class="w"> </span><span class="nf">save_character_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">character_data</span><span class="p">:</span><span class="nb">dict</span><span class="o">|</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="p">:</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E303">
               <span class="count sev-2">
                  3
               </span>
               <strong>E303:</strong> too many blank lines (2)

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l811">
                  <tt><i>811</i>     <span class="c1"># --- AI Call and Response Handling ---</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l941">
                  <tt><i>941</i>         <span class="c1"># --- Compile Vocabulary Words ---</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l2565">
                  <tt><i>2565</i>         <span class="c1"># --- Save Final State for this Turn ---</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E127">
               <span class="count sev-2">
                  2
               </span>
               <strong>E127:</strong> continuation line over-indented for visual indent

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l2342">
                  <tt><i>2342</i>                             <span class="nb">next</span><span class="p">((</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">ABILITY_NAME_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">abil_input</span> <span class="o">==</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> \</tt>
               </a>
            </li><li>

               <a href="app.source.html#l2343">
                  <tt><i>2343</i>                             <span class="n">abil_input</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="c1"># Fallback to capitalized input</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E305">
               <span class="count sev-2">
                  2
               </span>
               <strong>E305:</strong> expected 2 blank lines after class or function definition, found 0

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l46">
                  <tt><i>46</i> <span class="n">calculate_xp</span> <span class="o">=</span> <span class="n">_fallback_calculate_xp</span> <span class="c1"># Assign fallback initially</span></tt>
               </a>
            </li><li>

               <a href="app.source.html#l89">
                  <tt><i>89</i> <span class="n">get_quest</span> <span class="o">=</span> <span class="n">_fallback_get_quest</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E131">
               <span class="count sev-2">
                  1
               </span>
               <strong>E131:</strong> continuation line unaligned for hanging indent

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l2501">
                  <tt><i>2501</i>                  <span class="c1"># Pass current quest info even after moving</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="E225">
               <span class="count sev-2">
                  1
               </span>
               <strong>E225:</strong> missing whitespace around operator

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l1452">
                  <tt><i>1452</i>     <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">==</span><span class="s1">&#39;POST&#39;</span><span class="p">:</span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="W291">
               <span class="count sev-2">
                  1
               </span>
               <strong>W291:</strong> trailing whitespace

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l2624">
                  <tt><i>2624</i> <span class="s2">Welcome to your Daydream! You are a new player located on Dumpster Planet, responsible for containing all of the wasted ideas from human daydreams. The games governing AI is named The Great Recycler and is responsible for cleaning up Daydream by elevating ideas from trash to treasure. </span></tt>
               </a>
            </li>
            </ul>
         </li>

         <li>
            <a data-code="W292">
               <span class="count sev-2">
                  1
               </span>
               <strong>W292:</strong> no newline at end of file

            </a>
            <ul class="details">
            <li>

               <a href="app.source.html#l3196">
                  <tt><i>3196</i>     <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">use_reloader</span><span class="o">=</span><span class="n">debug_mode</span><span class="p">)</span></tt>
               </a>
            </li>
            </ul>
         </li>

         </ul>
      </div>
   </body>
</html>